import{i1 as E,ev as S,j as a,au as tt,Q as F,V as M,qs as ut,qt as mt,qu as pt,aC as W,aX as gt,c as k,F as et,x as v,da as b,T as Y,B as J,I as D,y as ft,d as Ct,v as at,Y as nt,i2 as ht,eY as kt,aR as ot,R as P,dR as X,be as vt,eu as St,i3 as yt,eU as bt,ae as _t}from"./index-cd84bcc9.js";import{l as B,ar as $,r as C,bE as wt,b2 as R,C as N,bc as Tt,a9 as It}from"./vendor-51460554.js";import{D as m}from"./index-022aaf3d.js";import{L as Ot}from"./index-c8a663c0.js";import{M as q}from"./MultiselectField-a1e665cb.js";import{D as Dt,a as rt}from"./DocumentTypeTag-ae42a623.js";import{D as st}from"./DeleteDocumentConfirmationModal-44709272.js";import{D as it,S as Z}from"./statementOfWork-e03c986f.js";import{C as z}from"./contactDetails-4902172b.js";import{A as ct}from"./payloadParser-f4cc4e4f.js";import{f as lt}from"./getTimeStampForDisplaying-22d5ca9d.js";import{u as Et}from"./contractPermissions-cf3fd14b.js";import{C as K}from"./contract-47e31a61.js";import{u as dt}from"./navigation-419d637e.js";import{u as Wt}from"./contractPdf-f9d6c58f.js";import{u as Pt}from"./statementOfWorkPermissions-68d8aac2.js";import{u as Nt}from"./statementOfWorkPdf-95417ec8.js";import{R as At}from"./RouterLink-30e622d4.js";import"./styles-58edde60.js";import"./styles-26e8a352.js";import"./Pagination-43542d57.js";import"./TickCheckbox-c4d9d4b6.js";import"./Accordion-ea03839b.js";import"./useResizeObserver-0deb9469.js";import"./sideNavItems-22800105.js";import"./index-2d186805.js";import"./storyblok-c16fb040.js";import"./index-4963229a.js";import"./Modal-5a254f40.js";import"./styles-3ceda759.js";import"./useElementDimensions-84b2a778.js";import"./utils-87d126b1.js";import"./SelectField-54706174.js";import"./styles-5db1c009.js";import"./countries-4aa86a38.js";function I(t){return t&&t.length>0?t:null}function Lt(t){return{search:I(t==null?void 0:t.search),status:I(t==null?void 0:t.statuses),noumIds:I(t==null?void 0:t.noumIds),consignors:I(t==null?void 0:t.consignorIds)}}function Ft(t){return{search:I(t==null?void 0:t.search),status:I(t==null?void 0:t.statuses),noumIds:I(t==null?void 0:t.noumIds),consignors:I(t==null?void 0:t.consignorIds)}}function Mt(t){return{perspective:t.perspective??E.Owner,search:"",type:t.type??S.Contract,statuses:t.status?[t.status]:void 0,consignorIds:void 0,noumIds:t.noumId?[t.noumId]:void 0}}function Vt(t,o){return{type:"value",key:t,value:t,label:o(`noumena.contract_manager.filters.status.contract.${B.snakeCase(t)}`)}}function xt(t,o){return{type:"value",key:t,value:t,label:o(`noumena.contract_manager.filters.status.sow.${B.snakeCase(t)}`)}}function Rt(t){var o;return{type:"value",key:t._id,value:t._id,label:t.displayName,icon:a(tt,{url:(o=t.userId.profile)==null?void 0:o.profilePictureThumbnail,size:"M","data-test":"Avatar"})}}function zt(t){return{type:"value",key:t._id??"",value:t._id??"",label:t.name,icon:a(tt,{url:t.profileImageThumbnail,size:"M","data-test":"Avatar"})}}function Bt(t){return t===E.Owner?[F.Draft,F.Issued,F.Signed]:[F.Issued,F.Signed]}function $t(t){return t===E.Owner?[M.Draft,M.Issued,M.Signed]:[M.Issued,M.Signed]}function jt({listPerspective:t,documentType:o}){const{t:i}=$(),{data:c,loading:h}=ut({variables:{pov:t},skip:o!==S.Contract}),{data:p,loading:g}=mt({variables:{pov:t},skip:o!==S.Sow}),{data:r,loading:l}=pt({variables:{pov:t}}),f=C.useMemo(()=>o===S.Contract?Bt(t).map(s=>xt(s,i)):$t(t).map(s=>Vt(s,i)),[o,t,i]),d=C.useMemo(()=>W(r==null?void 0:r.getConsignors).map(Rt),[r==null?void 0:r.getConsignors]),n=C.useMemo(()=>W(o===S.Contract?c==null?void 0:c.getNoumsLinkedToContracts:p==null?void 0:p.getNoumsLinkedToSOWs).map(zt),[c==null?void 0:c.getNoumsLinkedToContracts,o,p]);return{statuses:{options:f,allValues:C.useMemo(()=>f.map(s=>s.key),[f]),loading:!1},consignors:{options:d,allValues:C.useMemo(()=>d.map(s=>s.key),[d]),loading:l},noums:{options:n,allValues:C.useMemo(()=>n.map(s=>s.key),[n]),loading:h||g}}}function Qt({onCreateContract:t,onCreateStatementOfWork:o}){const{t:i}=$(),{watch:c,setValue:h}=wt(),[p,g]=c(["type","perspective"]),r=gt(g),{statuses:l,consignors:f,noums:d}=jt({listPerspective:g,documentType:p});return C.useEffect(()=>{g!==r&&(h("consignorIds",void 0),h("noumIds",void 0))},[g,r,h]),k(et,{children:[k(v,{gap:24,vertical:!0,align:"stretch","data-test":"Stack",children:[k(v,{gap:24,justify:"space-between",align:"center","data-test":"Stack",children:[a(b,{grow:!0,"data-test":"StackItem",children:a(Y,{font:"heading-xs-bold","data-test":"TSpan",children:i("noumena.contract_manager.contract_manager")})}),k(v,{gap:8,justify:"flex-end",align:"center","data-test":"Stack",children:[a(J,{secondary:!0,size:"small",leftIcon:a(D,{name:"add_m",size:24,"data-test":"Icon"}),onClick:o,"data-test":"Button",children:i("noumena.contract_manager.cta.new_statement_of_work")}),a(J,{primary:!0,size:"small",leftIcon:a(D,{name:"add_m",size:24,"data-test":"Icon"}),onClick:t,"data-test":"Button",children:i("noumena.contract_manager.cta.new_contract")})]})]}),k(v,{gap:8,justify:"stretch",align:"center","data-test":"Stack",children:[a(b,{grow:!0,"data-test":"StackItem",children:a(m.FilterInput,{name:"type",render:({field:{value:n,onChange:s}})=>a(Dt,{value:n,onChange:s,"data-test":"DocumentTypeFilterField"})})}),a(b,{basis:"150px","data-test":"StackItem",children:a(m.FilterInput,{name:"statuses",render:({field:{value:n,onChange:s}})=>a(q,{inputSize:"small",label:i("noumena.contract_manager.filters.status.label"),options:l.options,isLoading:l.loading,value:n??l.allValues,onChange:s,maxContainerHeight:"500px","data-test":"MultiselectField"})})}),a(b,{grow:!0,"data-test":"StackItem",children:a(m.FilterInput,{name:"consignorIds",render:({field:{value:n,onChange:s}})=>a(q,{inputSize:"small",hideIcons:!1,label:i("noumena.contract_manager.filters.consignor.label"),allOptionLabel:"All Consignors",options:f.options,isLoading:f.loading,value:n??f.allValues,onChange:s,maxContainerHeight:"500px","data-test":"MultiselectField"})})}),a(b,{grow:!0,"data-test":"StackItem",children:a(m.FilterInput,{name:"noumIds",render:({field:{value:n,onChange:s}})=>a(q,{inputSize:"small",hideIcons:!1,label:i("noumena.contract_manager.filters.noum.label"),allOptionLabel:g===E.Owner?"All Owned Noums":"All Noums",options:d.options,isLoading:d.loading,value:n??d.allValues,onChange:s,maxContainerHeight:"500px","data-test":"MultiselectField"})})}),a(b,{grow:!0,"data-test":"StackItem",children:a(m.FilterInput,{name:"search",render:({field:{value:n,onChange:s}})=>a(ft,{inputSize:"small",value:n,onChange:s,placeholder:i("noumena.contract_manager.search.placeholder"),leftIcon:a(D,{name:"search_m",size:24,color:"--icon-input-neutral-default","data-test":"Icon"}),rightIcon:a(D,{name:"clear_m",size:24,color:n?"--icon-input-brand-primary-default":"--color-base-transparent",onClick:()=>s(""),"data-test":"Icon"}),"data-test":"TextField"})})})]})]}),a(b,{"data-test":"StackItem",children:a(m.FilterInput,{name:"perspective",render:({field:{value:n,onChange:s}})=>a(Ct,{selectedId:n,mode:"isUnderline",isWithoutImage:!0,fontSize:"--font-body-medium-bold-size",onChange:O=>s(O),inputList:[{id:E.Owner,name:"mine",text:"Created by me",labelSize:"small"},{id:E.CounterParty,name:"received",text:"Received",labelSize:"small"}],"data-test":"TabsForm"})})})]})}function Ut({offset:t,filters:o,listPerspective:i,enableBulkDownload:c,onPaginationChange:h}){const{addPrimaryIconToast:p,addToast:g}=at(),{t:r}=$(),{logError:l}=nt(),{navigateAndSetOrigin:f}=dt(),d=Et(),{data:n,loading:s,refetch:O}=ht({variables:{limit:5,offset:t,filter:Lt(o),viewingAs:i},fetchPolicy:"cache-and-network"}),y=Wt(),_=n==null?void 0:n.getContractList.data,j=(n==null?void 0:n.getContractList.count)??0,[Q]=kt(),{modalType:U,contextData:w,openModal:A,closeModal:x}=ot(),G=async()=>{if(w)try{await Q({variables:{id:w._id}}),O(),g("primary","none",r("noumena.contract_manager.toast.draft_deleted"))}catch(e){l(e,"contract-manager-delete-contract",!0)}x()},L=C.useCallback((e,u)=>{switch(u){case"VIEW":{f(R(P.CONTRACT_PREVIEW,{id:e._id}));break}case"EDIT":{f(R(P.CONTRACT_EDIT,{id:e._id}));break}case"DELETE":A("delete",e);break;case"DOWNLOAD_PDF":y(e._id,K.formatPdfFileName(e));break;default:console.log("Unsupported action",u,"on document",e)}},[y,f,A]),H=C.useMemo(()=>[{id:"title",title:r("noumena.contracts.title"),renderValue:e=>k(et,{children:[a(rt,{type:S.Contract,style:{marginRight:8},"data-test":"columns-DocumentTypeTag"}),a(Y,{font:"footnote-bold",color:"--text-card-neutral-highlighted","data-test":"columns-TSpan",children:e.title})]}),wordWrap:!1},{id:"status",title:r("noumena.contracts.status"),renderValue:e=>a(it,{status:e.status,size:"small",contentFont:"footnote-bold","data-test":"columns-DocumentStatusTag"}),width:"10%"},{id:"buyer",title:r("noumena.contracts.buyer"),renderValue:e=>e.buyer?z.formatCompanyAndName(e.buyer):"",width:"20%",wordWrap:!1},{id:"serviceProvider",title:r("noumena.contracts.service_provider"),renderValue:e=>e.seller?z.formatCompanyAndName(e.seller):"",width:"20%",wordWrap:!1},{id:"effectiveDate",title:r("noumena.contracts.effective_date"),renderValue:e=>e.effectiveDate?lt(ct.parseDateString(e.effectiveDate)):"--",width:"10%"},{id:"actions",title:"",renderValue:e=>a(m.ActionsMenu,{onClick:u=>L(e,u),menuOptions:W([d.canSeeSummary(e)?{key:"view",label:r("noumena.contract_manager.action.view"),value:"VIEW",iconName:"eye_on_m"}:void 0,d.canDownloadPdf(e)?{key:"download_pdf",label:r("noumena.contract_manager.action.download_pdf"),value:"DOWNLOAD_PDF",iconName:"download_m"}:void 0,d.canAmend(e)?{key:"amend",label:r("noumena.contract_manager.action.amend"),value:"AMEND",iconName:"repeat_xs"}:void 0,d.canEdit(e)?{key:"edit",label:r("noumena.contract_manager.action.edit"),value:"EDIT",iconName:"edit_m"}:void 0,d.canDelete(e)?{key:"delete",label:r("noumena.contract_manager.action.delete"),value:"DELETE",iconName:"delete_m",intent:"danger"}:void 0])}),width:"10%"}],[d,L,r]);return k(v,{gap:24,vertical:!0,align:"stretch","data-test":"Stack",children:[a(m.Table,{keyExtractor:e=>e._id,data:W(_),columns:H,rowsPerPage:5,loading:s,enableRowSelection:c,wordWrap:!0}),a(m.Footer,{leftElement:a(m.Pagination,{totalCount:j,itemsPerPage:5,currentOffset:t,onChange:h}),rightElement:c&&a(m.BulkAction,{label:r("noumena.contracts.cta.download"),rightIcon:a(D,{name:"download_m",size:24,"data-test":"Icon"}),onClick:e=>p(`QA Note: Not implemented. Would download ${e.length} items.`)})}),a(st,{isOpen:U==="delete",isDraft:K.isDraft(w),documentName:(w==null?void 0:w.title)??"",documentType:S.Contract,onCancel:x,onDelete:G,"data-test":"DeleteDocumentConfirmationModal"})]})}const Gt=N(v).attrs(()=>({vertical:!0,align:"stretch"}))`
  ${X}
`,Ht=N(Y).attrs(()=>({font:"body-m-bold",color:"--text-card-neutral-highlighted"}))`
  ${X}
`,qt=N(v).attrs(()=>({gap:2,justify:"stretch"}))`
  cursor: pointer;
  color: var(--text-card-neutral-highlighted);
  ${vt.footnote};
`,Kt=N(b).attrs(()=>({shrink:1}))`
  ${X}
`,Yt=N(b).attrs(()=>({shrink:0}))``,V={StatementOfWorkItemTitleContainer:Gt,StatementOfWorkItemTitle:Ht,StatementOfWorkItemContractContainer:qt,StatementOfWorkItemContractTitle:Kt,StatementOfWorkItemContractNumber:Yt};function Xt({statementOfWork:t}){var o,i;return k(v,{gap:8,align:"center",justify:"stretch","data-test":"Stack",children:[a(rt,{type:S.Sow,"data-test":"DocumentTypeTag"}),k(V.StatementOfWorkItemTitleContainer,{children:[a(V.StatementOfWorkItemTitle,{children:t.title}),((o=t.linkedContract)==null?void 0:o.title)&&a(At,{to:St.viewContract({id:t.linkedContract._id}),"data-test":"RouterLink",children:k(V.StatementOfWorkItemContractContainer,{children:[a(V.StatementOfWorkItemContractTitle,{children:(i=t.linkedContract)==null?void 0:i.title}),k(V.StatementOfWorkItemContractNumber,{shrink:0,children:["(",K.formatDocumentNumber(t.linkedContract.contractNumber),")"]})]})})]})]})}function Jt({offset:t,filters:o,listPerspective:i,enableBulkDownload:c,onPaginationChange:h}){const{navigateAndSetOrigin:p}=dt(),{addPrimaryIconToast:g,addToast:r}=at(),{t:l}=$(),{logError:f}=nt(),{modalType:d,contextData:n,openModal:s,closeModal:O}=ot(),y=Pt(),{data:_,loading:j,refetch:Q}=yt({variables:{limit:5,offset:t,filter:Ft(o),viewingAs:i},fetchPolicy:"cache-and-network"}),U=_==null?void 0:_.getAllSOW.data,w=(_==null?void 0:_.getAllSOW.count)??0,A=Nt(),[x]=bt(),G=async()=>{if(n)try{await x({variables:{id:n._id}}),Q(),r("primary","none",l("noumena.contract_manager.toast.draft_deleted"))}catch(e){f(e,"contract-manager-delete-sow",!0)}O()},L=C.useCallback((e,u)=>{switch(u){case"VIEW":{p(R(P.STATEMENT_OF_WORK_PREVIEW,{id:e._id}));break}case"EDIT":{p(R(P.STATEMENT_OF_WORK_EDIT,{id:e._id}));break}case"DELETE":s("delete",e);break;case"DOWNLOAD_PDF":A(e._id,Z.formatPdfFileName(e));break;default:console.log("Unsupported action",u,"on document",e)}},[A,p,s]),H=C.useMemo(()=>[{id:"title",title:l("noumena.contracts.title"),renderValue:e=>a(Xt,{statementOfWork:e,"data-test":"columns-StatementOfWorkTitleCell"}),wordWrap:!1},{id:"status",title:l("noumena.contracts.status"),renderValue:e=>a(it,{status:e.status,size:"small",contentFont:"footnote-bold","data-test":"columns-DocumentStatusTag"}),width:"10%"},{id:"buyer",title:l("noumena.contracts.buyer"),renderValue:e=>{var u,T;return(u=e.linkedContract)!=null&&u.buyer?z.formatCompanyAndName((T=e.linkedContract)==null?void 0:T.buyer):""},width:"20%",wordWrap:!1},{id:"serviceProvider",title:l("noumena.contracts.service_provider"),renderValue:e=>{var u,T;return(u=e.linkedContract)!=null&&u.seller?z.formatCompanyAndName((T=e.linkedContract)==null?void 0:T.seller):""},width:"20%",wordWrap:!1},{id:"effectiveDate",title:l("noumena.contracts.effective_date"),renderValue:e=>{var u,T;return(u=e.linkedContract)!=null&&u.effectiveDate?lt(ct.parseDateString((T=e.linkedContract)==null?void 0:T.effectiveDate)):"--"},width:"10%"},{id:"actions",title:"",renderValue:e=>a(m.ActionsMenu,{onClick:u=>L(e,u),menuOptions:W([y.canSeeSummary(e)?{key:"view",label:l("noumena.contract_manager.action.view"),value:"VIEW",iconName:"eye_on_m"}:void 0,y.canDownloadPdf(e)?{key:"download_pdf",label:l("noumena.contract_manager.action.download_pdf"),value:"DOWNLOAD_PDF",iconName:"download_m"}:void 0,y.canAmend(e)?{key:"amend",label:l("noumena.contract_manager.action.amend"),value:"AMEND",iconName:"repeat_xs"}:void 0,y.canEdit(e)?{key:"edit",label:l("noumena.contract_manager.action.edit"),value:"EDIT",iconName:"edit_m"}:void 0,y.canDelete(e)?{key:"delete",label:l("noumena.contract_manager.action.delete"),value:"DELETE",iconName:"delete_m",intent:"danger"}:void 0])}),width:"10%"}],[y,L,l]);return k(v,{gap:24,vertical:!0,align:"stretch","data-test":"Stack",children:[a(m.Table,{keyExtractor:e=>e._id,data:W(U),columns:H,rowsPerPage:5,loading:j,enableRowSelection:c,wordWrap:!0}),a(m.Footer,{leftElement:a(m.Pagination,{totalCount:w,itemsPerPage:5,currentOffset:t,onChange:h}),rightElement:c&&a(m.BulkAction,{label:l("noumena.contracts.cta.download"),rightIcon:a(D,{name:"download_m",size:24,"data-test":"Icon"}),onClick:e=>g(`QA Note: Not implemented. Would download ${e.length} items.`)})}),a(st,{isOpen:d==="delete",isDraft:Z.isDraft(n),documentName:(n==null?void 0:n.title)??"",documentType:S.Sow,onCancel:O,onDelete:G,"data-test":"DeleteDocumentConfirmationModal"})]})}const Zt=N(_t)`
  width: 100%;
  padding: 24px;
  overflow: visible;
`,te={PageCard:Zt};function ee(){const[t,o]=Tt(),i={noumId:t.get("noumId")??void 0,type:t.get("type")??void 0,status:t.get("status")??void 0,perspective:t.get("perspective")??void 0},c=C.useCallback(({type:h,perspective:p})=>{o(B.pickBy({type:h,perspective:p},Boolean),{replace:!0})},[o]);return{searchParams:i,updateSearchParams:c}}function Ve(){const t=It(),{searchParams:o,updateSearchParams:i}=ee(),[c,h]=C.useState(Mt(o)),[p,g]=C.useState(0),r=C.useMemo(()=>B.debounce(d=>{g(0),h(d),i(d)},500),[i]),l=()=>{t(P.CONTRACT_CREATE)},f=()=>{t(P.STATEMENT_OF_WORK_CREATE)};return a(Ot,{type:"Contracts",onGoBack:()=>t(-1),"data-test":"ListLayout",children:a(v,{gap:24,"data-test":"Stack",children:a(te.PageCard,{children:a(m.Provider,{data:[],children:k(v,{vertical:!0,align:"stretch","data-test":"Stack",children:[a(m.Filters,{defaultValues:c,onSubmit:r,clearRowSelectionOnSubmit:!0,children:a(v,{gap:24,vertical:!0,align:"stretch","data-test":"Stack",children:a(Qt,{onCreateContract:l,onCreateStatementOfWork:f,"data-test":"ListHeader"})})}),c.type===S.Contract?a(Ut,{offset:p,filters:c,listPerspective:c.perspective,onPaginationChange:d=>g(d.offset),enableBulkDownload:!1,"data-test":"ContractsList"}):a(Jt,{offset:p,filters:c,listPerspective:c.perspective,onPaginationChange:d=>g(d.offset),enableBulkDownload:!1,"data-test":"StatementOfWorkList"})]})})})})})}export{Ve as default};
//# sourceMappingURL=ContractManager-2f76b670.js.map
