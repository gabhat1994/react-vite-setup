{"version":3,"file":"index-02660f89.js","sources":["../../src/screens/Onboarding/MoreInfomation/styles.ts","../../src/screens/Onboarding/MoreInfomation/index.tsx"],"sourcesContent":["import styled from 'styled-components';\nimport { Button } from '@/components/Button';\nimport { TSpan } from '@/components/Typography';\nimport { sizes } from '@/constants/devices';\n\nexport const HeadTag = styled(TSpan)`\n  background: var(--bg-tag-brand-secondary-default);\n  width: 204px;\n  height: 22px;\n  padding: 4px 8px 4px 8px;\n  border-radius: 8px;\n  @media (max-width: ${sizes.MOBILE_L}) {\n    margin-top: 16px;\n  }\n  margin-top: 68px;\n`;\n\nexport const FieldDescription = styled(TSpan)`\n  margin-top: 16px;\n`;\n\nexport const Title = styled(TSpan)`\n  width: 100%;\n`;\n\nexport const Description = styled(TSpan)`\n  width: 100%;\n  margin-top: 8px;\n`;\n\nexport const ContinueButton = styled(Button)`\n  margin-top: 20px;\n  width: 100%;\n  margin-bottom: 20px;\n`;\n","import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useNavigate } from 'react-router';\nimport { type Transition } from 'history';\nimport { Stack } from '@/layout';\nimport { useAuth } from '@/features/auth/contexts';\nimport { useToast, useWindowDimensions } from '@/hooks';\nimport { breakpoints } from '@/constants/devices';\nimport { TextArea } from '@/components/TextArea';\nimport { isValidURL, getSocialNameFromLink } from '@/utils/url';\nimport {\n  useSendNeedMoreInfoEmailMutation,\n  useUpdateUserProfileMutation,\n} from '@/apollo/graphql';\nimport routes from '@/constants/routes';\nimport EVENTS from '@/constants/trackingEvents';\nimport { trackEvent } from '@/utils/tracking';\nimport { TextField } from '@/components/TextField';\nimport { OnboardingScreenLayout } from '@/screens/Register/OnboardingScreenLayout';\nimport useBlocker from '@/hooks/useBlocker';\nimport {\n  Title,\n  Description,\n  ContinueButton,\n  HeadTag,\n  FieldDescription,\n} from './styles';\n\nexport const MoreInfo = () => {\n  const { width } = useWindowDimensions();\n  const isMobile = useMemo(() => width <= breakpoints.MOBILE_MAX, [width]);\n  const [link, setLink] = useState<string>('');\n  const [answer, setAnswer] = useState<string>();\n  const [linkError, setLinkError] = useState<boolean>(false);\n  const [answerError, setAnswerError] = useState<boolean>(false);\n  const [isSubmit, setIsSubmit] = useState<boolean>(false);\n  const navigate = useNavigate();\n  const { addToast } = useToast();\n  const [updateProfile, { loading }] = useUpdateUserProfileMutation();\n  const { t } = useTranslation();\n  const { user, refetchUserData, currentUserLoading } = useAuth();\n  const [triggerMoreInfoEmail] = useSendNeedMoreInfoEmailMutation();\n  const TEXT_LIMIT = 1000;\n  const tx = useRef<Transition>();\n\n  const userEventData = useMemo(() => ({ UUID: user?._id }), [user]);\n  const isValidInput = useMemo(() => {\n    if (\n      (answer && answer?.length > TEXT_LIMIT) ||\n      (link && !isValidURL(link)) ||\n      (!answer && !link)\n    ) {\n      return false;\n    }\n    return true;\n  }, [link, answer]);\n\n  useEffect(() => {\n    const handleTabClose = (event: Event) => {\n      /* need to call new API endpoint for mail triggering\n         only when user has submitted data for more info and closing the tab\n      */\n      if (!isSubmit) {\n        event.preventDefault();\n        triggerMoreInfoEmail();\n      }\n    };\n\n    window.addEventListener('beforeunload', handleTabClose);\n\n    return () => {\n      window.removeEventListener('beforeunload', handleTabClose);\n    };\n  }, [isSubmit, triggerMoreInfoEmail]);\n\n  const handleBlockNavigation = useCallback((transition: Transition) => {\n    tx.current = transition;\n    transition.retry();\n  }, []);\n  useBlocker(handleBlockNavigation, !isSubmit);\n\n  const handleSubmit = useCallback(() => {\n    if (!isValidInput) {\n      return;\n    }\n    trackEvent(EVENTS.ONBOARDING.MORE_VERIFICATION.SUBMIT);\n    setIsSubmit(true);\n    updateProfile({\n      variables: {\n        input: {\n          additionalInfo: answer || undefined,\n          ...(link.length\n            ? {\n                profile: {\n                  socialLinks: link\n                    ? [\n                        {\n                          name: getSocialNameFromLink(link)?.includes('www')\n                            ? 'www1'\n                            : getSocialNameFromLink(link),\n                          link,\n                        },\n                      ]\n                    : undefined,\n                },\n              }\n            : {}),\n        },\n      },\n    })\n      .then((res) => {\n        if (res?.data?.updateUserProfile) {\n          refetchUserData();\n          if (!loading && !currentUserLoading) navigate(routes.SIGNUP_PENDING);\n        }\n      })\n      .catch(() => {\n        addToast(\n          'error',\n          'icon',\n          `${t('noumena.onboarding_profile_update_error')}`,\n        );\n      });\n  }, [\n    isValidInput,\n    updateProfile,\n    answer,\n    link,\n    refetchUserData,\n    loading,\n    currentUserLoading,\n    navigate,\n    addToast,\n    t,\n  ]);\n\n  return (\n    <OnboardingScreenLayout>\n      <Stack vertical align=\"start\" gap={8} maxWidth={344}>\n        <HeadTag\n          colorToken=\"--text-tag-brand-primary-default\"\n          font=\"body-m-bold\"\n        >\n          {t('noumena.onboarding.more_info_additional_verification')}\n        </HeadTag>\n        <Title\n          colorToken=\"--text-body-header-neutral-default\"\n          font={isMobile ? 'heading-s-bold' : 'heading-m-bold'}\n        >\n          {t('noumena.onboarding.more_info_title')}\n        </Title>\n        <Description colorToken=\"--text-body-neutral-default\" font=\"body-l\">\n          {t('noumena.onboarding.more_info_description')}\n        </Description>\n\n        <FieldDescription\n          colorToken=\"--text-tablecell-header-neutral-highlighted\"\n          font=\"body-l-bold\"\n        >\n          {t('noumena.onboarding.more_info_answer_description')}\n        </FieldDescription>\n        <TextArea\n          showScroll\n          label={t('noumena.onboarding.more_info_answer_label')}\n          resize={false}\n          value={answer}\n          maxLength={TEXT_LIMIT}\n          maxHeight={300}\n          onChange={(e) => {\n            setAnswer(e.target.value);\n            if (e.target.value.length > TEXT_LIMIT) {\n              setAnswerError(true);\n            } else {\n              setAnswerError(false);\n            }\n          }}\n          error={answerError}\n          onFocus={() =>\n            trackEvent(\n              EVENTS.ONBOARDING.MORE_VERIFICATION.TELL_US_MORE,\n              userEventData,\n            )\n          }\n        />\n\n        <FieldDescription\n          colorToken=\"--text-tablecell-header-neutral-highlighted\"\n          font=\"body-l-bold\"\n        >\n          {t(`noumena.onboarding.more_info_answer_link_description`)}\n        </FieldDescription>\n        <TextField\n          helperText={t('noumena.onboarding.more_info_answer_link_helper_text')}\n          placeholder={t(\n            'noumena.onboarding.more_info_answer_link_placeholder',\n          )}\n          value={link}\n          onChange={(e) => {\n            setLink(e.target.value);\n            if (!e.target.value) {\n              setLinkError(false);\n              return;\n            }\n            if (isValidURL(e.target.value)) {\n              setLinkError(false);\n            } else {\n              setLinkError(true);\n            }\n          }}\n          error={linkError}\n          onFocus={() =>\n            trackEvent(EVENTS.ONBOARDING.MORE_VERIFICATION.LINK, userEventData)\n          }\n        />\n\n        <ContinueButton\n          primary={isValidInput}\n          testId=\"submit_button\"\n          onClick={handleSubmit}\n          disabled={!isValidInput}\n          loading={loading}\n        >\n          {t('noumena.submit')}\n        </ContinueButton>\n      </Stack>\n    </OnboardingScreenLayout>\n  );\n};\nexport default MoreInfo;\n"],"names":["HeadTag","styled","TSpan","sizes","MOBILE_L","FieldDescription","Title","Description","ContinueButton","Button","MoreInfo","width","useWindowDimensions","isMobile","useMemo","breakpoints","MOBILE_MAX","link","setLink","useState","answer","setAnswer","linkError","setLinkError","answerError","setAnswerError","isSubmit","setIsSubmit","navigate","useNavigate","addToast","useToast","updateProfile","loading","useUpdateUserProfileMutation","t","useTranslation","user","refetchUserData","currentUserLoading","useAuth","triggerMoreInfoEmail","useSendNeedMoreInfoEmailMutation","TEXT_LIMIT","tx","useRef","userEventData","UUID","_id","isValidInput","length","isValidURL","useEffect","handleTabClose","event","preventDefault","addEventListener","removeEventListener","handleBlockNavigation","useCallback","transition","current","retry","handleSubmit","EVENTS","ONBOARDING","MORE_VERIFICATION","SUBMIT","variables","input","additionalInfo","undefined","profile","socialLinks","name","getSocialNameFromLink","includes","then","res","data","updateUserProfile","routes","SIGNUP_PENDING","catch","jsx","OnboardingScreenLayout","Stack","TextArea","e","target","value","trackEvent","TELL_US_MORE","TextField","LINK"],"mappings":"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"}