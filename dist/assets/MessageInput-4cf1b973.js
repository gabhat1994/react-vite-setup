import{iV as A,c as C,jM as H,j as t,jN as R,jO as D,jP as O,I as h,ef as _,ee as S,hh as $,jQ as K,jR as G,cI as N,jS as Q,F as X,jT as Y,jU as Z,jV as q,b1 as J,jW as ee,jX as te,jY as se,jZ as ae}from"./index-cd84bcc9.js";import{r as s,ar as ne}from"./vendor-51460554.js";const oe=({file:r,index:m,onRemoveFile:u})=>{const[I,p]=s.useState(!1),[f,d]=s.useState(!1),i=A(r.type),n=s.useMemo(()=>URL.createObjectURL(r),[r]),l=()=>p(!0),o=()=>p(!1),c=s.useCallback(()=>u==null?void 0:u(m),[m,u]);return C(H,{onMouseEnter:l,onMouseLeave:o,"data-test":"PreviewFile-PreviewFileWrapper",children:[i==="image"&&t(R,{"data-testid":"preivew-image",src:n,alt:"",onClick:()=>d(!0),"data-test":"PreviewFile-PreivewImage"}),i==="video"&&t(D,{"data-testid":"preivew-video",autoPlay:!0,loop:!0,muted:!0,onClick:()=>d(!0),"data-test":"PreviewFile-PreviewVideo",children:t("source",{src:n,type:r.type,"data-test":"PreviewFile-source"})}),t(O,{isControl:I,onClick:c,"data-test":"PreviewFile-RemoveFileWrapper",children:t(h,{name:"clear_m",size:20,color:"--icon-button-neutral-pressed","data-test":"PreviewFile-Icon"})}),t(_,{url:n||"",isOpen:f,type:i==="video"?S.VIDEO:S.IMAGE,contentType:r.type,handleClose:()=>d(!1),"data-test":"PreviewFile-LightBox"})]})},le=({withLeftPadding:r,onSendMessage:m,disabled:u})=>{const{t:I}=ne(),p=s.useRef(null),{activeConversationSid:f}=s.useContext($),[d,i]=s.useState(!1),[n,l]=s.useState(""),[o,c]=s.useState([]),[P,M]=s.useState(!1),b=P||!!n.trim()||o.length>0,[k,v]=s.useState(!1),y=s.useCallback(e=>{e&&c(a=>[...a,e])},[]),x=s.useCallback(e=>{c(a=>K(a,e))},[]),W=e=>l(e.target.value),E=e=>{var g,w;const a=((g=p.current)==null?void 0:g.selectionStart)||0;l(F=>{const U=F.substring(0,a),V=F.substring(a);return`${U}${e}${V}`}),v(!1),(w=p.current)==null||w.focus()},T=s.useCallback(()=>{M(!0),v(!1)},[]),B=()=>M(!1),j=s.useCallback(async()=>{if(d)return;i(!0);const e=n.trim();if(!e&&!o.length){l(""),i(!1);return}await m(e,o),c([]),l(""),i(!1)},[d,n,o,m]),L=s.useCallback(e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),j())},[j]);s.useEffect(()=>{c([]),l("")},[f]);const z=e=>{if(e.clipboardData.files.length){const a=e.clipboardData.files[0];c(g=>[...g,a])}};return t(G,{"data-test":"MessageInput-Wrapper",children:t(N,{acceptedFileTypes:Q,uploadToS3:!1,onUploadFile:y,"data-test":"MessageInput-Upload",children:({onClickHandler:e})=>C(X,{children:[t(Y,{withLeftPadding:r,"data-test":"MessageInput-FileChooserWrapper",children:t(h,{name:"picture_m",size:24,onClick:e,color:"--icon-button-neutral-default","data-test":"MessageInput-Icon"})}),C(Z,{active:b,"data-test":"MessageInput-InputWrapper",children:[t(q,{"data-test":"MessageInput-FilesWrapper",children:o.map((a,g)=>a&&t(oe,{file:a,index:g,onRemoveFile:x,"data-test":"MessageInput-PreviewFile"},a.name))}),t(J,{ref:p,disabled:u,value:n,placeholder:I("noumena.message.input_placeholder"),noBorder:!0,autoResize:!0,showScroll:!0,hasRightIcon:!0,resize:!1,maxHeight:136,lineHeight:"130%",onChange:W,onFocus:T,onBlur:B,onKeyDown:L,onPaste:z,"data-test":"MessageInput-TextArea"}),t(ee,{onClick:()=>v(a=>!a),icon:t(h,{color:"--icon-button-neutral-default",name:"emoji_m",size:24,"data-test":"MessageInput-Icon"}),size:"small","data-test":"MessageInput-EmojiButton"})]}),k&&t(te,{"data-test":"MessageInput-EmojiContainer",children:t(se,{onSelect:E,scrollHeight:"220px","data-test":"MessageInput-SlackSelector"})}),t(ae,{active:!!n.trim()||o.length>0,"data-test":"MessageInput-SendButtonWrapper",children:t(h,{name:"send_m",size:24,color:"--icon-button-neutral-pressed",onClick:j,"data-test":"MessageInput-Icon"})})]})})})};export{le as M};
//# sourceMappingURL=MessageInput-4cf1b973.js.map
