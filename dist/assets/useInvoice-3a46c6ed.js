import{es as b,bb as w,bc as _,b6 as A,j_ as U,j$ as V,k0 as Y,k1 as k,k2 as x,Y as L,ba as B,k3 as G,P as z}from"./index-cd84bcc9.js";import{b4 as l,be as H,r as I}from"./vendor-51460554.js";import{D as o,L as D}from"./types-3fb18ef5.js";const F=e=>{var t;if(e.dueDate===o.CUSTOM_DATE)return e.customDueDate?(t=e.customDueDate)==null?void 0:t.toISOString():null;switch(e.dueDate){case o.TODAY:return new Date().toISOString();case o.TOMORROW:return l(new Date,1).toISOString();case o.SEVEN_DAYS:return l(new Date,7).toISOString();case o.FOURTEEN_DAYS:return l(new Date,14).toISOString();case o.THIRTY_DAYS:return l(new Date,30).toISOString();case o.FORTY_FIVE_DAYS:return l(new Date,45).toISOString();case o.SIXTY_DAYS:return l(new Date,60).toISOString();case o.NINETY_DAYS:return l(new Date,90).toISOString();default:return}},E=e=>{switch(e){case D.FIXED_AMOUNT:return b.Value;case D.PERCENTAGE:return b.Percentage;case D.NO_LATE_FEE:return null;default:return null}},Q=e=>{switch(e){case b.Percentage:return D.PERCENTAGE;case b.Value:return D.FIXED_AMOUNT;default:return D.NO_LATE_FEE}},N=e=>((e==null?void 0:e.lineItems)||[]).map(t=>({taxRate:t.taxRate,taxLabel:t.taxName,currency:t.currency,description:t.description,quantity:t.quantity,unitPrice:t.unitPrice})),X=e=>{var t;return{lineItems:N(e),currency:e.currency,noumId:e.noumId,dueDate:F(e),issueDate:(t=e.issueDate)==null?void 0:t.toISOString(),lateFeeType:E(e.lateFeeType)??void 0,lateFeeValue:e.lateFeeValue??void 0,notes:e.notes,paymentTerms:e.paymentTerms,invoiceFrom:e.serviceProviderId||void 0,invoiceTo:e.buyerId||void 0,invoiceNumber:e.invoiceNumber,logoUrl:e.logo,summary:e.summary}},j=e=>{var t;return{lineItems:N(e),currency:e.currency,noumId:e.noumId,dueDate:F(e),issueDate:(t=e.issueDate)==null?void 0:t.toISOString(),lateFeeType:E(e.lateFeeType),lateFeeValue:e.lateFeeValue??null,notes:e.notes,paymentTerms:e.paymentTerms,invoiceFrom:e.serviceProviderId||null,invoiceTo:e.buyerId||null,invoiceNumber:e.invoiceNumber,logoUrl:e.logo||null,summary:e.summary}},W=e=>{var t,s,u,i;return{id:e.id??void 0,lineItems:(t=e.lineItems)==null?void 0:t.map(r=>({currency:r==null?void 0:r.currency,description:r==null?void 0:r.description,id:r==null?void 0:r.id,quantity:r==null?void 0:r.quantity,taxRate:r==null?void 0:r.taxRate,unitPrice:r==null?void 0:r.unitPrice,taxName:r==null?void 0:r.taxLabel})),currency:e.currency??w.Usd,noumId:((s=e.noumId)==null?void 0:s._id)??void 0,dueDate:e.dueDate?o.CUSTOM_DATE:o.SEVEN_DAYS,customDueDate:e.dueDate?new Date(e.dueDate):void 0,issueDate:e.issueDate?new Date(e.issueDate):void 0,lateFeeType:Q(e.lateFeeType),lateFeeValue:e.lateFeeValue??void 0,summary:e.summary??void 0,paymentTerms:e.paymentTerms??_.FullPaymentAdvance,buyerId:((u=e.invoiceTo)==null?void 0:u._id)??void 0,serviceProviderId:((i=e.invoiceFrom)==null?void 0:i._id)??void 0,invoiceNumber:e.invoiceNumber??void 0,logo:e.logoUrl??void 0,notes:e.notes??void 0,status:e.status??A.Draft}},q=({id:e,noumId:t})=>({id:e,noumId:t,buyerId:void 0,serviceProviderId:void 0,lineItems:[],currency:w.Usd,dueDate:o.TOMORROW,issueDate:new Date,customDueDate:void 0,paymentTerms:_.FullPaymentAdvance,lateFeeType:D.NO_LATE_FEE,lateFeeValue:void 0,logo:void 0,notes:void 0,invoiceNumber:void 0,status:A.Draft,buyerDetailsComplete:!1,serviceProviderDetailsComplete:!1}),g={toDraftInput:X,fromInvoice:W,toUpdateInvoiceInput:j,getDefaultValues:q,serializeDueDate:F,mapFromLateFeeOption:E};function $({onCreated:e,invoiceId:t}){const[s]=U(),[u]=V(),[i]=Y(),[r]=k(),[f]=x(),T=H(),{logError:n}=L(),p=I.useCallback(async a=>{var c;if(a!=null&&a.noumId)try{const y=await s({variables:{input:g.toDraftInput({noumId:a.noumId,...a})},update:(C,R)=>{var O;const m=(O=R.data)==null?void 0:O.createInvoiceDraft;m!=null&&m.id&&C.writeQuery({query:B,variables:{id:m.id},data:{getInvoiceById:m}})},onCompleted:()=>{T.refetchQueries({include:[G]})}}),S=(c=y==null?void 0:y.data)==null?void 0:c.createInvoiceDraft;S!=null&&S.id&&(e==null||e(S))}catch(y){throw n(y,"useInvoice",!1),y}},[T,s,n,e]),d=I.useCallback(async a=>{if(!(!(a!=null&&a.noumId)||!t))try{const c=g.toUpdateInvoiceInput({noumId:a.noumId,...a});await u({variables:{id:t,input:c}})}catch(c){throw n(c,"useInvoice",!1),c}},[t,n,u]),h=I.useCallback(async a=>t?d(a):p(a),[p,t,d]),P=I.useCallback(async()=>{if(t)try{await i({variables:{id:t}})}catch(a){throw n(a,"useInvoice",!1),a}},[i,t,n]),M=I.useCallback(async()=>{if(t)try{await r({variables:{id:t}})}catch(a){throw n(a,"useInvoice",!1),a}},[t,n,r]),v=I.useCallback(async()=>{var a;if(!t)return null;try{return(a=(await f({variables:{invoiceId:t}})).data)==null?void 0:a.duplicateInvoice}catch(c){throw n(c,"useInvoice",!1),c}},[f,t,n]);return{createDraft:p,updateInvoice:d,saveDraft:h,deleteInvoice:P,sendInvoice:M,duplicateInvoice:v}}function ee({onCreated:e,onLoad:t,invoiceId:s}){const[u,i]=I.useState(!1),{data:r,loading:f,refetch:T}=z({variables:{id:s},skip:!s,onCompleted:d=>{u||(t==null||t((d==null?void 0:d.getInvoiceById)??void 0),i(!0))},fetchPolicy:"cache-and-network"}),n=r==null?void 0:r.getInvoiceById,p=$({invoiceId:s,onCreated:e});return{invoiceId:s,invoice:n,loading:f,refetchInvoice:T,...p}}export{g as I,$ as a,ee as u};
//# sourceMappingURL=useInvoice-3a46c6ed.js.map
