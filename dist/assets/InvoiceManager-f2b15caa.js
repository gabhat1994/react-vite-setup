import{x as m,T as F,c as p,j as e,y as W,qv as O,aC as V,qw as ie,I as R,kp as Te,U as re,au as ce,b3 as Me,a2 as xe,B as P,b6 as S,qx as Fe,qy as L,X as Z,ae as we,M as Re,t as De,h as Ae,i as Ne,aQ as ue,b1 as Pe,k as Ee,R as B,f as _e,F as U,v as Ve,Y as Oe,qz as Le,qA as ze,k0 as We,aR as Be,qB as me,qC as Ue,n as $e}from"./index-cd84bcc9.js";import{C as g,r as y,l as _,N as Q,L as le,ag as He,ah as je,cJ as qe,ac as Ge,a9 as ee,b2 as X}from"./vendor-51460554.js";import{D as b}from"./index-022aaf3d.js";import{L as Ke}from"./index-c8a663c0.js";import{B as Qe,P as Xe}from"./index-4963229a.js";import{I as Y}from"./invoice-e39dbdbc.js";import{M as q}from"./MultiselectField-a1e665cb.js";import{C as Ye}from"./CustomDateInputMaskField-46ce4df4.js";import{d as Je}from"./styles-e426deab.js";import{u as Ze,C as et,M as tt}from"./MakeInvoicePaymentWizard-83291728.js";import{D as at,a as nt}from"./DeleteDraftModal-e41d0b22.js";import{u as ot,a as pe,I as he}from"./useInvoicePdfDownload-84ddf906.js";import{a as it}from"./useInvoice-3a46c6ed.js";import{A as $}from"./payloadParser-f4cc4e4f.js";import{f as H}from"./getTimeStampForDisplaying-22d5ca9d.js";import{u as rt}from"./styles-26e8a352.js";import"./Pagination-43542d57.js";import"./TickCheckbox-c4d9d4b6.js";import"./Accordion-ea03839b.js";import"./useResizeObserver-0deb9469.js";import"./sideNavItems-22800105.js";import"./index-2d186805.js";import"./storyblok-c16fb040.js";import"./styles-3ceda759.js";import"./Modal-5a254f40.js";import"./types-3fb18ef5.js";import"./useElementDimensions-84b2a778.js";import"./utils-87d126b1.js";import"./browser-f98ef106.js";import"./Radiobox-c1e62033.js";import"./forms-18e3c53a.js";import"./Infobox-cf6af02b.js";import"./index-594821a1.js";import"./helper-53a5becb.js";import"./OtpInput-6d75f9c8.js";import"./done-439b31ee.js";import"./SetupPin-06f1ecff.js";const lt=g(m)`
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  position: relative;
`,st=g.div`
  width: ${({width:t})=>t}px;
`,dt=g(Qe)``,se={Container:lt,PopoverContainer:st,PopoverContent:dt},ct=g(m)`
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  position: relative;
`,ut=g.div`
  box-sizing: border-box;
  display: flex;
  padding: 16px 0;
  width: 100%;
  position: relative;
`,mt=g.div`
  display: grid;
  grid-template-columns: 1fr 1fr;
  column-gap: 20px;
  padding: 16px 0 0 0;
`,pt=g.input`
  pointer-events: none;
  position: absolute;
  height: 0px;
  width: 100%;
  z-index: 4;

  ::-webkit-slider-thumb {
    appearance: none;
    cursor: pointer;
    height: 20px;
    width: 20px;
    margin-top: 6px;
    border-radius: 50%;
    pointer-events: all;
    position: relative;
    outline: 2px solid var(--color-base-primary-main);
    box-shadow: inset 0 0 0 30px #fff;
  }
`,ht=g.div`
  position: relative;
  width: 100%;
`,ft=g.div.attrs(t=>({style:{left:`${t.left}%`,width:`${t.rangeWidth}%`}}))`
  position: absolute;
  border-radius: 4px;
  height: 10px;
  background-color: var(--color-base-primary-main);
  z-index: 2;
`,vt=g.div`
  position: absolute;
  border-radius: 4px;
  height: 10px;
  background-color: var(--bg-progressbar-neutral-default);
  width: 100%;
  z-index: 1;
`,gt=g.div`
  background-color: var(--bg-tag-brand-secondary-default);
  border-radius: 8px;
  padding: 4px;
  height: 22px;
  position: absolute;
  left: ${({offsetLeft:t})=>t}px;
`,It=g(F).attrs({font:"footnote-bold",colorToken:"--text-tag-brand-primary-default"})``,yt=g(m).attrs({fullWidth:!0})`
  position: relative;
  margin-top: 8px;
  min-height: 32px;
`,D={CustomStack:ct,InputContainer:ut,TextContainer:mt,CustomInput:pt,Slider:ht,Range:ft,SliderTrack:vt,ValueLabel:It,LabelContainer:gt,LabelsWrapper:yt},Ct=({min:t,max:r,value:n,minValueSuffix:i="",maxValueSuffix:a="",onChange:c})=>{const u=d=>(d-t)/(r-t)*100,l=d=>{let h=Math.min(+d.target.value,n.max-1);h=Math.max(h,t),c({min:h,max:n.max})},f=d=>{let h=Math.max(+d.target.value,n.min+1);h=Math.min(h,r),c({min:n.min,max:h})};return p(D.CustomStack,{fullWidth:!0,"data-testid":"amount-range-field",children:[p(D.TextContainer,{children:[e(W,{value:n.min,max:r,integerOnly:!0,label:"From",isCurrency:!0,inputSize:"small",suffix:i,onChange:l,"data-test":"AmountRangeField-TextField"}),e(W,{value:n.max,integerOnly:!0,inputSize:"small",isCurrency:!0,label:"To",suffix:a,min:t,onChange:f,"data-test":"AmountRangeField-TextField"})]}),p(D.InputContainer,{children:[e(D.CustomInput,{type:"range",min:t,max:r,value:n.min,onChange:l}),e(D.CustomInput,{type:"range",min:t,max:r,value:n.max,onChange:f}),p(D.Slider,{children:[e(D.SliderTrack,{}),e(D.Range,{left:u(n.min),rangeWidth:u(n.max)-u(n.min)+1})]})]})]})},St=({min:t,max:r,value:n,onChange:i,minValueSuffix:a="",maxValueSuffix:c="",renderValue:u,...l})=>{const[f,d]=y.useState(!1);return e(se.Container,{fullWidth:!0,children:e(Xe,{isOpen:f,onClose:()=>d(!1),position:"bottom",renderContent:({childDimensions:h})=>p(se.PopoverContent,{$width:h.width,children:[e(F,{font:"body-m-bold",colorToken:"--text-datepicker-neutral-highlighted","data-test":"AmountRangePopover-TSpan",children:"Select Amount Range"}),e(Ct,{min:t,max:r,value:n,minValueSuffix:a,maxValueSuffix:c,onChange:i,"data-test":"AmountRangePopover-AmountRangeField"})]}),"data-test":"AmountRangePopover-Popover",children:e(W,{value:u,max:r,integerOnly:!0,onFocus:()=>d(!0),inputSize:"small",contentEditable:!1,...l,"data-test":"AmountRangePopover-TextField"})})})};function E(t){return t.length>0?t:null}function bt(t,r,n){const{dateRange:i,amountRange:a,customers:c,invoiceType:u,noums:l,status:f,search:d,limit:h,...T}=t,{from:A,to:v}=i||{},{from:C,to:k}=a||{},G=_.isNumber(C)&&(k===ve||typeof k>"u")?{column:"amount",operator:O.Gte,values:[String(C)]}:_.isNumber(k)&&typeof C>"u"?{column:"amount",operator:O.Lte,values:[String(k)]}:_.isNumber(C)&&_.isNumber(k)?{column:"amount",operator:O.Btwe,values:[String(C),String(k)]}:void 0,K=V([A||v?{column:"issueDate",operator:O.Btwe,values:[A??"",v??""]}:void 0,G]);return{...T,rangeFilter:K,invoiceType:E(u??[]),customers:E(c??[]),noums:E(l??[]),status:E(f??[]),search:E(d??""),limit:h??fe,offset:r,sort:n?{column:n.column,type:kt(n.direction)}:null}}function kt(t){switch(t){case"asc":return ie.Asc;case"desc":return ie.Desc;default:return null}}const fe=10,ve=1e4,j={mapToInvoiceQueryInput:bt,ITEMS_PER_PAGE:fe,AMOUNT_FILTER_MAX_VALUE:ve};function Tt({value:t,onChange:r}){const n={min:(t==null?void 0:t.from)??0,max:(t==null?void 0:t.to)??0},i=u=>{r({from:(u==null?void 0:u.min)??void 0,to:(u==null?void 0:u.max)??void 0})},a=()=>{r({from:void 0,to:void 0})},c=n.max===j.AMOUNT_FILTER_MAX_VALUE?"+":"";return e(St,{value:n,min:0,max:j.AMOUNT_FILTER_MAX_VALUE,label:"Amount Range",maxValueSuffix:c,renderValue:n.min>0||n.max>0?`${Y.formatAmount(n.min)} - ${Y.formatAmount(n.max)}${c}`:"",rightIcon:n.min||n.max?e(R,{name:"clear_m",size:24,color:"--icon-input-brand-primary-default",onClick:a,"data-test":"Icon"}):null,onChange:i,"data-test":"AmountRangePopover"})}function Mt({value:t,onChange:r}){const{data:n,loading:i,fetchMore:a}=Te({variables:{limit:10,offset:0,query:"",status:re.Active}}),c=V(n==null?void 0:n.allNoumsContacts.data),u=(n==null?void 0:n.allNoumsContacts.count)??0,l=()=>{u<=c.length||a({variables:{offset:c.length,limit:10,query:"",status:re.Active},updateQuery(d,{fetchMoreResult:h}){return{...d,allNoumsContacts:{...d.allNoumsContacts,data:[...d.allNoumsContacts.data,...h.allNoumsContacts.data]}}}})},f=y.useMemo(()=>[...c.map(d=>{var h;return{key:d._id,label:d.displayName,type:"value",value:d._id,icon:e(ce,{url:(h=d.user.profile)==null?void 0:h.profilePictureThumbnail,size:"M","data-test":"options-Avatar"})}})],[c]);return e(q,{options:f,maxContainerHeight:"300px",inputSize:"small",renderStickyHeader:()=>{},hideIcons:!1,multiselect:!0,label:"Customers",isLoading:i,value:t,onChange:r,usePortal:!0,renderContainerFromBottom:!0,leftIcon:e(R,{name:"search_m",color:"--icon-input-neutral-default",size:20,"data-test":"Icon"}),onFetchMore:l,"data-test":"MultiselectField"})}const xt=g(m)`
  padding: 16px;
  border-bottom: 1px solid var(--border-card-neutral-default);
`,Ft=g(m)`
  color: var(--text-datepicker-neutral-highlighted);
  padding: 8px 0;
`,wt={DateFieldsContainer:xt,CaptionNavigation:Ft},J="MM/dd/yyyy";function de({value:t,onChange:r,label:n}){const[i,a]=y.useState(()=>t?Q(t,J):"");return e(Ye,{isAlwaysFocus:!1,inputSize:"small",value:i,fullWidth:!0,label:n,onChangeHandler:u=>{const{value:l}=u.target,{isValid:f}=Je(l);f?r(new Date(l)):a(l)},"data-test":"CustomDateInputMaskField"})}function Rt({value:t,onChange:r}){const n=y.useRef(null),i={from:t!=null&&t.from?new Date(t.from):void 0,to:t!=null&&t.to?new Date(t.to):void 0},[a,c]=y.useState(()=>({from:i.from,to:i.to})),u=le(a.from),l=le(a.to),f=u&&l,d=()=>{var v,C;r({from:((v=a==null?void 0:a.from)==null?void 0:v.toISOString())??"",to:((C=a==null?void 0:a.to)==null?void 0:C.toISOString())??""})},h=()=>{c({from:void 0,to:void 0}),r({from:void 0,to:void 0})},T=()=>{var v;d(),(v=n==null?void 0:n.current)==null||v.onClose()},A=i!=null&&i.from&&i.to?`${Q(i.from,J)} - ${Q(i.to,J)}`:"";return e(Me,{rangeValue:a,customDisplayValue:A,fullSize:!0,ref:n,placement:"bottom-end",dateFormat:"MMM dd, yyyy",size:"small",showIcon:!0,mode:"range",onChangeRange:v=>c({from:v!=null&&v.from?He(v.from):void 0,to:v!=null&&v.to?je(v.to):void 0}),label:"Date range",renderCaption:v=>p(m,{vertical:!0,gap:16,"data-test":"Stack",children:[e(F,{font:"body-m-bold",colorToken:"--text-datepicker-neutral-highlighted","data-test":"TSpan",children:"Custom Timeframe"}),p(m,{gap:16,"data-test":"Stack",children:[e(de,{value:a==null?void 0:a.from,label:"Start Date",onChange:C=>c(k=>({...k,from:C})),"data-test":"CustomDateInput"}),e(de,{value:a==null?void 0:a.to,label:"End Date",onChange:C=>c(k=>({...k,to:C})),"data-test":"CustomDateInput"})]}),e(wt.CaptionNavigation,{fullWidth:!0,align:"center",justify:"space-between",children:e(qe,{displayMonth:v,"data-test":"CaptionNavigation"})})]}),renderFooter:()=>p("tfoot",{"data-test":"tfoot",children:[e("tr",{"data-test":"tr",children:e("td",{colSpan:8,"data-test":"td",children:e(xe,{"data-test":"Separator"})})}),e("tr",{"data-test":"tr",children:e("td",{colSpan:8,"data-test":"td",children:e(m,{fullWidth:!0,justify:"end","data-test":"Stack",children:e(P,{disabled:!f,primary:!0,grow:!0,onClick:T,size:"small","data-test":"Button",children:"Select"})})})})]}),customIcon:i.from||i.to?e(R,{name:"clear_m",size:24,color:"--icon-input-brand-primary-default",onClick:h,"data-test":"Icon"}):null,"data-test":"DatePicker"})}function Dt({value:t,onChange:r}){const n=y.useMemo(()=>[{key:S.Draft,value:S.Draft,label:"Draft",type:"value"},{key:S.Cancelled,value:S.Cancelled,label:"Cancelled",type:"value"},{key:S.Issued,value:S.Issued,label:"Open",type:"value"},{key:S.Overdue,value:S.Overdue,label:"Overdue",type:"value"},{key:S.Paid,value:S.Paid,label:"Paid",type:"value"},{key:S.PartiallyPaid,value:S.PartiallyPaid,label:"Partially Paid",type:"value"},{key:S.WriteOff,value:S.WriteOff,label:"Write Off",type:"value"}],[]);return e(q,{inputSize:"small",value:t,options:n,label:"Status",onChange:r,usePortal:!0,renderContainerFromBottom:!0,"data-test":"MultiselectField"})}function At({onChange:t,...r}){const{data:n,loading:i}=Fe({fetchPolicy:"cache-and-network"}),a=y.useMemo(()=>V(n==null?void 0:n.getNoumsLinkedToUserInvoices).map(c=>({type:"value",value:c._id??"",key:c._id??"",label:c.name??"",icon:e(ce,{url:c.profileImage,size:"M","data-test":"options-Avatar"})})),[n]);return e(q,{...r,options:a,hideIcons:!1,isLoading:i,label:"Noums",inputSize:"small",onChange:t,usePortal:!0,renderContainerFromBottom:!0,leftIcon:e(R,{name:"search_m",color:"--icon-input-neutral-default",size:20,"data-test":"Icon"}),"data-test":"MultiselectField"})}function Nt({value:t,onChange:r}){const n=y.useMemo(()=>[{key:L.Issued,label:"Issued",type:"value",value:L.Issued},{key:L.Received,label:"Received",type:"value",value:L.Received}],[]);return e(q,{options:n,maxContainerHeight:"300px",inputSize:"small",renderStickyHeader:()=>{},label:"Type",hideIcons:!0,value:t,onChange:r,usePortal:!0,renderContainerFromBottom:!0,"data-test":"MultiselectField"})}function Pt({onCreateInvoice:t,onFiltersChange:r}){const{isMobile:n}=Z();return e(b.Filters,{defaultValues:{search:"",status:[],noums:[],amountRange:{from:void 0,to:void 0},dateRange:{from:void 0,to:void 0},invoiceType:[],customers:[]},onSubmit:r,clearRowSelectionOnSubmit:!0,children:p(m,{gap:24,vertical:!0,align:"stretch","data-test":"Stack",children:[p(m,{gap:24,justify:"space-between",align:n?"start":"center",vertical:n,fullWidth:!0,"data-test":"Stack",children:[e(m,{fullWidth:!0,"data-test":"Stack",children:e(F,{font:"heading-xs-bold","data-test":"TSpan",children:"Invoice Manager"})}),p(m,{gap:8,justify:"flex-end",align:"center",fullWidth:!0,"data-test":"Stack",children:[e(m,{fullWidth:n,"data-test":"Stack",children:e(b.FilterInput,{name:"search",render:({field:{value:i,onChange:a}})=>e(W,{inputSize:"small",value:i,onChange:a,placeholder:"Search...",leftIcon:e(R,{name:"search_m",size:24,color:"--icon-input-neutral-default","data-test":"Icon"}),rightIcon:!!i&&e(R,{name:"clear_m",size:24,color:"--icon-input-brand-primary-default",onClick:()=>a(""),"data-test":"Icon"}),"data-test":"TextField"})})}),!n&&e(P,{primary:!0,size:"small",leftIcon:e(R,{name:"add_m",size:24,"data-test":"Icon"}),onClick:t,"data-test":"Button",children:"New Invoice"})]})]}),p(m,{gap:8,align:"center",vertical:n,"data-test":"Stack",children:[e(m,{fullWidth:!0,"data-test":"Stack",children:e(b.FilterInput,{name:"status",render:({field:{value:i,onChange:a}})=>e(Dt,{value:i??[],onChange:a,"data-test":"InvoiceStatusFilterField"})})}),e(m,{fullWidth:!0,"data-test":"Stack",children:e(b.FilterInput,{name:"invoiceType",render:({field:{value:i,onChange:a}})=>e(Nt,{value:i??[],onChange:a,"data-test":"TypeFilterField"})})}),e(m,{fullWidth:!0,"data-test":"Stack",children:e(b.FilterInput,{name:"customers",render:({field:{value:i,onChange:a}})=>e(Mt,{value:i??[],onChange:a,"data-test":"CustomersFilterField"})})})]}),p(m,{gap:8,align:"center",fullWidth:!0,vertical:n,"data-test":"Stack",children:[e(m,{fullWidth:!0,"data-test":"Stack",children:e(b.FilterInput,{name:"noums",render:({field:{value:i,onChange:a}})=>e(At,{value:i??[],onChange:a,"data-test":"NoumFilterField"})})}),e(m,{fullWidth:!0,"data-test":"Stack",children:e(b.FilterInput,{name:"dateRange",render:({field:{value:i,onChange:a}})=>e(Rt,{value:i,onChange:a,"data-test":"InvoiceDateRangeFilterField"})})}),e(m,{fullWidth:!0,"data-test":"Stack",children:e(b.FilterInput,{name:"amountRange",render:({field:{value:i,onChange:a}})=>e(Tt,{value:i,onChange:a,"data-test":"AmountFilterField"})})})]})]})})}const Et=g(we)`
  width: 100%;
  padding: 24px;
  overflow: visible;
  min-height: 200px;
`,_t=g(F).attrs({colorToken:"--text-card-neutral-default",font:"footnote"})``,Vt=g(F).attrs({colorToken:"--text-card-neutral-highlighted",font:"footnote"})``,Ot=g(m).attrs({justify:"space-between",fullWidth:!0})``,Lt=g(F).attrs(({status:t})=>({colorToken:t===S.Draft?"--text-card-neutral-default":"--text-card-neutral-highlighted"}))``,zt=g(m).attrs({gap:24})`
  padding: 0 0 32px 0;
`,I={PageCard:Et,KeyText:_t,ItemRow:Ot,ValueText:Vt,CellText:Lt,InvoiceManagerContainer:zt},Wt=g(F).attrs(({bold:t})=>({colorToken:"--text-modal-neutral-default",font:t?"body-l-bold":"body-l"}))``,z={Text:Wt},Bt=({isOpenModal:t,invoice:r,onClose:n,onConfirm:i})=>{var l;const[a,c]=Ge.useState(""),{isMobile:u}=Z();return r?p(Re,{isFullScreen:u,open:t,testId:"send_reminder_modal",onClose:n,disableBackdropClick:!0,enableCloseButton:!0,size:De.M,"data-test":"SendInvoiceReminderModal-Modal",children:[e(Ae,{"data-test":"SendInvoiceReminderModal-ModalHeader",children:"Send Reminder"}),e(Ne,{"data-test":"SendInvoiceReminderModal-ModalBody",children:p(m,{gap:16,vertical:!0,align:"center",justify:"center","data-test":"SendInvoiceReminderModal-Stack",children:[p(z.Text,{children:["Do you want to send the reminder about"," ",e(z.Text,{bold:!0,children:r.invoiceNumber})," for"," ",e(z.Text,{bold:!0,children:ue(r.amount??0,r.currency??void 0)})," ","to ",e(z.Text,{bold:!0,children:(l=r.invoiceTo)==null?void 0:l.displayName}),"?"]}),e(Pe,{value:a,onChange:f=>c(f.target.value),placeholder:"Your Message (Optional)","data-test":"SendInvoiceReminderModal-TextArea"})]})}),e(Ee,{"data-test":"SendInvoiceReminderModal-ModalFooter",children:p(m,{gap:16,fullWidth:!0,"data-test":"SendInvoiceReminderModal-Stack",children:[e(P,{tertiary:!0,onClick:n,size:"full",testId:"cancel_btn","data-test":"SendInvoiceReminderModal-Button",children:"Cancel"}),e(P,{primary:!0,size:"full",testId:"confirm_btn",grow:!0,onClick:()=>i(a),"data-test":"SendInvoiceReminderModal-Button",children:"Send reminder"})]})})]}):null},Ut=(t,r)=>ue(t,r),ge={formatAmount:Ut};function Ie({onOpenDeleteModal:t,onOpenChangeStatusModal:r,onOpenSendReminderModal:n,onOpenDuplicateInvoiceModal:i,invoice:a}){const c=ee(),{download:u}=ot(),l=pe(),f=y.useCallback(d=>{switch(d){case"VIEW":{c(X(B.INVOICE_DETAILS,{id:a.id}));break}case"EDIT":{c(X(B.INVOICE_EDIT,{id:a.id}));break}case"DELETE":t(a);break;case"CHANGE_STATUS":r(a);break;case"DOWNLOAD_PDF":u(a.id,a.invoiceNumber??"");break;case"SEND_REMINDER":n(a);break;case"DUPLICATE_INVOICE":i(a);break;default:console.log("Unsupported action",d,"no invoice",a)}},[u,a,c,r,t,n,i]);return e(b.ActionsMenu,{onClick:d=>f(d),menuOptions:V([l.canEdit(a)?{key:"edit-invoice",label:"Edit",value:"EDIT",iconName:"edit_m"}:void 0,{key:"view-invoice",label:"View",value:"VIEW",iconName:"eye_on_m"},l.canDownload(a)?{key:"download-invoice",label:"Download PDF",value:"DOWNLOAD_PDF",iconName:"download_m"}:void 0,l.canChangeStatus(a)?{key:"change-status",label:"Change Status",value:"CHANGE_STATUS",iconName:"transfer_m"}:void 0,l.canSendReminder(a)?{key:"send-reminder",label:"Send Reminder",value:"SEND_REMINDER",iconName:"notifications_m"}:void 0,l.canDuplicate(a)?{key:"duplicate-invoice",label:"Duplicate Invoice",value:"DUPLICATE_INVOICE",iconName:"copy_m"}:void 0,l.canDelete(a)?{key:"delete-invoice",label:"Delete Draft",value:"DELETE",intent:"danger",iconName:"delete_m"}:void 0])})}function $t({invoices:t,loading:r,onOpenChangeStatusModal:n,onOpenSendReminderModal:i,onOpenDeleteModal:a,onOpenDuplicateInvoiceModal:c}){const{user:u}=_e();return e(U,{children:e(b.CollapsibleList,{data:t,loading:r,renderLeft:l=>p(m,{align:"center",gap:16,"data-test":"Stack",children:[e(F,{font:"body-m-bold",colorToken:"--text-card-neutral-highlighted","data-test":"TSpan",children:l.invoiceNumber}),e(he,{status:l.status,"data-test":"InvoiceStatusBadge"})]}),renderRight:l=>e(Ie,{invoice:l,onOpenChangeStatusModal:n,onOpenDeleteModal:a,onOpenSendReminderModal:i,onOpenDuplicateInvoiceModal:c,"data-test":"ActionMenu"}),keyExtractor:l=>l.id??"",enableRowSelection:!0,renderContent:l=>{var f,d,h;return p(m,{gap:8,vertical:!0,fullWidth:!0,padding:"16px 0","data-test":"Stack",children:[p(I.ItemRow,{children:[e(I.KeyText,{children:"Amount"}),e(I.ValueText,{children:ge.formatAmount(l.amount||0,l.currency??void 0)})]}),p(I.ItemRow,{children:[e(I.KeyText,{children:"Type"}),e(I.ValueText,{children:((f=l.invoiceTo)==null?void 0:f._id)===(u==null?void 0:u._id)?"Received":"Issued"})]}),p(I.ItemRow,{children:[e(I.KeyText,{children:"Customer"}),e(I.ValueText,{children:(d=l.invoiceTo)==null?void 0:d.displayName})]}),p(I.ItemRow,{children:[e(I.KeyText,{children:"Noum"}),e(I.ValueText,{children:(h=l.noumId)==null?void 0:h.name})]}),p(I.ItemRow,{children:[e(I.KeyText,{children:"Due"}),e(I.ValueText,{children:l.dueDate?H($.parseDateString(l.dueDate)):"--"})]}),p(I.ItemRow,{children:[e(I.KeyText,{children:"Created"}),e(I.ValueText,{children:l.issueDate?H($.parseDateString(l.issueDate)):"--"})]})]})}})})}function Ht({offset:t,filters:r,onPaginationChange:n}){var ne,oe;const i=ee(),{addToast:a,addErrorToast:c}=Ve(),{logError:u}=Oe(),{isMobile:l}=Z(),{sorting:f}=rt(),{data:d,loading:h,refetch:T}=Le({variables:{filter:j.mapToInvoiceQueryInput(r,t,f)},fetchPolicy:"cache-and-network"}),{canPay:A}=pe(),[v]=ze(),{changeStatus:C}=Ze(),k=V((ne=d==null?void 0:d.getInvoiceList)==null?void 0:ne.data),G=((oe=d==null?void 0:d.getInvoiceList)==null?void 0:oe.count)??0,[K]=We(),{modalType:N,contextData:s,openModal:x,closeModal:M}=Be(),{duplicateInvoice:te}=it({invoiceId:s==null?void 0:s.id}),ae=y.useCallback(async o=>{x("make-payment",o)},[x]),ye=y.useCallback(async()=>{if(s!=null&&s.id)try{M();const o=await te();o!=null&&o.id&&window.open(Y.createInvoicePath.duplicateInvoice(o.id),"_blank")}catch{c("Failed to duplicate invoice")}},[c,M,s==null?void 0:s.id,te]),Ce=async()=>{if(s){if(!s.id)return;try{await K({variables:{id:s.id}}),T(),a("primary","none","Invoice deleted successfully.")}catch(o){u(o,"invoice-manager-delete-invoice",!0)}}M()},Se=y.useCallback(async(o,w)=>{s!=null&&s.id&&(M(),await C({invoice:s,status:o,amount:w}),T())},[C,M,s,T]),be=y.useCallback(o=>{s!=null&&s.id&&(v({variables:{id:s.id,customMessage:o}}),M())},[M,s==null?void 0:s.id,v]),ke=y.useMemo(()=>[{id:"amount",title:"Amount",width:"10%",renderValue:o=>e(U,{children:e(I.CellText,{font:"footnote-bold",status:o.status,children:ge.formatAmount(o.amount||0,o.currency??void 0)})})},{id:"status",title:"Status",renderValue:o=>e(he,{status:o.status,"data-test":"columns-InvoiceStatusBadge"}),width:"10%"},{id:"invoiceNumber",title:"Invoice Number",renderValue:o=>o.invoiceNumber,width:"10%"},{id:"type",title:"Type",renderValue:o=>o.type,width:"10%"},{id:"customer",title:"Customer",renderValue:o=>{var w;return o.type==="Received"?"You":(w=o.invoiceTo)==null?void 0:w.displayName},width:"20%"},{id:"noum",title:"Noum",renderValue:o=>{var w;return(w=o.noumId)==null?void 0:w.name},width:"20%"},{id:"dueDate",title:"Due",renderValue:o=>o.dueDate?H($.parseDateString(o.dueDate)):"--",width:"10%"},{id:"createdDate",sortName:me.IssueDate,title:"Created",renderValue:o=>o.issueDate?H($.parseDateString(o.issueDate)):"--",width:"10%"},{id:"actions",title:"",renderValue:o=>A(o)?e(P,{secondary:!0,size:"small",onClick:w=>{w.stopPropagation(),ae(o)},"data-test":"columns-Button",children:"Pay"}):e(m,{justify:"end","data-test":"columns-Stack",children:e(Ie,{invoice:o,onOpenChangeStatusModal:()=>x("change-status",o),onOpenDeleteModal:()=>x("delete",o),onOpenSendReminderModal:()=>x("send-reminder",o),onOpenDuplicateInvoiceModal:()=>x("duplicate-invoice",o),"data-test":"columns-ActionMenu"})})}],[A,ae,x]);return p(U,{children:[p(m,{gap:24,vertical:!0,fullWidth:!0,align:"stretch",padding:"0 0 64px 0","data-test":"Stack",children:[l?e($t,{invoices:k,loading:h,onOpenChangeStatusModal:o=>x("change-status",o),onOpenDeleteModal:o=>x("delete",o),onOpenSendReminderModal:o=>x("send-reminder",o),onOpenDuplicateInvoiceModal:o=>x("duplicate-invoice",o),"data-test":"InvoicesCollapsibleList"}):e(b.Table,{keyExtractor:o=>o.id??"",data:k,columns:ke,rowsPerPage:5,loading:h,onRowClick:o=>i(X(B.INVOICE_DETAILS,{id:o.id})),wordWrap:!0}),e(b.Footer,{leftElement:e(b.Pagination,{totalCount:G,itemsPerPage:j.ITEMS_PER_PAGE,currentOffset:t,onChange:n}),rightElement:null})]}),(s==null?void 0:s.id)&&e(et,{isOpenModal:N==="change-status",onCancel:M,onConfirm:Se,currentStatus:(s==null?void 0:s.status)??void 0,currency:(s==null?void 0:s.currency)??void 0,invoiceId:(s==null?void 0:s.id)??"","data-test":`ChangeInvoiceStatusModal-${N}`},N),(s==null?void 0:s.id)&&e(Bt,{isOpenModal:N==="send-reminder",onClose:M,onConfirm:be,invoice:s,"data-test":"SendInvoiceReminderModal"},(s==null?void 0:s.id)??""),e(at,{isOpenModal:N==="delete",onConfirm:Ce,onClose:()=>M(),isDraft:!1,"data-test":"DeleteDraftModal"}),N==="make-payment"&&s&&e(tt,{onClose:M,invoice:s,onPaymentSuccess:T,"data-test":"MakeInvoicePaymentWizard"}),N==="duplicate-invoice"&&s&&e(nt,{onClose:M,isOpenModal:!0,onConfirm:ye,"data-test":"DuplicateInvoiceModal"})]})}function jt({onCreateInvoice:t}){return p(m,{fullWidth:!0,vertical:!0,"data-test":"Stack",children:[e(F,{font:"heading-xs-bold","data-test":"TSpan",children:"Invoice Manager"}),p(m,{fullWidth:!0,vertical:!0,align:"center",gap:16,"data-test":"Stack",children:[e(R,{name:"invoice_m",size:96,"data-test":"Icon"}),e(F,{font:"body-l",colorToken:"--text-placeholder-neutral-default","data-test":"TSpan",children:"No invoices added or received yet."}),e(P,{secondary:!0,size:"small",onClick:t,leftIcon:e(R,{name:"add_m",size:24,"data-test":"Icon"}),"data-test":"Button",children:"New Invoice"})]})]})}function Da(){var h;const t=ee(),{data:r,loading:n}=Ue({variables:{filter:{search:""}}}),i=(h=r==null?void 0:r.getInvoiceList)==null?void 0:h.count,[a,c]=y.useState({search:"",status:[],dateRange:{from:void 0,to:void 0},amountRange:{from:void 0,to:void 0},customers:[],noums:[],invoiceType:[],limit:10}),[u,l]=y.useState(0),f=y.useMemo(()=>_.debounce(T=>{l(0),c(T)},1e3),[]),d=()=>{t(B.INVOICE_CREATE)};return e(Ke,{type:"Invoices","data-test":"ListLayout",children:e(I.InvoiceManagerContainer,{children:e(I.PageCard,{children:e(b.Provider,{data:[],defaultSorting:{column:me.IssueDate,direction:"desc"},children:e(m,{gap:24,vertical:!0,align:"stretch","data-test":"Stack",children:n?e($e,{"data-test":"Spinner"}):i===0?e(jt,{onCreateInvoice:d,"data-test":"EmptyList"}):p(U,{children:[e(Pt,{onCreateInvoice:d,onFiltersChange:f,"data-test":"ListHeader"}),e(Ht,{offset:u,filters:a,onPaginationChange:T=>l(T.offset),"data-test":"InvoicesList"})]})})})})})})}export{Da as default};
//# sourceMappingURL=InvoiceManager-f2b15caa.js.map
