import{c as s,x as S,j as a,T as k,c4 as Y,I as N,qV as U,F,S as X,_ as T,B as $,aR as J,Y as K,v as Z,qO as y,qS as ee,qW as te,qX as ae,R as m,aC as oe,X as ie,n as ne}from"./index-cd84bcc9.js";import{S as re}from"./index-38931f83.js";import{S as u,D as B,C as se}from"./CampaignDetails-772896b1.js";import{H as de}from"./Header-df950621.js";import{A as le}from"./Actions-ad30ea8c.js";import{r as f,aa as ce,a9 as pe,b2 as I}from"./vendor-51460554.js";import{D as fe}from"./DeleteCampaignConformation-e0814e31.js";import"./ChamberLeftSideBar-2a7f8e7f.js";import"./index-2d186805.js";import"./useResizeObserver-0deb9469.js";import"./sideNavItems-22800105.js";import"./styles-b4894a1f.js";import"./index-4963229a.js";import"./Modal-5a254f40.js";import"./NoumCard-2fa806c2.js";import"./Badge-f2e67408.js";import"./CountryCard-e0d91c6e.js";import"./Flag-d41fef47.js";import"./Stepper-2453d15a.js";function ge({noDataNote:t}){return s(F,{children:[a(k,{font:"body-m",colorToken:"--text-card-neutral-default","data-test":"TSpan",children:t}),a(X,{height:12,"data-test":"Spacer"})]})}function ue({offerNumber:t,createdAt:r,id:i,type:l,onView:c,updateAppearance:d}){return s(F,{children:[s(u.FileContainer,{children:[s(u.FileSide,{children:[a(u.FileIcon,{children:a(N,{color:d?"--text-card-header-neutral-default":void 0,name:"file_m",size:24,"data-test":"Icon"})}),s(S,{vertical:!0,"data-test":"Stack",children:[s(k,{font:"body-m",colorToken:d?"--text-card-header-neutral-default":"--text-card-header-neutral-highlighted","data-test":"TSpan",children:[l==="offer"?"Offer":"Weekly Report"," #",t]}),a(k,{font:"footnote",colorToken:"--text-tablecell-body-neutral-default","data-test":"TSpan",children:T.formatDate(r)})]})]}),a(u.FileSide,{children:a($,{onClick:()=>c(i),size:"small",tertiary:!0,"data-test":"Button",children:"View"})})]}),a(B,{"data-test":"Divider"})]})}function P({heading:t,noDataNote:r,count:i,onView:l,list:c,onToggleOldOffers:d,type:e}){const[C,A]=f.useState(!1);return s(u.Container,{children:[s(S,{align:"center",justify:"space-between","data-test":"Stack",children:[s(S,{align:"center",gap:8,"data-test":"Stack",children:[a(u.ContainerTitle,{children:t}),a(u.Count,{children:a(k,{font:"footnote-bold",colorToken:"--text-badge-brand-primary-default","data-test":"TSpan",children:i})})]}),t==="Offers"&&i>0&&s(S,{gap:8,"data-test":"Stack",children:[a(Y,{size:18,"data-testid":"check-box-one",isChecked:C,onChange:n=>{d==null||d(n),A(n)},icon:a(N,{name:"tick_m",size:14,color:"--icon-checkbox-neutral-alt-default","data-test":"Icon"}),"data-test":"Checkbox"}),a(k,{font:"footnote",colorToken:"--text-card-neutral-default","data-test":"TSpan",children:"Show past offers"})]})]}),a(B,{"data-test":"Divider"}),!i&&a(ge,{noDataNote:r,"data-test":"NoData"}),!!i&&!!c.length&&c.map(n=>{const g=Number("oid"in n?n.oid:"reportId"in n?n.reportId??0:0);return a(ue,{id:(n==null?void 0:n._id)??"",type:e,offerNumber:g,onView:l,createdAt:(n==null?void 0:n.createdAt)??new Date,updateAppearance:"status"in n?n.status!==U.Sent:!1,"data-test":"File"})})]})}function he(){var M,v,O,w,E,x,R;const t=ce(),r=J(),i=pe(),l=K(),c=Z(),[d,e]=y(),[C,A]=f.useState(!1),n=ee({skip:!t.id,variables:{campaignId:t.id??""},onError:o=>l.logError(o,"useCampaignSummaryQuery",!0)}),g=te({skip:!t.id,fetchPolicy:"cache-and-network",variables:{campaignId:t.id??""},onError:o=>l.logError(o,"get-campaign-offer-id",!0)}),p=ae({skip:!t.id,fetchPolicy:"cache-and-network",variables:{campaignId:t.id??"",offset:0,limit:100},onError:o=>l.logError(o,"get-campaign-offer-id",!0)}),L=async()=>{if(!t.id){c.addErrorToast("Campaign not found");return}try{await d({variables:{campaignId:t.id}}),r.closeModal(),c.addSuccessIconToast("Campaign has been deleted"),i(m.CAMPAIGNS)}catch(o){l.logError(o,"delete-campaign",!0)}},G=f.useCallback(()=>{const o=t.id??"new";i(I(m.CAMPAIGN_CREATE,{id:o}))},[i,t.id]),_=f.useCallback(o=>{i({pathname:I(m.CAMPAIGN_OFFER,{id:o}),search:`?campaignId=${t.id??""}`})},[i,t.id]),j=f.useCallback(o=>{i({pathname:I(m.CAMPAIGN_REPORT,{id:o}),search:`?campaignId=${t.id??""}`})},[i,t.id]),q=f.useCallback(o=>A(o),[]),D=f.useMemo(()=>{var o,b;return T.removeDraftOffer((b=(o=g==null?void 0:g.data)==null?void 0:o.getAdCampaignOffers)==null?void 0:b.data)},[(v=(M=g==null?void 0:g.data)==null?void 0:M.getAdCampaignOffers)==null?void 0:v.data]),V=f.useMemo(()=>{var o,b;return oe((b=(o=p==null?void 0:p.data)==null?void 0:o.getAdCampaignReports)==null?void 0:b.data)},[(w=(O=p==null?void 0:p.data)==null?void 0:O.getAdCampaignReports)==null?void 0:w.data]),h=(E=n==null?void 0:n.data)==null?void 0:E.getSelectedAdCampaignDetails,z=f.useCallback(()=>{r.openModal("delete-confirmation",{id:t.id||"",title:(h==null?void 0:h.title)||""})},[r,t.id,h==null?void 0:h.title]),Q=f.useCallback(()=>i(m.CAMPAIGNS),[i]),W=C?D:D.length?[D[0]]:[],H=((R=(x=p==null?void 0:p.data)==null?void 0:x.getAdCampaignReports)==null?void 0:R.count)??0;return{modal:{...r},campaign:{summary:h,duplicate:G,softDelete:L,viewOffer:_,viewReport:j,handleBack:Q,openDeleteConfirmationModal:z,isDeleting:e.loading},offers:{list:W,count:D.length,toggleOldOffers:q},reports:{list:V,count:H},loading:{campaign:n.loading,offers:g.loading,reports:p.loading}}}function Be(){const t=ie(),{campaign:r,offers:i,reports:l,loading:c,modal:d}=he(),{summary:e}=r,C=(e==null?void 0:e.status)==="LIVE"||(e==null?void 0:e.status)==="COMPLETED";return s(re,{"data-test":"SinglePageLayout",children:[a(de,{heading:t.isMobile?"Campaign":"Campaign Summary",isMobile:t.isMobile,isTablet:t.isTablet,currentStep:2,totalSteps:3,stepper:!C,onBack:r.handleBack,unsetMinWidth:!0,rightAction:a(le.SummaryActions,{isMobile:t.isMobile,isTablet:t.isTablet,hideDelete:!T.canDelete((e==null?void 0:e.status)||""),onDelete:r.openDeleteConfirmationModal,onDuplicate:r.duplicate,deleteDisabled:!1}),"data-test":"Header"}),c.campaign||c.offers||c.reports?a(ne,{"data-test":"Spinner"}):a("div",{style:{alignSelf:"center",width:"100%",display:"flex",justifyContent:"center"},children:s(u.Main,{children:[a(se,{title:e==null?void 0:e.title,status:e==null?void 0:e.status,audience:e==null?void 0:e.audience,startDate:e==null?void 0:e.startDate,noumId:e==null?void 0:e.noumId,goals:e==null?void 0:e.goals,budgetAmount:e==null?void 0:e.budgetAmount,budgetType:e==null?void 0:e.budgetType,adId:e==null?void 0:e.adId,otherGoals:e==null?void 0:e.otherGoals,"data-test":"CampaignDetails"}),s(S,{vertical:t.isMobile||t.isTablet,fullWidth:!0,gap:16,"data-test":"Stack",children:[a(P,{heading:"Offers",type:"offer",count:i.count,noDataNote:"Your offers will appear here soon.",onView:r.viewOffer,list:i.list,onToggleOldOffers:i.toggleOldOffers,"data-test":"Offers"}),a(P,{type:"report",count:l.count,heading:"Reports",noDataNote:"Your reports will appear here soon.",onView:r.viewReport,list:l.list,"data-test":"Reports"})]})]})}),a(fe,{open:d.modalType==="delete-confirmation",onClose:d.closeModal,campaign:d.contextData,onDelete:r.softDelete,actionButtonLoading:r.isDeleting,"data-test":"DeleteCampaignConfirmation"})]})}export{Be as default};
//# sourceMappingURL=CampaignSummary-221db021.js.map
