{"version":3,"file":"useDiscoveryPopularNoums-cdda93b8.js","sources":["../../src/features/discovery/hooks/useDiscoveryPopularNoums.tsx"],"sourcesContent":["import { useCallback, useMemo, useState, useEffect } from 'react';\nimport {\n  type SpaceOutputFragment,\n  usePopularNoumsQuery,\n} from '@/apollo/graphql';\nimport {\n  type Maybe,\n  SpaceStatusEnum,\n  SpaceTypeEnum,\n} from '@/apollo/generated/types';\n\nexport const useDiscoveryPopularNoums = (\n  isInfinite?: boolean,\n  pageSize = 0,\n) => {\n  const [infiniteState, setInfiniteState] = useState<\n    'loading' | 'hasNextPage' | 'end' | 'end-with-force'\n  >('hasNextPage');\n  const [currentNoums, setCurrentNoums] = useState<\n    Maybe<SpaceOutputFragment>[]\n  >([]);\n  const { data, loading, error, fetchMore, refetch } = usePopularNoumsQuery({\n    variables: {\n      limit: isInfinite ? pageSize : 12,\n      offset: 0,\n    },\n  });\n\n  useEffect(() => {\n    setCurrentNoums(data?.popularNoums?.data || []);\n  }, [data]);\n\n  const filteredNoums = useMemo(\n    () =>\n      (currentNoums as Maybe<SpaceOutputFragment>[])?.filter(\n        (space) =>\n          (space?.type !== SpaceTypeEnum.Home &&\n            space?.status === SpaceStatusEnum.Published) ||\n          (space?.type === SpaceTypeEnum.Home &&\n            space?.uid?.userStatus !== 'PENDING'),\n      ),\n    [currentNoums],\n  );\n\n  const fetchMoreNoums = useCallback(async () => {\n    const result = await fetchMore({\n      variables: {\n        limit: pageSize,\n        offset: currentNoums?.length || 0,\n      },\n    });\n    const currentFetchedNoums = result?.data?.popularNoums?.data || [];\n    const udpatedNoums = [...currentNoums, ...currentFetchedNoums];\n    setCurrentNoums(udpatedNoums);\n    if ((result.data.popularNoums?.data?.length || 0) < pageSize)\n      setInfiniteState('end');\n  }, [fetchMore, currentNoums, pageSize]);\n\n  useEffect(() => {\n    setInfiniteState(\n      currentNoums && currentNoums?.length < pageSize ? 'end' : 'hasNextPage',\n    );\n  }, [currentNoums, pageSize]);\n\n  useEffect(() => {\n    refetch();\n  }, [refetch]);\n\n  return {\n    noums: filteredNoums,\n    loading,\n    error,\n    infiniteState,\n    fetchMoreNoums,\n    refetchRecommendedNoums: refetch,\n  };\n};\n\nexport default useDiscoveryPopularNoums;\n"],"names":["useDiscoveryPopularNoums","isInfinite","pageSize","infiniteState","setInfiniteState","useState","currentNoums","setCurrentNoums","data","loading","error","fetchMore","refetch","usePopularNoumsQuery","variables","limit","offset","useEffect","popularNoums","filteredNoums","useMemo","filter","space","type","SpaceTypeEnum","Home","status","SpaceStatusEnum","Published","uid","userStatus","fetchMoreNoums","useCallback","result","length","currentFetchedNoums","udpatedNoums","noums","refetchRecommendedNoums"],"mappings":"iGAWO,MAAMA,EAA2BA,CACtCC,EACAC,EAAW,IACR,CACH,KAAM,CAACC,EAAeC,CAAgB,EAAIC,WAExC,aAAa,EACT,CAACC,EAAcC,CAAe,EAAIF,EAAAA,SAEtC,CAAE,CAAA,EACE,CAAEG,KAAAA,EAAMC,QAAAA,EAASC,MAAAA,EAAOC,UAAAA,EAAWC,QAAAA,GAAYC,EAAqB,CACxEC,UAAW,CACTC,MAAOd,EAAaC,EAAW,GAC/Bc,OAAQ,CACV,CAAA,CACD,EAEDC,EAAAA,UAAU,IAAM,OACdV,IAAgBC,EAAAA,GAAAA,YAAAA,EAAMU,eAANV,YAAAA,EAAoBA,OAAQ,CAAE,CAAA,CAAA,EAC7C,CAACA,CAAI,CAAC,EAEHW,MAAAA,EAAgBC,EAAAA,QACpB,IACGd,GAAAA,YAAAA,EAA+Ce,UAE3CC,OAAAA,OAAAA,GAAAA,YAAAA,EAAOC,QAASC,EAAcC,OAC7BH,GAAAA,YAAAA,EAAOI,UAAWC,EAAgBC,YACnCN,GAAAA,YAAAA,EAAOC,QAASC,EAAcC,QAC7BH,EAAAA,GAAAA,YAAAA,EAAOO,MAAPP,YAAAA,EAAYQ,cAAe,YAEnC,CAACxB,CAAY,CAAC,EAGVyB,EAAiBC,EAAAA,YAAY,SAAY,aACvCC,MAAAA,EAAS,MAAMtB,EAAU,CAC7BG,UAAW,CACTC,MAAOb,EACPc,QAAQV,GAAAA,YAAAA,EAAc4B,SAAU,CAClC,CAAA,CACD,EACKC,IAAsBF,GAAAA,EAAAA,GAAAA,YAAAA,EAAQzB,OAARyB,YAAAA,EAAcf,eAAde,YAAAA,EAA4BzB,OAAQ,CAAA,EAC1D4B,EAAe,CAAC,GAAG9B,EAAc,GAAG6B,CAAmB,EAC7D5B,EAAgB6B,CAAY,KACvBH,GAAAA,EAAAA,EAAOzB,KAAKU,eAAZe,YAAAA,EAA0BzB,OAA1ByB,YAAAA,EAAgCC,SAAU,GAAKhC,GAClDE,EAAiB,KAAK,CACvB,EAAA,CAACO,EAAWL,EAAcJ,CAAQ,CAAC,EAEtCe,OAAAA,EAAAA,UAAU,IAAM,CACdb,EACEE,IAAgBA,GAAAA,YAAAA,EAAc4B,QAAShC,EAAW,MAAQ,aAAa,CAAA,EAExE,CAACI,EAAcJ,CAAQ,CAAC,EAE3Be,EAAAA,UAAU,IAAM,CACLL,GAAA,EACR,CAACA,CAAO,CAAC,EAEL,CACLyB,MAAOlB,EACPV,QAAAA,EACAC,MAAAA,EACAP,cAAAA,EACA4B,eAAAA,EACAO,wBAAyB1B,CAAAA,CAE7B"}