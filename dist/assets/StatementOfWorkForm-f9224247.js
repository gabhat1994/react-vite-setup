import{W as y,x as c,T as p,c as i,j as e,qJ as Oe,aC as $e,I as E,aQ as Re,et as Ne,F as x,da as u,y as O,B as q,a2 as ie,b3 as Y,b1 as se,m as De,ae as ke,X as Ce,v as we,Y as Ie,aR as Pe,ev as qe,R as le,n as Le,V as Be,eq as Ve,eu as Ye}from"./index-cd84bcc9.js";import{am as W,an as z,bH as V,bG as j,bF as je,ao as U,ap as ye,aq as ve,bE as J,C as $,ar as de,r as P,l as ce,bb as f,bz as Fe,ac as he,bD as Me,b2 as Te,aa as Ue,bc as He,bo as Je}from"./vendor-51460554.js";import{I as T,F as M,a as ue,M as xe,E as Ge,b as ze,S as Qe,c as Xe,d as Ke,C as Ze,e as et,f as tt,A as at,g as oe,u as rt,D as nt}from"./index-be450a41.js";import{S as _,a as ot,b as it,c as lt}from"./Section-2a57cf43.js";import{g}from"./forms-18e3c53a.js";import"./ApiEntityPickerField-cfd6d0d6.js";import{A as st,b as dt,u as H,a as ct}from"./PdfPreviewThumbnail-3547d9fe.js";import{f as te}from"./getTimeStampForDisplaying-22d5ca9d.js";import{D as Ee,S as ee}from"./statementOfWork-e03c986f.js";import{R as ut}from"./Radiobox-c1e62033.js";import{S as mt}from"./SelectField-54706174.js";import{I as ht}from"./invoice-e39dbdbc.js";import{S as ft}from"./StickyFormHeader-043ef98d.js";import{u as _e}from"./navigation-419d637e.js";import{u as pt}from"./statementOfWorkPermissions-68d8aac2.js";import{D as St}from"./DeleteDocumentConfirmationModal-44709272.js";import{b as gt}from"./statementOfWorkPdf-95417ec8.js";import{S as bt,R as Dt}from"./index-38931f83.js";import{S as fe,u as kt}from"./statementOfWork-f09edc55.js";import"./utils-87d126b1.js";import"./Modal-5a254f40.js";import"./index-1f4ed9fc.js";import"./styles-46bbc451.js";import"./index-4963229a.js";import"./useResizeObserver-0deb9469.js";import"./types-3fb18ef5.js";import"./styles-5db1c009.js";import"./ChamberLeftSideBar-2a7f8e7f.js";import"./index-2d186805.js";import"./sideNavItems-22800105.js";import"./styles-b4894a1f.js";import"./payloadParser-f4cc4e4f.js";const G=W({title:z().required().label("Title"),noumId:z().required().ensure().label("Noum Assignment"),scopeOfWork:z().required().max(3e3).label("Scope of Work"),effectiveDate:V().required().label("Effective Date"),contractId:z().required().label("Contract Attachment"),deliverables:j(W({name:z().required().label("Deliverable Name"),dueDate:V().nullable().label("Due Date"),description:z().optional().max(300).label("Description")})).required().min(1).label("Deliverables"),milestones:j(W({name:z().required().label("Milestone Name"),dueDate:V().required().label("Due Date"),description:z().optional().max(3e3).label("Description")})).label("Milestones").when("fees.feeCategory",{is:y.Milestones,then:t=>t.required().min(1),otherwise:t=>t.optional()}),payments:W({currency:z().required().label("Currency")}),fees:W({feeCategory:je().oneOf(Object.values(y)).required().label("Fee Category"),inAdvance:W({amount:U().required().label("Amount").typeError(({label:t})=>`${t} must be a number.`),dueDate:V().required().label("Due Date")}).when("feeCategory",{is:y.Inadvance,then:t=>(t.fields.amount.withMutation(a=>a.required()),t.fields.dueDate.withMutation(a=>a.required()),t.required()),otherwise:t=>(t.fields.amount.withMutation(a=>a.notRequired()),t.fields.dueDate.withMutation(a=>a.notRequired()),t.notRequired())}),instalments:j(W({amount:U().required().label("Amount").typeError(({label:t})=>`${t} must be a number.`),dueDate:V().required().label("Due Date")})).when("feeCategory",{is:y.Installments,then:t=>t.required().min(1),otherwise:t=>t.optional().min(0)}),milestones:j(W({amount:U().required().label("Amount").typeError(({label:t})=>`${t} must be a number.`),dueDate:V().required().label("Due Date")})).when("feeCategory",{is:y.Milestones,then:t=>t.required().min(1),otherwise:t=>t.optional().min(0)}),lumpSum:W({amount:U().label("Amount").typeError(({label:t})=>`${t} must be a number.`),dueDate:V().required().label("Due Date")}).when("feeCategory",{is:y.Lumpsum,then:t=>(t.fields.amount.withMutation(a=>a.required()),t.fields.dueDate.withMutation(a=>a.required()),t.required()),otherwise:t=>(t.fields.amount.withMutation(a=>a.notRequired()),t.fields.dueDate.withMutation(a=>a.notRequired()),t.notRequired())})}),expenseReimbursement:j(W({name:z().required().label("Description"),amount:U().required().label("Amount").typeError(({label:t})=>`${t} must be a number.`)})),bonusCommission:j(W({name:z().required().label("Description"),amount:U().required().label("Amount").typeError(({label:t})=>`${t} must be a number.`)})),logo:z().url()});function Ct({defaultValues:t}={}){return ye({defaultValues:t,resolver:ve(G),mode:"onSubmit"})}function ae(){return J()}const wt=$(c).attrs(()=>({gap:8,vertical:!0,fullWidth:!0,align:"stretch"}))``,It=$(c).attrs(()=>({gap:24,justify:"space-between"}))``,yt=$(p).attrs(()=>({font:"footnote",colorToken:"--text-card-neutral-default"}))``,vt=$(p).attrs(()=>({font:"footnote",colorToken:"--text-card-neutral-highlighted"}))``,R={DetailsContainer:wt,DetailsItem:It,DetailsItemLabel:yt,DetailsItemValue:vt};function Ft({contract:t}){var n,o;const{t:a}=de();return i(R.DetailsContainer,{children:[i(R.DetailsItem,{children:[e(R.DetailsItemLabel,{children:a("noumena.contracts.contract_selector.details.buyer")}),e(R.DetailsItemValue,{children:((n=t.buyer)==null?void 0:n.displayName)??"--"})]}),i(R.DetailsItem,{children:[e(R.DetailsItemLabel,{children:a("noumena.contracts.contract_selector.details.seller")}),e(R.DetailsItemValue,{children:((o=t.seller)==null?void 0:o.displayName)??"--"})]}),i(R.DetailsItem,{children:[e(R.DetailsItemLabel,{children:a("noumena.contracts.contract_selector.details.effective_date")}),e(R.DetailsItemValue,{children:t.effectiveDate?te(new Date(t.effectiveDate)):"--"})]})]})}function Mt({onChange:t,noumId:a,value:n,...o}){const{data:r,loading:s,refetch:l}=Oe({fetchPolicy:"cache-and-network",variables:{offset:0,limit:100,filter:{noumIds:[a],search:""}},skip:!a}),d=r==null?void 0:r.getContractList.data,b=P.useMemo(()=>{function m(h){return{key:h._id,type:"value",value:h,label:`${h.title}`,icon:e(E,{name:"file_m",size:24,"data-test":"options-Icon"})}}return $e(d).map(m)},[d]),D=P.useMemo(()=>ce.debounce(m=>l({filter:{search:m,noumIds:[a]}}),500),[a,l]),S=b.find(m=>m.key===n);return i(c,{gap:16,vertical:!0,fullWidth:!0,align:"stretch","data-test":"Stack",children:[e(st,{options:b,maxContainerHeight:"200px",renderStickyHeader:()=>{},...o,isLoading:s,hideIcons:!1,value:n??"",onChange:m=>t((m==null?void 0:m.key)||""),onInputChange:D,leftIcon:e(E,{name:"search_m",size:20,color:"--icon-input-neutral-default","data-test":"Icon"}),renderSelectionPreviewComponent:m=>e(dt,{...m,selectedRightSideOption:m.selectedOption&&e(Ee,{status:m.selectedOption.value.status,"data-test":"DocumentStatusTag"}),"data-test":"ApiEntitySelectionPreviewComponent"}),"data-test":"ApiEntityPickerFieldWithRemoteSearch"}),S&&e(Ft,{contract:S.value,"data-test":"ContractDetails"})]})}function re({rows:t}){return i(p,{font:"body-m-bold","data-test":"TSpan",children:["Sum:"," ",Re(ce.sumBy(t,a=>parseFloat(`${a.amount}`)||0),Ne.Usd,2)]})}function Tt({index:t,fieldNamePrefix:a}){return e(T.EditMode,{children:({control:n})=>e(x,{children:e(T.FormMainRow,{index:t,displayLineNumbers:!0,children:i(c,{gap:16,fullWidth:!0,"data-test":"Stack",children:[e(u,{grow:3,"data-test":"StackItem",children:e(f,{control:n,name:`${a}name`,render:({field:o,fieldState:r})=>e(O,{placeholder:"Description",inputSize:"small",...o,...g(r),"data-test":"TextField"}),"data-test":"Controller"})}),e(u,{shrink:1,"data-test":"StackItem",children:e(M,{label:"Amount:",horizontal:!0,"data-test":"FormControl",children:i(c,{gap:8,align:"center","data-test":"Stack",children:[e(f,{control:n,name:`${a}amount`,render:({field:{ref:o,...r},fieldState:s})=>e(O,{inputSize:"small",numberOnly:!0,isCurrency:!0,...r,...g(s),"data-test":"TextField"}),"data-test":"Controller"}),e(p,{colorToken:"--text-tablecell-header-neutral-default","data-test":"TSpan",children:"USD"})]})})})]})})})})}const pe={id:"",name:"",amount:0};function xt({disabled:t=!1}){const a=H({name:"bonusCommission",initialMode:"create"});return a.fields.length===0?e(_,{variant:"sub-section",title:"Bonus / Commission",optional:!0,titleSideAddon:e(q,{textOnly:!0,size:"small",leftIcon:e(E,{name:"add_m",size:24,"data-test":"Icon"}),onClick:()=>a.addNewItem(pe),disabled:t,"data-test":"Button",children:"Add Item"}),"data-test":"Section"}):e(_,{variant:"sub-section",title:"Bonus / Commission",optional:!0,hasSeparator:!0,"data-test":"Section",children:e(T.Wizard,{name:"bonusCommission",...a,newItemValues:pe,hasSeparators:!0,EditModeComponent:Tt,SummaryComponent:re})})}function zt({index:t,children:a,displayLineNumbers:n=!1}){const{deleteItem:o,editItem:r,canEdit:s,canDelete:l}=ue();return e(xe,{index:t,displayLineNumbers:n,actionButtons:i(x,{children:[s&&e(Ge,{onClick:()=>r(t)}),l&&e(ze,{onClick:()=>o(t)})]}),children:a})}function Et({index:t,children:a,displayLineNumbers:n=!1}){const{deleteItem:o,canDelete:r}=ue();return e(xe,{index:t,displayLineNumbers:n,actionButtons:e(x,{children:r&&e(ze,{onClick:()=>o(t)})}),hasInputs:!0,children:a})}const _t=Qe;function At({children:t,index:a}){const{handleSubmit:n,formState:o}=J(),{saveItem:r,cancelItemEditing:s}=ue(),{isValid:l}=o;return e(Xe,{actionButtons:i(x,{children:[e(Ke,{softDisabled:!l,onClick:n(d=>{r(a,d)}),children:"Save Item"}),e(Ze,{onClick:()=>s(),children:"Cancel"})]}),children:t})}function Wt(){const{formState:{errors:t}}=J();if(Object.values(t).length===0)return null;const a=Object.values(t)[0];return e(et,{message:a==null?void 0:a.message})}function Ot({values:t,children:a,schema:n}){const o=ye({defaultValues:t,resolver:ve(n),mode:"all"});return e(Fe,{...o,"data-test":"FormProvider",children:e(c,{gap:16,vertical:!0,align:"stretch","data-test":"Stack",children:a(o)})})}function $t({name:t,newItemValues:a,hasSeparators:n=!1,EditModeComponent:o,PreviewModeComponent:r,CreateModeComponent:s=o,SummaryComponent:l,canAdd:d=!0,canEdit:b=!0,canDelete:D=!0,...S}){const{watch:m}=J(),A=m(t),h=S.fields.length;return e(tt,{name:t,canAdd:d,canEdit:b,canDelete:D,...S,"data-test":"FieldArrayWizardFormContextProvider",children:i(c,{vertical:!0,gap:16,align:"stretch","data-test":"Stack",children:[S.fields.map((w,C)=>S.mode==="edit"&&S.editedIndex===C?i(he.Fragment,{children:[e(o,{values:w,index:C,name:t,fieldNamePrefix:`${t}.${C}.`,"data-test":"EditModeComponent"}),n&&e(ie,{fullWidth:!0,noMargin:!0,"data-test":"Separator"})]},w.id):i(he.Fragment,{children:[e(r,{values:w,index:C,name:t,fieldNamePrefix:`${t}.${C}.`,"data-test":"PreviewModeComponent"}),n&&e(ie,{fullWidth:!0,noMargin:!0,"data-test":"Separator"})]},w.id)),e(u,{"data-test":"StackItem",children:d&&S.mode==="create"?e(s,{values:a,index:h,name:t,fieldNamePrefix:`${t}.${h}.`,"data-test":"CreateModeComponent"}):i(c,{justify:"space-between","data-test":"Stack",children:[d&&e(at,{onClick:()=>S.showNewItemForm(),children:"Add New Item"}),l&&e(l,{rows:A,"data-test":"SummaryComponent"})]})})]})})}const N={Wizard:$t,EditMode:Ot,PreviewMainRow:zt,FormMainRow:Et,FormSecondaryRow:_t,FormErrorMessage:Wt,FormFooter:At},Rt=Me(G,"deliverables.0");function Nt({values:t,index:a}){const[n,o]=P.useState(!!t.description);return e(N.EditMode,{schema:Rt,values:t,children:({control:r,setValue:s})=>i(x,{children:[e(N.FormMainRow,{index:a,children:e(u,{grow:!0,"data-test":"StackItem",children:i(c,{gap:16,"data-test":"Stack",children:[e(f,{control:r,name:"name",render:({field:l,fieldState:d})=>e(O,{placeholder:"Deliverable Name",inputSize:"small",...l,error:!!d.error,"data-test":"TextField"}),"data-test":"Controller"}),e(u,{shrink:0,"data-test":"StackItem",children:e(f,{control:r,name:"dueDate",render:({field:{ref:l,...d},fieldState:b})=>e(Y,{size:"small",label:"Due Date (optional)",placeholder:"MM/DD/YYYY",...d,onChange:D=>d.onChange(D??null),error:!!b.error,"data-test":"DatePicker"}),"data-test":"Controller"})})]})})}),e(f,{control:r,name:"description",render:({field:l})=>n?e(u,{grow:!0,"data-test":"StackItem",children:e(se,{placeholder:"Description",maxLength:300,autoResize:!0,...l,"data-test":"TextArea"})}):e(x,{}),"data-test":"Controller"}),e(N.FormFooter,{index:a,children:n?e(q,{textOnly:!0,size:"small",leftIcon:e(E,{name:"close_m",size:24,"data-test":"Icon"}),onClick:()=>{o(!1),s("description","")},"data-test":"Button",children:"Remove description"}):i(q,{textOnly:!0,size:"small",leftIcon:e(E,{name:"edit_m",size:24,"data-test":"Icon"}),onClick:()=>{o(!0)},"data-test":"Button",children:["Add description"," ",e(p,{colorToken:"--text-body-neutral-default","data-test":"TSpan",children:"(optional)"})]})})]})})}function Pt({values:t,index:a}){return e(N.PreviewMainRow,{displayLineNumbers:!0,index:a,children:e(u,{grow:!0,"data-test":"StackItem",children:i(c,{gap:16,align:"center","data-test":"Stack",children:[i(c,{gap:4,vertical:!0,align:"stretch",grow:!0,"data-test":"Stack",children:[e(p,{font:"body-m","data-test":"TSpan",children:t.name}),t.description&&e(p,{font:"footnote",colorToken:"--text-card-neutral-default","data-test":"TSpan",children:t.description})]}),t.dueDate&&i(c,{gap:8,shrink:0,"data-test":"Stack",children:[e(p,{font:"body-m-bold","data-test":"TSpan",children:"Due Date:"}),e(p,{font:"body-m","data-test":"TSpan",children:te(t.dueDate)})]})]})})})}const qt={id:"",name:"",description:"",dueDate:void 0};function Lt({disabled:t=!1}){const a=H({name:"deliverables",initialMode:"preview"});return a.fields.length===0&&a.mode==="preview"?e(_,{title:"Deliverables",titleSideAddon:e(q,{textOnly:!0,size:"small",leftIcon:e(E,{name:"add_m",size:24,"data-test":"Icon"}),onClick:()=>a.showNewItemForm(),disabled:t,"data-test":"Button",children:"Add Item"}),"data-test":"Section"}):e(_,{title:"Deliverables",hasSeparator:!0,"data-test":"Section",children:e(N.Wizard,{name:"deliverables",...a,newItemValues:qt,PreviewModeComponent:Pt,EditModeComponent:Nt})})}function Bt({index:t,fieldNamePrefix:a}){return e(T.EditMode,{children:({control:n})=>e(x,{children:e(T.FormMainRow,{index:t,displayLineNumbers:!0,children:i(c,{gap:16,fullWidth:!0,"data-test":"Stack",children:[e(u,{grow:3,"data-test":"StackItem",children:e(f,{control:n,name:`${a}name`,render:({field:o,fieldState:r})=>e(O,{placeholder:"Description",inputSize:"small",...o,...g(r),"data-test":"TextField"}),"data-test":"Controller"})}),e(u,{shrink:1,"data-test":"StackItem",children:e(M,{label:"Amount:",horizontal:!0,"data-test":"FormControl",children:i(c,{gap:8,align:"center","data-test":"Stack",children:[e(f,{control:n,name:`${a}amount`,render:({field:{ref:o,...r},fieldState:s})=>e(O,{inputSize:"small",numberOnly:!0,isCurrency:!0,...r,...g(s),"data-test":"TextField"}),"data-test":"Controller"}),e(p,{colorToken:"--text-tablecell-header-neutral-default","data-test":"TSpan",children:"USD"})]})})})]})})})})}const Se={id:"",name:"",amount:0};function Vt({disabled:t=!1}){const a=H({name:"expenseReimbursement",initialMode:"create"});return a.fields.length===0?e(_,{variant:"sub-section",title:"Expense Reimbursement",optional:!0,titleSideAddon:e(q,{textOnly:!0,size:"small",leftIcon:e(E,{name:"add_m",size:24,"data-test":"Icon"}),onClick:()=>a.addNewItem(Se),disabled:t,"data-test":"Button",children:"Add Item"}),"data-test":"Section"}):e(_,{variant:"sub-section",title:"Expense Reimbursement",optional:!0,hasSeparator:!0,"data-test":"Section",children:e(T.Wizard,{name:"expenseReimbursement",...a,newItemValues:Se,hasSeparators:!0,EditModeComponent:Bt,SummaryComponent:re})})}const Yt=$.button`
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  flex-grow: 1;
  flex-shrink: 1;
  gap: 12px;
  padding: ${t=>t.size==="small"?"8px 12px":"12px 12px"};
  background-color: transparent;
  border: 1px solid
    ${t=>t.isSelected?"var(--border-option-selector-neutral-pressed)":"var(--border-option-selector-neutral-default)"};
  border-radius: 4px;
  cursor: pointer;
  max-height: 56px;
  height: 56px;
`,jt=$(p).attrs(t=>({font:t.isSelected?"body-m-bold":"body-m"}))`
  white-space: nowrap;
  flex-grow: 1;
`,Ut=$.div`
  flex-grow: 0;
  flex-shrink: 0;
`,Z={Container:Yt,Label:jt,SideElement:Ut};function Ht({size:t,label:a,isSelected:n,leftElement:o,rightElement:r,footerElement:s,onClick:l}){return i(c,{vertical:!0,gap:16,grow:!0,align:"stretch","data-test":"Stack",children:[i(Z.Container,{size:t,isSelected:n,onClick:l,children:[e(ut,{isChecked:n,icon:n?e(E,{name:"radio_btn_m",size:12,color:"--icon-radiobutton-brand-primary-default","data-test":"Icon"}):void 0,"data-test":"Radiobox"}),o&&e(Z.SideElement,{children:o}),e(Z.Label,{isSelected:n,children:a}),r&&e(Z.SideElement,{children:r})]}),s]})}function Jt({size:t="large",options:a,value:n,onChange:o}){return e(c,{gap:16,align:"stretch",justify:"stretch",fullWidth:!0,"data-test":"Stack",children:a.map(r=>e(Ht,{size:t,...r,isSelected:n===r.value,onClick:()=>o(r.value),"data-test":"OptionSelectorItem"},r.value))})}function Gt({onChange:t,...a}){return e(mt,{...a,hideIcons:!1,disabledIconColor:!1,onChange:n=>t(n.value),options:ht.currencyOptions,"data-test":"SelectField"})}function Qt({index:t,fieldNamePrefix:a}){return e(T.EditMode,{children:({control:n})=>i(x,{children:[e(T.FormMainRow,{index:t,displayLineNumbers:!0,children:i(c,{gap:16,fullWidth:!0,"data-test":"Stack",children:[e(u,{grow:0,"data-test":"StackItem",children:e(M,{label:"Amount:",horizontal:!0,"data-test":"FormControl",children:i(c,{gap:8,align:"center","data-test":"Stack",children:[e(f,{control:n,name:`${a}amount`,render:({field:{ref:o,...r},fieldState:s})=>e(O,{inputSize:"small",numberOnly:!0,isCurrency:!0,...r,...g(s),"data-test":"TextField"}),"data-test":"Controller"}),e(p,{colorToken:"--text-tablecell-header-neutral-default","data-test":"TSpan",children:"USD"})]})})}),e(u,{grow:0,"data-test":"StackItem",children:e(M,{label:"Due:",horizontal:!0,"data-test":"FormControl",children:e(f,{control:n,name:`${a}dueDate`,render:({field:{ref:o,...r},fieldState:s})=>e(Y,{size:"small",...r,...g(s),"data-test":"DatePicker"}),"data-test":"Controller"})})})]})}),e(T.FormErrorMessage,{index:t})]})})}const Xt={id:"",amount:0,dueDate:new Date};function Kt(){const t=H({name:"fees.instalments",initialMode:"create"});return e(T.Wizard,{name:"fees.instalments",...t,newItemValues:Xt,hasSeparators:!0,EditModeComponent:Qt,SummaryComponent:re})}function Zt({thisArray:t,otherArray:a,append:n,remove:o}){const r=JSON.stringify(a??null),s=JSON.stringify(t??null);P.useLayoutEffect(()=>{const l=JSON.parse(r),d=JSON.parse(s);if(!d||!l||l.length===d.length)return;if(l.length>d.length){n();return}const b=d.findIndex((D,S)=>!ce.isEqual(D,l[S]));o(b)},[r,s])}function ea({index:t,fieldNamePrefix:a}){const{watch:n}=ae(),o=n(`milestones.${t}`);return e(T.EditMode,{children:({control:r})=>e(x,{children:e(T.FormMainRow,{index:t,displayLineNumbers:!0,children:i(c,{gap:16,align:"center",fullWidth:!0,"data-test":"Stack",children:[e(u,{grow:2,"data-test":"StackItem",children:i(c,{gap:4,vertical:!0,fullWidth:!0,align:"stretch","data-test":"Stack",children:[o==null?void 0:o.name,i(p,{font:"footnote",colorToken:"--text-card-neutral-default","data-test":"TSpan",children:["Delivery Date:"," ",o!=null&&o.dueDate?te(o.dueDate):"--"]})]})}),e(u,{grow:1,"data-test":"StackItem",children:e(M,{label:"Amount:",horizontal:!0,"data-test":"FormControl",children:i(c,{gap:8,align:"center","data-test":"Stack",children:[e(f,{control:r,name:`${a}amount`,render:({field:{ref:s,...l},fieldState:d})=>e(O,{inputSize:"small",numberOnly:!0,isCurrency:!0,...l,...g(d),"data-test":"TextField"}),"data-test":"Controller"}),e(p,{colorToken:"--text-tablecell-header-neutral-default","data-test":"TSpan",children:"USD"})]})})}),e(u,{grow:1,"data-test":"StackItem",children:e(M,{label:"Due:",horizontal:!0,"data-test":"FormControl",children:e(f,{control:r,name:`${a}dueDate`,render:({field:{ref:s,...l},fieldState:d})=>e(Y,{size:"small",...l,...g(d),"data-test":"DatePicker"}),"data-test":"Controller"})})})]})})})})}const ge={id:"",amount:0,dueDate:new Date};function ta(){const{watch:t}=ae(),a=H({name:"fees.milestones",initialMode:"create"});return Zt({thisArray:a.fields,otherArray:t("milestones"),append:()=>a.addNewItem(ge),remove:n=>a.deleteItem(n)}),a.fields.length===0?e(p,{"data-test":"TSpan",children:"You haven't added any Milestones on the previous steps yet."}):e(T.Wizard,{name:"fees.milestones",...a,newItemValues:ge,hasSeparators:!0,canAdd:!1,canDelete:!1,EditModeComponent:ea,SummaryComponent:re})}function aa(){const{control:t,watch:a}=ae(),n=a("fees.feeCategory"),o=[{value:y.Inadvance,label:"In Advance"},{value:y.Installments,label:"Installments"},{value:y.Milestones,label:"Milestones"},{value:y.Lumpsum,label:"Lump Sum"}];return e(_,{title:"Fees",titleSideAddon:e(u,{grow:0,shrink:0,"data-test":"StackItem",children:e(f,{name:"payments.currency",control:t,render:({field:{ref:r,...s},fieldState:l})=>e(Gt,{inputSize:"small",disabled:!0,...s,...g(l),"data-test":"CurrencySelector"}),"data-test":"Controller"})}),"data-test":"Section",children:i(c,{vertical:!0,gap:16,align:"stretch","data-test":"Stack",children:[e(f,{name:"fees.feeCategory",control:t,render:({field:{ref:r,...s}})=>e(Jt,{size:"small",...s,options:o,"data-test":"OptionSelector"}),"data-test":"Controller"}),e(c,{vertical:!0,gap:16,align:"stretch",fullWidth:!0,"data-test":"Stack",children:n===y.Inadvance?i(c,{gap:24,align:"center",justify:"start","data-test":"Stack",children:[e(u,{grow:0,"data-test":"StackItem",children:e(M,{label:"Amount",horizontal:!0,"data-test":"FormControl",children:i(c,{gap:8,align:"center","data-test":"Stack",children:[e(f,{name:"fees.inAdvance.amount",control:t,render:({field:{ref:r,...s},fieldState:l})=>e(O,{inputSize:"small",numberOnly:!0,isCurrency:!0,fullWidth:!1,...s,...g(l),"data-test":"TextField"}),"data-test":"Controller"}),e(p,{colorToken:"--text-tablecell-header-neutral-default","data-test":"TSpan",children:"USD"})]})})}),e(u,{grow:0,"data-test":"StackItem",children:e(M,{label:"Due:",horizontal:!0,"data-test":"FormControl",children:e(f,{name:"fees.inAdvance.dueDate",control:t,render:({field:{ref:r,...s},fieldState:l})=>e(Y,{size:"small",placeholder:"MM/DD/YYYY",...s,...g(l),"data-test":"DatePicker"}),"data-test":"Controller"})})})]}):n===y.Installments?e(Kt,{"data-test":"InstalmentsWizard"}):n===y.Milestones?e(ta,{"data-test":"MilestonesWizard"}):n===y.Lumpsum?i(c,{gap:24,align:"center",justify:"start","data-test":"Stack",children:[e(u,{grow:0,"data-test":"StackItem",children:e(M,{label:"Amount",horizontal:!0,"data-test":"FormControl",children:i(c,{gap:8,align:"center","data-test":"Stack",children:[e(f,{name:"fees.lumpSum.amount",control:t,render:({field:{ref:r,...s},fieldState:l})=>e(O,{inputSize:"small",numberOnly:!0,isCurrency:!0,fullWidth:!1,...s,...g(l),"data-test":"TextField"}),"data-test":"Controller"}),e(p,{colorToken:"--text-tablecell-header-neutral-default","data-test":"TSpan",children:"USD"})]})})}),e(u,{grow:0,"data-test":"StackItem",children:e(M,{label:"Due:",horizontal:!0,"data-test":"FormControl",children:e(f,{name:"fees.lumpSum.dueDate",control:t,render:({field:{ref:r,...s},fieldState:l})=>e(Y,{size:"small",placeholder:"MM/DD/YYYY",...s,...g(l),"data-test":"DatePicker"}),"data-test":"Controller"})})})]}):null})]})})}function ra({values:t,index:a}){const[n,o]=P.useState(!!t.description);return e(N.EditMode,{schema:Me(G,"milestones.0"),values:t,children:({control:r,setValue:s})=>i(x,{children:[e(N.FormMainRow,{index:a,children:e(u,{grow:!0,"data-test":"StackItem",children:i(c,{gap:16,"data-test":"Stack",children:[e(f,{control:r,name:"name",render:({field:l,fieldState:d})=>e(O,{placeholder:"Milestone Name",inputSize:"small",...l,...g(d),"data-test":"TextField"}),"data-test":"Controller"}),e(u,{shrink:0,"data-test":"StackItem",children:e(f,{control:r,name:"dueDate",render:({field:{ref:l,...d},fieldState:b})=>e(Y,{size:"small",label:"Delivery Date",...d,...g(b),required:!0,"data-test":"DatePicker"}),"data-test":"Controller"})})]})})}),e(f,{control:r,name:"description",render:({field:l})=>n?e(u,{grow:!0,"data-test":"StackItem",children:e(se,{placeholder:"Description",maxLength:300,autoResize:!0,...l,"data-test":"TextArea"})}):e(x,{}),"data-test":"Controller"}),e(N.FormFooter,{index:a,children:n?e(q,{textOnly:!0,size:"small",leftIcon:e(E,{name:"close_m",size:24,"data-test":"Icon"}),onClick:()=>{o(!1),s("description","")},"data-test":"Button",children:"Remove description"}):i(q,{textOnly:!0,size:"small",leftIcon:e(E,{name:"edit_m",size:24,"data-test":"Icon"}),onClick:()=>{o(!0)},"data-test":"Button",children:["Add description"," ",e(p,{colorToken:"--text-body-neutral-default","data-test":"TSpan",children:"(optional)"})]})})]})})}function na({values:t,index:a}){return e(N.PreviewMainRow,{displayLineNumbers:!0,index:a,children:e(u,{grow:!0,"data-test":"StackItem",children:i(c,{gap:16,align:"center","data-test":"Stack",children:[i(c,{gap:4,vertical:!0,align:"stretch",grow:!0,"data-test":"Stack",children:[e(p,{font:"body-m","data-test":"TSpan",children:t.name}),t.description&&e(p,{font:"footnote",colorToken:"--text-card-neutral-default","data-test":"TSpan",children:t.description})]}),i(c,{gap:8,shrink:0,"data-test":"Stack",children:[e(p,{font:"body-m-bold","data-test":"TSpan",children:"Delivery Date:"}),e(p,{font:"body-m","data-test":"TSpan",children:te(t.dueDate)})]})]})})})}const oa={id:"",name:"",description:"",dueDate:new Date};function ia({disabled:t=!1}){const a=H({name:"milestones",initialMode:"preview"});return a.fields.length===0&&a.mode==="preview"?e(_,{title:"Milestones",optional:!0,titleSideAddon:e(q,{textOnly:!0,size:"small",leftIcon:e(E,{name:"add_m",size:24,"data-test":"Icon"}),onClick:()=>a.showNewItemForm(),disabled:t,"data-test":"Button",children:"Add Item"}),"data-test":"Section"}):e(_,{title:"Milestones",hasSeparator:!0,optional:!0,"data-test":"Section",children:e(N.Wizard,{name:"milestones",...a,newItemValues:oa,PreviewModeComponent:na,EditModeComponent:ra})})}const la=$(ke)`
  padding: 24px;
  // Don't clip dropdown popover layer
  overflow: visible;

  @media (max-width: ${De.TABLET_MAX}) {
    border-radius: 0;
  }
`,sa=$(ie)`
  width: 100%;
`,B={Card:la,Separator:sa};function da({documentStatus:t,isCreating:a,onNoumChange:n,disableNoum:o=!1,statementOfWork:r}){var D,S,m,A,h,w,C,v;const{control:s,getValues:l,formState:{errors:d}}=ae(),{isDesktop:b}=Ce();return i(c,{gap:b?24:8,vertical:!0,align:"stretch","data-test":"Stack",children:[e(B.Card,{children:i(c,{gap:16,vertical:!0,align:"stretch","data-test":"Stack",children:[i(c,{gap:16,justify:"stretch",align:"center","data-test":"Stack",children:[e(p,{font:"heading-xs-bold","data-test":"TSpan",children:"Title:"}),e(u,{grow:!0,"data-test":"StackItem",children:e(f,{name:"title",control:s,render:({field:F,fieldState:k})=>e(O,{inputSize:"small",disabled:a,...F,...g(k),"data-test":"TextField"}),"data-test":"Controller"})}),e(Ee,{status:t,size:"medium","data-test":"DocumentStatusTag"})]}),e(B.Separator,{}),i(c,{gap:16,vertical:!0,align:"stretch","data-test":"Stack",children:[e(M,{label:"Noum Assignment","data-test":"FormControl",children:e(f,{name:"noumId",render:({field:{ref:F,...k},fieldState:I})=>e(ct,{disabled:o||a,label:"",preselectedItem:r==null?void 0:r.linkedNoum,inputSize:"small",placeholderText:"Find a Noum...",...k,onChange:L=>{k.onChange(L),n()},...g(I),"data-test":"ProjectNoumSelector"}),"data-test":"Controller"})}),i(c,{gap:16,fullWidth:!0,"data-test":"Stack",children:[e(u,{grow:!0,"data-test":"StackItem",children:e(M,{label:"Scope of Work","data-test":"FormControl",children:e(f,{name:"scopeOfWork",render:({field:{ref:F,value:k,...I},fieldState:L})=>e(se,{disabled:a,label:"",maxLength:3e3,placeholder:"Description",value:k??"",...I,...g(L),"data-test":"TextArea"}),"data-test":"Controller"})})}),e(u,{"data-test":"StackItem",children:e(M,{label:"Effective Date","data-test":"FormControl",children:e(f,{name:"effectiveDate",render:({field:{ref:F,...k},fieldState:I})=>e(Y,{disabled:a,label:"",placeholder:"MM/DD/YYYY",size:"small",...k,...g(I),required:!0,"data-test":"DatePicker"}),"data-test":"Controller"})})})]})]})]})}),e(B.Card,{children:e(_,{title:"Contract Attachment",hasSeparator:!0,"data-test":"Section",children:e(f,{name:"contractId",render:({field:{ref:F,...k},fieldState:I})=>e(Mt,{disabled:a,noumId:l("noumId"),inputSize:"small",label:"",placeholderText:"Find a Contract...",noSearchOptionsText:"No contract exists for this Noum. Create a new one or choose a different Noum.",...k,...g(I),"data-test":"ContractSelector"}),"data-test":"Controller"})})}),e(B.Card,{hasError:!!((D=d.deliverables)!=null&&D.message),children:i(c,{vertical:!0,align:"stretch",gap:8,"data-test":"Stack",children:[e(Lt,{disabled:a,"data-test":"DeliverablesWizard"}),e(oe,{message:(S=d.deliverables)==null?void 0:S.message,"data-test":"FormError"})]})}),e(B.Card,{hasError:!!((m=d.milestones)!=null&&m.message),children:i(c,{vertical:!0,align:"stretch",gap:8,"data-test":"Stack",children:[e(ia,{disabled:a,"data-test":"MilestonesWizard"}),e(oe,{message:(A=d.milestones)==null?void 0:A.message,"data-test":"FormError"})]})}),i(B.Card,{hasError:!!((w=(h=d.fees)==null?void 0:h.feeCategory)!=null&&w.message),children:[e(aa,{"data-test":"FeesWizard"}),e(oe,{message:(v=(C=d.fees)==null?void 0:C.feeCategory)==null?void 0:v.message,"data-test":"FormError"})]}),e(B.Card,{children:e(Vt,{disabled:a,"data-test":"ExpenseReimbursementWizard"})}),e(B.Card,{children:e(xt,{disabled:a,"data-test":"BonusCommissionWizard"})})]})}const ca=({statementOfWork:t,isEditMode:a,onSaveDraft:n,onSaveDraftSuccess:o,onDeleteDraft:r,onGoBackToList:s})=>{const{navigateAndPassOrigin:l}=_e(),{t:d}=de(),{addErrorToast:b,addPrimaryIconToast:D,addSuccessIconToast:S}=we(),{logError:m}=Ie(),{modalType:A,openModal:h,closeModal:w}=Pe(),C=J(),{watch:v,formState:{isDirty:F}}=C,{lastSavedAt:k,markLocalChangesAsSaved:I}=rt({form:C}),L=pt(),Q=v("title"),ne=async()=>{if(t!=null&&t._id){if(!L.canSeeSummary(t)){await C.trigger(),b(d("noumena.statement_of_work_form.toast.not_completed"));return}F&&await me(),l(Te(le.STATEMENT_OF_WORK_PREVIEW,{id:t._id}))}},me=async()=>{const X=G.cast(C.getValues());if(!X.noumId){D(d("noumena.statement_of_work_form.toast.no_noum_selected"));return}try{const K=await n(X);if(!K)return;o==null||o(K),I(),S(d("noumena.statement_of_work_form.toast.draft_saved"))}catch(K){m(K,"sow-save-draft")}},Ae=()=>{a?h("delete"):s()},We=async()=>{try{await r(),S(d("noumena.statement_of_work_form.toast.draft_deleted")),w(),s()}catch(X){w(),m(X,"sow-delete-draft")}};return i(x,{children:[e(ft,{title:d(a?"noumena.statement_of_work_form.title.edit":"noumena.statement_of_work_form.title.create"),hasUnsavedChanges:F,updatedAt:k==null?void 0:k.toISOString(),buttons:i(x,{children:[e(ot,{onClick:Ae,isDraft:ee.isDraft(t)}),e(it,{isDraft:ee.isDraft(t),onClick:me,disabled:!a||!F}),e(lt,{onClick:ne,softDisabled:!a||!L.canSeeSummary(t)})]}),"data-test":"StatementOfWorkFormHeader-StickyFormHeader"}),e(St,{isOpen:A==="delete",isDraft:ee.isDraft(t),documentName:Q,documentType:qe.Sow,onCancel:w,onDelete:We,"data-test":"StatementOfWorkFormHeader-DeleteDocumentConfirmationModal"})]})},ua=$(ke)`
  padding: 24px;

  @media (max-width: ${De.TABLET_MAX}) {
    border-radius: 0;
  }
`,ma=$.div`
  width: 390px;
  height: 550px;
  border: 1px solid var(--border-card-neutral-default);
`,be={Card:ua,PdfPreview:ma};function ha({id:t,noumId:a,onCreate:n}){const{logError:o}=Ie(),[r,s]=P.useState(!1),l=!!t,d=Ct({defaultValues:fe.getDefaultValues({noumId:a})}),{reset:b,getValues:D,watch:S}=d,m=S("noumId")??a,{isLoading:A,statementOfWork:h,createStatementOfWork:w,updateStatementOfWork:C,deleteStatementOfWork:v}=kt(t);return P.useEffect(()=>{h&&b(fe.fromStatementOfWork(h))},[b,h]),P.useEffect(()=>{async function F(){const k=G.cast(D());try{s(!0);const I=await w({...k,noumId:m});n(I._id)}catch(I){o(I,"contract-create-draft")}finally{s(!1)}}!l&&m&&F()},[D,l,m]),{form:d,isLoading:A,isCreating:r,isEditMode:l,statementOfWork:h,updateDraft:C,deleteDraft:v}}function Ua(){const{t}=de(),{id:a}=Ue(),{navigateAndPassOrigin:n,goBackToOrigin:o}=_e(),[r]=He(),{isDesktop:s}=Ce(),{addToast:l}=we(),d=r.get("noumId")??void 0,b=P.useCallback(ne=>{n(Te(le.STATEMENT_OF_WORK_EDIT,{id:ne}),{replace:!0})},[n]),{form:D,isLoading:S,isEditMode:m,isCreating:A,statementOfWork:h,updateDraft:w,deleteDraft:C}=ha({id:a,noumId:d,onCreate:b}),v=gt({id:a}),{getValues:F,setValue:k}=D,I=()=>{F("contractId")&&(k("contractId",""),l("primary","icon",t("noumena.statement_of_work_form.toast.noum_changed")))},L=()=>{o({fallbackUrl:Ye.contractManager()})};if(a&&!h&&!S)return e(Je,{to:le.NOT_FOUND,replace:!0,"data-test":"Navigate"});const Q=ee.formatPdfFileName({title:D.watch("title"),SOWNumber:h==null?void 0:h.SOWNumber});return e(Fe,{...D,"data-test":"FormProvider",children:i(bt,{"data-test":"SinglePageLayout",children:[e(ca,{statementOfWork:h,isEditMode:m,onDeleteDraft:C,onSaveDraft:w,onSaveDraftSuccess:()=>v.refetch(),onGoBackToList:L,"data-test":"StatementOfWorkFormHeader"}),e(Dt,{"data-test":"ResponsiveMain",children:S?e(Le,{"data-test":"Spinner"}):i(c,{gap:24,"data-test":"Stack",children:[e(u,{grow:!0,"data-test":"StackItem",children:e(da,{documentStatus:(h==null?void 0:h.status)??Be.Draft,disableNoum:!!d,isCreating:A,onNoumChange:I,statementOfWork:h,"data-test":"StatementOfWorkForm"})}),e(u,{basis:"390px",shrink:0,"data-test":"StackItem",children:i(c,{vertical:!0,gap:24,grow:!1,align:"stretch","data-test":"Stack",children:[s&&e(be.Card,{children:e(_,{variant:"sub-section",title:t("noumena.statement_of_work_form.document_preview.title"),"data-test":"Section",children:i(c,{gap:16,vertical:!0,align:"stretch","data-test":"Stack",children:[e(nt,{data:v.pdfData,isLoading:v.loading,downloadFileName:Q,"data-test":"DocumentPdfThumbnail"}),e(q,{tertiary:!0,icon:e(E,{name:"download_m",size:24,"data-test":"Icon"}),disabled:!v.pdfData,onClick:()=>{v.pdfData&&Ve(v.pdfData,"application/pdf",Q)},"data-test":"Button",children:t("noumena.statement_of_work_form.document_preview.download")})]})})}),e(u,{grow:!1,shrink:!0,"data-test":"StackItem",children:e(be.Card,{children:e(_,{variant:"sub-section",title:t("noumena.statement_of_work_form.disclaimer.title"),"data-test":"Section",children:e(p,{font:"body-m",colorToken:"--text-card-neutral-default","data-test":"TSpan",children:t("noumena.statement_of_work_form.disclaimer.description")})})})})]})})]})})]})})}export{Ua as default};
//# sourceMappingURL=StatementOfWorkForm-f9224247.js.map
