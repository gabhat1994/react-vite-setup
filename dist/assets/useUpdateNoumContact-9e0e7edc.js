import{r as I,C as f,am as X,an as C,bF as R,ap as Z,aq as D,bE as J,l as K,ar as $,bb as N,bz as Y}from"./vendor-51460554.js";import{j as e,m as tt,x as _,I as U,T as E,b7 as V,F as et,fM as at,fN as q,aC as ot,au as j,y as g,X as nt,ki as rt,c as S,M as lt,t as it,n as ct,h as st,i as dt,da as L,k as mt,B as P,kj as ut,kk as ft,U as pt,kl as Ct,km as Nt,kn as yt}from"./index-cd84bcc9.js";import{g as h}from"./forms-18e3c53a.js";import{A as ht}from"./ApiEntityPickerField-cfd6d0d6.js";import{F as bt}from"./Flag-d41fef47.js";import{c as Ft}from"./countries-4aa86a38.js";import{S as gt}from"./SelectField-54706174.js";function _t(t,r){if(r==="")return t;const l=t.filter(a=>!!(a.type!=="value"||a.type==="value"&&String(a.label).toLowerCase().includes(r)));return l.filter((a,i)=>!(a.type==="header"&&i===l.length-1||a.type==="header"&&l[i+1].type==="header"))}function St({options:t,...r}){const[l,s]=I.useState(""),a=I.useMemo(()=>{const i=l.toLowerCase();return _t(t,i)},[l,t]);return e(ht,{options:a,inputValue:l,onInputChange:s,...r,"data-test":"ApiEntityPickerField"})}const Mt=f(_).attrs(()=>({gap:12,align:"stretch",fullWidth:!0,vertical:!0}))``,It=f(_).attrs(()=>({gap:12,fullWidth:!0,align:"stretch"}))`
  display: grid;
  grid-template-columns: 1fr 1fr;

  @media (max-width: ${tt.MOBILE_L_MAX}) {
    grid-template-columns: 1fr;
  }
`,Tt=f(_).attrs(()=>({vertical:!0,gap:12,grow:1,align:"stretch",justify:"start"}))`
  padding: 16px;
  border: 1px solid var(--border-card-neutral-default);
  border-radius: 8px;
`,kt=f(_).attrs(()=>({gap:8,align:"center"}))``,xt=f(U).attrs(()=>({name:"warning_m",size:20,color:"--icon-card-warning-default"}))``,wt=f(E).attrs(()=>({font:"body-m-bold",colorToken:"--text-card-header-neutral-highlighted"}))``,zt=f(_).attrs(()=>({vertical:!0,gap:0,align:"stretch"}))``,Et=f(E).attrs(()=>({font:"body-m",colorToken:"--text-card-neutral-highlighted"}))``,Bt=f(E).attrs(()=>({font:"body-m",colorToken:"--text-card-neutral-default"}))``,Ut=f(E).attrs(()=>({font:"body-m",colorToken:"--text-card-neutral-disabled"}))``,ee={Container:Mt,SectionsContainer:It,Section:Tt,Header:kt,Content:zt,Title:wt,ErrorIcon:xt,MissingInfo:Ut,TextHighlighted:Et,Text:Bt};var M=(t=>(t.Existing="EXISTING",t.New="NEW",t))(M||{});const F="${label} cannot be empty.",Ot=X({userId:C().required(F).ensure().label("User"),userType:R().oneOf(Object.values(M)).required(),fullName:C().ensure().required(F).trim().label("Full Name"),contactName:C().required(F).trim().ensure().label("Contact Name"),email:C().email().required(F).trim().ensure().label("Email Address"),title:C().required(F).trim().ensure().label("Title"),companyName:C().ensure().trim().label("Company Name"),country:C().required(F).ensure().trim().label("Country"),city:C().required(F).ensure().trim().label("City"),street:C().required(F).ensure().trim().label("Street"),apartmentNo:C().trim().ensure().label("Apartment No."),state:C().required(F).ensure().trim().label("State"),zipCode:C().required(F).ensure().trim().label("Zip code")});function vt({defaultValues:t}={}){return Z({defaultValues:t,resolver:D(Ot),mode:"onBlur"})}function At(){return J()}function qt(t){return{fullName:t.fullName,displayName:t.contactName,userId:t.userType===M.New?void 0:t.userId,email:t.email,title:t.title,companyName:t.companyName,country:t.country,street:t.street,apartmentNo:t.apartmentNo,city:t.city,state:t.state,zipCode:t.zipCode}}function Vt(t,r){return{contactId:t,displayName:r.contactName,title:r.title,companyName:r.companyName,country:r.country,street:r.street,apartmentNo:r.apartmentNo,city:r.city,state:r.state,zipCode:r.zipCode}}function Lt(t){return{userId:t.user._id,userType:M.Existing,fullName:V.renderFullName(t.user),contactName:t.displayName??t.fullName??"",email:t.user.email??"",title:t.title??"",companyName:t.companyName??"",country:t.country??"us",street:t.street??"",apartmentNo:t.apartmentNo??"",city:t.city??"",state:t.state??"",zipCode:t.zipCode??""}}function Pt(){return{userId:"",contactName:"",email:"",title:"",city:"",companyName:"",country:"us",street:"",apartmentNo:"",state:"",zipCode:""}}const z={toAddNewNoumContactInput:qt,toUpdateNoumContactInput:Vt,fromSearchableNoumContact:Lt,getDefaultValues:Pt},W=Ft.map(t=>({type:"value",key:t.iso2,label:t.name,value:t.iso2,icon:e(bt,{flag:`flag_${t.iso2}`,size:24,"data-test":"countryOptions-Flag"})}));function Wt({onChange:t,value:r,...l}){var a;const s=W.find(i=>i.value===r);return e(St,{...l,value:r,hideIcons:!1,leftIcon:(s==null?void 0:s.icon)??void 0,inputValue:(a=s==null?void 0:s.label)==null?void 0:a.toString(),onChange:i=>t(i==null?void 0:i.value),options:W,rightIcon:e(et,{}),"data-test":"ApiEntityPickerFieldWithLocalSearch"})}const $t=f(_).attrs(()=>({gap:24,vertical:!0,fullWidth:!0}))``,jt=f(E).attrs(()=>({font:"body-l-bold",colorToken:"--text-modal-header-neutral-default"}))``,Ht=f(_).attrs(()=>({gap:16,vertical:!0,fullWidth:!0}))``,x={Section:$t,SectionTitle:jt,SectionBody:Ht},Gt=10;function Qt({onChange:t,...r}){var m;const[l,s]=I.useState(null),{data:a,loading:i,fetchMore:u}=at({variables:{query:l,excludeEntityTypes:[q.Event,q.Post,q.ProjectNoum],limit:Gt,offset:0},skip:!l}),d=l?a==null?void 0:a.globalSearch.data:void 0,c=((m=a==null?void 0:a.globalSearch)==null?void 0:m.count)??0,y=l?[{key:"add_new",label:`Add ${l}`,type:"value",value:{fullName:l,userType:M.New},icon:e(U,{name:"add_m",size:24,"data-test":"stickyHeaderOptions-Icon"})}]:[],T=I.useMemo(()=>ot(d).map(({user:p,id:O})=>({key:p.id??O,label:p.name,description:p.title?p.title:void 0,value:{...p,fullName:p.name??"",userType:M.Existing},type:"value",icon:e(j,{url:p.thumbnailUrl,size:"M","data-test":"options-Avatar"})})),[d]),w=I.useMemo(()=>K.debounce(s,300),[]);return e(gt,{...r,options:T,hideIcons:!1,stickyHeaderOptions:y,onChange:p=>{t(p),s(null)},onInputChange:w,onFetchMore:()=>{d&&c>d.length&&u({variables:{offset:d.length}})},isLoading:i,isOpen:!!l,"data-test":"SelectField"})}function Xt({canChangeUser:t,selectedUserData:r,userType:l,onSelectUser:s,onResetUser:a}){const{t:i}=$(),{control:u}=At();if(!l)return e(N,{control:u,name:"userId",render:({field:{onChange:c,ref:y,...T},fieldState:w})=>e(Qt,{...T,label:i("noumena.noum_contacts.contact_form.fields.full_name"),leftIcon:e(U,{name:"search_m",size:24,color:"--icon-input-neutral-default","data-test":"Icon"}),disabled:!t,noChevron:!0,onChange:m=>{c(m.key),s(m)},...h(w),"data-test":"UserSearch"}),"data-test":"Controller"},"userId");const d=l===M.Existing;return e(N,{control:u,name:"fullName",render:({field:{value:c}})=>{var y;return e(g,{readOnly:d,disabled:d,label:i("noumena.noum_contacts.contact_form.fields.full_name"),inputSize:"normal",value:c,leftIcon:d&&e(j,{url:((y=r==null?void 0:r.profile)==null?void 0:y.profilePictureThumbnail)??void 0,size:"M","data-test":"Avatar"}),rightIconColor:"--icon-input-neutral-default",rightIcon:t?e(U,{name:"close_m",size:16,onClick:a,"data-test":"Icon"}):void 0,"data-test":"TextField"})},"data-test":"Controller"},"fullName")}const ae=({contact:t,isOpenModal:r,onClose:l,onConfirm:s})=>{const{t:a}=$(),{isMobile:i}=nt(),u=t?z.fromSearchableNoumContact(t):z.getDefaultValues(),d=vt({defaultValues:u}),{control:c,handleSubmit:y,formState:{isSubmitting:T,isValid:w},setValue:m,getValues:p,watch:O,reset:H}=d,[G,v]=O(["userId","userType"]),{data:A,loading:Q}=rt({variables:{id:G},skip:v!==M.Existing}),b=A==null?void 0:A.user,B=!!t;return I.useEffect(()=>{if(!b)return;const n=p(),{userAddress:o,...k}=b;m("fullName",n.fullName||V.renderFullName(k),{shouldDirty:!0,shouldValidate:!0}),m("contactName",n.contactName||V.renderFullName(k)),m("email",(n.email||k.email)??""),m("title",(n.title||k.title)??""),m("street",(n.street||(o==null?void 0:o.street))??""),m("apartmentNo",(n.apartmentNo||(o==null?void 0:o.apartment))??""),m("city",(n.city||(o==null?void 0:o.city))??""),m("state",(n.state||(o==null?void 0:o.state))??""),m("zipCode",(n.zipCode||(o==null?void 0:o.zipcode))??"")},[p,b,m]),S(lt,{isFullScreen:i,open:r,testId:"add_new_contact_modal",size:it.L,onClose:l,isScrollableContent:!0,enableCloseButton:!0,disableBackdropClick:!0,"data-test":"ContactFormModal-Modal",children:[Q&&e(ct,{"data-test":"ContactFormModal-Spinner"}),e("form",{onSubmit:y(s),children:S(Y,{...d,"data-test":"ContactFormModal-FormProvider",children:[e(st,{"data-test":"ContactFormModal-ModalHeader",children:a(B?"noumena.noum_contacts.contact_form.title.edit":"noumena.noum_contacts.contact_form.title.add")}),e(dt,{hasScrollBar:!0,"data-test":"ContactFormModal-ModalBody",children:S(_,{gap:24,vertical:!0,fullWidth:!0,"data-test":"ContactFormModal-Stack",children:[S(x.Section,{children:[e(x.SectionTitle,{children:a("noumena.noum_contacts.contact_form.basic_information")}),S(x.SectionBody,{children:[e(Xt,{canChangeUser:!B,selectedUserData:b,userType:v,onSelectUser:n=>{m("fullName",n.value.fullName),m("userType",n.value.userType),m("contactName",n.value.fullName)},onResetUser:()=>{H(z.getDefaultValues())},"data-test":"ContactFormModal-UserField"}),e(N,{control:c,name:"email",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.email"),disabled:B||v===M.Existing&&!!(b!=null&&b.email),...h(o,b&&b.email?a("noumena.noum_contacts.contact_form.fields.email.from_user_no_edit",{firstName:b.firstName??""}):void 0),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"}),e(N,{control:c,name:"contactName",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.contact_name"),...h(o,a("noumena.noum_contacts.contact_form.fields.contact_name.helper_text")),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"}),e(N,{control:c,name:"title",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.title"),...h(o),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"}),e(N,{control:c,name:"companyName",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.company_name"),...h(o),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"})]})]}),S(x.Section,{children:[e(x.SectionTitle,{children:a("noumena.noum_contacts.contact_form.billing_details")}),S(x.SectionBody,{children:[e(N,{control:c,name:"country",render:({field:{ref:n,...o},fieldState:k})=>e(Wt,{label:a("noumena.noum_contacts.contact_form.fields.country"),...o,...h(k),"data-test":"ContactFormModal-CountrySelector"}),"data-test":"ContactFormModal-Controller"}),e(N,{control:c,name:"city",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.city"),...h(o),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"}),e(N,{control:c,name:"street",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.street"),...h(o),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"}),e(N,{control:c,name:"apartmentNo",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.apartment_no"),...h(o),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"}),S(_,{gap:8,fullWidth:!0,"data-test":"ContactFormModal-Stack",children:[e(L,{grow:1,"data-test":"ContactFormModal-StackItem",children:e(N,{control:c,name:"state",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.state"),...h(o),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"})}),e(L,{grow:1,"data-test":"ContactFormModal-StackItem",children:e(N,{control:c,name:"zipCode",render:({field:n,fieldState:o})=>e(g,{...n,label:a("noumena.noum_contacts.contact_form.fields.zip_code"),...h(o),"data-test":"ContactFormModal-TextField"}),"data-test":"ContactFormModal-Controller"})})]})]})]})]})}),e(mt,{"data-test":"ContactFormModal-ModalFooter",children:S(_,{fullWidth:!0,gap:16,"data-test":"ContactFormModal-Stack",children:[e(P,{primary:!0,size:"full",testId:"confirm_btn",tertiary:!0,grow:!0,loading:!1,onClick:l,disabled:T,"data-test":"ContactFormModal-Button",children:a("noumena.cancel")}),e(P,{primary:!0,type:"submit",size:"full",loading:T,softDisabled:!w,disabled:T,"data-test":"ContactFormModal-Button",children:a(B?"noumena.noum_contacts.contact_form.cta.submit.edit":"noumena.noum_contacts.contact_form.cta.submit.add")})]})})]})})]})};function oe(){const[t]=ut();return[I.useCallback(l=>t({variables:{input:z.toAddNewNoumContactInput(l)},update(s,a,{variables:i}){var d;const u=(d=a.data)==null?void 0:d.addNewNoumContact;!u||!i||(s.updateQuery({query:ft,variables:{limit:20,offset:0,status:pt.Active,query:null}},c=>{if(!c)return null;const y={...u,__typename:"SearchableNoumContact",fullName:i.input.displayName,email:i.input.email,user:u.userId,createdAt:""};return{...c,allNoumsContacts:{...c.allNoumsContacts,count:c.allNoumsContacts.count+1,data:[y,...c.allNoumsContacts.data]}}}),!i.input.userId&&u.userId._id&&s.writeFragment({fragment:Ct,id:s.identify({__typename:"UserOutput",_id:u.userId._id}),data:{_id:u.userId._id,firstName:i.input.displayName,lastName:null,email:i.input.email,userStatus:"UNAUTHENTICATED",profile:null}}))}}),[t])]}function ne(){const[t]=Nt();return[I.useCallback((l,s)=>t({variables:{input:z.toUpdateNoumContactInput(l,s)},update(a,i,{variables:u}){var c;const d=(c=i.data)==null?void 0:c.updateNoumContact;d&&a.updateFragment({fragment:yt,id:a.identify({__typename:"SearchableNoumContact",_id:u==null?void 0:u.input.contactId}),fragmentName:"SearchableNoumContact"},y=>({...y,...d,__typename:"SearchableNoumContact",fullName:d.displayName,email:d.userId.email||s.email,user:d.userId}))}}),[t])]}export{St as A,ae as C,ee as S,ne as a,oe as u};
//# sourceMappingURL=useUpdateNoumContact-9e0e7edc.js.map
