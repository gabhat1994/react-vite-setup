import{c as u,M as ae,j as t,h as oe,i as ne,x as F,T as _,F as z,S as re,y as se,k as ie,B as L,Y as ce,v as le,aR as de,qY as pe,qZ as ue,Z as me,$ as ge,_ as p,q_ as fe,qV as P,bZ as ye,X as he,n as W,I as be,q as Ae}from"./index-cd84bcc9.js";import{S as Ce}from"./index-38931f83.js";import{a as Te,T as ke}from"./index-594821a1.js";import{I as Se}from"./Infobox-cf6af02b.js";import{H as je}from"./Header-df950621.js";import{A as Ie}from"./Actions-ad30ea8c.js";import{u as Me,L as Oe,E as Pe}from"./useDownload-7aa57628.js";import{C as we,G as xe}from"./Goals-de02e71c.js";import{r as f,aa as ve,bc as Be}from"./vendor-51460554.js";import"./ChamberLeftSideBar-2a7f8e7f.js";import"./index-2d186805.js";import"./useResizeObserver-0deb9469.js";import"./sideNavItems-22800105.js";import"./styles-b4894a1f.js";import"./index-4963229a.js";import"./Modal-5a254f40.js";import"./useInvoice-3a46c6ed.js";import"./types-3fb18ef5.js";import"./helper-53a5becb.js";import"./OtpInput-6d75f9c8.js";import"./done-439b31ee.js";import"./Radiobox-c1e62033.js";import"./SetupPin-06f1ecff.js";import"./Stepper-2453d15a.js";import"./html2canvas.esm-f1efbbfd.js";import"./jspdf.es.min-1ca9e9b7.js";import"./NoumCard-2fa806c2.js";import"./CountryCard-e0d91c6e.js";import"./Flag-d41fef47.js";import"./generateCategoricalChart-e9d4ef07.js";function Ee({open:a,action:o,onClose:m,onAction:r,actionButtonLoading:e=!1}){const[d,y]=f.useState("");return u(ae,{open:a,enableCloseButton:!0,onClose:m,children:[t(oe,{children:o==="accept"?"Terms & Conditions":"Reject"}),t(ne,{children:u(F,{vertical:!0,maxWidth:400,align:"center",justify:"center","data-test":"Stack",children:[t(_,{font:"body-l",colorToken:"--text-modal-neutral-default",textAlign:"center","data-test":"TSpan",children:o==="accept"?`I acknowledge and accept that Noumena does not guarantee a 100%
            efficiency rate, as the outcome of the campaign will be influenced
            by various market factors beyond Noumena's control.`:"Please provide a reason for rejecting this offer to help us improve our offerings in the future."}),o==="reject"&&u(z,{children:[t(re,{height:16,"data-test":"Spacer"}),t(se,{value:d,fullWidth:!0,label:"Reason (optional)",autoFocus:!0,onChange:g=>y(g.target.value),"data-test":"TextField"})]})]})}),u(ie,{gap:16,justifyContent:"center",children:[t(L,{size:"full",tertiary:!0,onClick:m,"data-test":"Button",children:"Cancel"}),t(L,{size:"full",primary:!0,loading:e,intent:o==="accept"?"positive":"negative",onClick:()=>r(o,d),"data-test":"Button",children:o==="accept"?"I Agree":"Reject"})]})]})}const Re=()=>{var v;const a=ce(),o=ve(),[m,r]=f.useState(!0),[e]=Be(),d=e.get("campaignId"),{addSuccessIconToast:y,addErrorToast:g,addPrimaryIconToast:i}=le(),{modalType:h,openModal:c,closeModal:s}=de(),[b,{loading:D}]=pe({fetchPolicy:"cache-and-network",onError:n=>a.logError(n,"check-wallet-status",!1)}),[w,{data:T,loading:N}]=ue({onError:n=>a.logError(n,"get-default-campaign-account",!1)}),{data:k,refetch:S,loading:q}=me({skip:!d,variables:{campaignId:d??""},onError:n=>a.logError(n,"campaign-summary-in-offer",!0)}),{data:l,refetch:j,loading:H}=ge({variables:{offerId:o.id??""},skip:!o.id,onError:n=>a.logError(n,"offer-by-id",!0)}),Q=p.mapCampaignAcount(T==null?void 0:T.getCampaignAccount),[x,{loading:U}]=fe({onError:n=>a.logError(n,"reject-offer",!0),onCompleted:({rejectAdCampaignOffer:n})=>{n.success&&(s(),y("Offer has been declined. We’ve been notified."),S(),j())}}),Y=f.useCallback(async(n,C)=>{var B,E,R;switch(n){case"accept":const{data:M}=await b(),ee=(B=M==null?void 0:M.getWalletBalance)==null?void 0:B.status;if(!ye.includes(ee??"")){g("Your wallet is not yet created. Please retry after creating you wallet in Money Page."),s();return}const{data:O}=await w(),te=(E=O==null?void 0:O.getCampaignAccount)==null?void 0:E.id;s(),te?c("pay"):g("Unable to process payment at this time. Contact Noumena Support");break;case"reject":x({variables:{offerId:((R=l==null?void 0:l.getAdCampaignOfferOne)==null?void 0:R._id)??"",reason:C}});break;default:s()}},[b,w,s,x,(v=l==null?void 0:l.getAdCampaignOfferOne)==null?void 0:v._id,c,g]),I={...p.mapCampaignForOffer(k==null?void 0:k.getSelectedAdCampaignDetails),campaignId:d},G=f.useCallback(()=>c("accept"),[c]),V=f.useCallback(()=>c("reject"),[c]),A=p.cleanOffer(l==null?void 0:l.getAdCampaignOfferOne),Z=p.hideReject(A.status),$=p.hidePayment(I.status,A.status),X=p.isRepayment(I.status,A.status),J=f.useCallback(async()=>{var C;s(),S();const{data:n}=await j();n&&((C=n==null?void 0:n.getAdCampaignOfferOne)==null?void 0:C.status)===P.Accepted&&i("We are processing your payment, the campaign will change its status soon.")},[i,s,S,j]),K=f.useCallback(()=>{r(n=>!n)},[]);return{campaign:I,offer:A,campaignAccount:Q,repayment:X,refetch:{onAccepted:J},loading:{page:q||H,rejection:U,campaignAccount:N,wallet:D},button:{hideRejected:Z,hidePayment:$},modal:{modalType:h,handleModalAction:Y,closeModal:s},userAction:{acceptAndPay:G,reject:V},infobox:{toggle:K,open:m}}},Le=(a,o)=>[P.Accepted,P.Rejected].includes(a)?t(Ae,{tertiary:!0,"data-test":"renderLabel-Tag",children:u(_,{font:"body-m-bold",colorToken:"text-tag-neutral-default","data-test":"renderLabel-TSpan",children:[a&&p.capitalizeFirstLetter(a)," ",":  "," ",o&&p.formatDate(o)]})}):t(z,{});function mt(){const a=he(),{modal:o,userAction:m,campaign:r,offer:e,campaignAccount:d,button:y,refetch:g,loading:i,repayment:h,infobox:c}=Re(),{Ref:s,handleDownloadPdf:b}=Me();return u(Ce,{"data-test":"SinglePageLayout",children:[i.page?t(W,{"data-test":"Spinner"}):t(je,{heading:`Offer #${e.oid}`,label:Le(e.status,e.updatedAt),isMobile:a.isMobile,isTablet:a.isTablet,stepper:!1,currentStep:0,totalSteps:0,wrap:!0,rightAction:t(Ie.OfferActions,{hideAcceptAndPay:y.hidePayment,hideRejectButton:y.hideRejected,disableButtons:i.page,onAcceptAndPay:m.acceptAndPay,onDownload:()=>b({document:"offer",documentId:e.oid}),onReject:m.reject}),"data-test":"Header"}),i.page?t(W,{"data-test":"Spinner"}):t("div",{ref:s,style:{alignSelf:"center",width:"100%",display:"flex",justifyContent:"center"},children:u(Oe.Main,{children:[h&&c.open&&t("div",{style:{width:a.isDesktop||a.isLaptop?"100%":"90%",padding:a.isMobile||a.isTablet?"20px":"0px"},children:t(Se,{type:"negative","data-test":"Infobox",children:u(F,{justify:"space-between",align:"center","data-test":"Stack",children:[t("div",{children:"Payment verification failed. Please click “Accept and Pay” to try again."}),t("div",{style:{cursor:"pointer"},onClick:c.toggle,children:t(be,{name:"close_s",size:24,color:"--border-infobox-danger-primary-default","data-test":"Icon"})})]})})}),t(we,{title:r.title,startAt:e.startAt,createdAt:e.createdAt,endAt:e.endAt,adId:r.adId,category:r.category,targetLanguage:r.targetLanguage,targetLocation:r.targetLocation,clicksWeekly:e.clicksWeekly,costTotal:e.costTotal,costWeekly:e.costWeekly,reachTotal:e.reachTotal,cpc:e.cpc,noumId:r.noumId,isMobile:a.isMobile,estimatedDuration:e.estimatedDuration,"data-test":"CampaignOfferSummary"}),t(Pe,{campaignCreatedBy:r.createdBy.firstName??"",createdBy:e.createdBy,message:e.message,"data-test":"ExpertMessage"}),t(xe,{isMobile:a.isMobile,goalConnectedUsers:e.goalConnectedUsers,goalNoumVisibility:e.goalNoumVisibility,status:e.status,estimatedDuration:e.estimatedDuration,isTablet:a.isTablet,"data-test":"Goals"})]})}),(o.modalType==="accept"||o.modalType==="reject")&&t(Ee,{open:!!o.modalType,actionButtonLoading:i.campaignAccount||i.rejection||i.wallet,onClose:o.closeModal,action:o.modalType??"accept",onAction:o.handleModalAction,"data-test":"OfferActions"}),o.modalType==="pay"&&t(Te,{open:o.modalType==="pay",type:ke.PAY,isDestinationDropdownDisabled:!0,defaultWalletPayee:d,defaultAmount:e.costTotal??0,handleClose:g.onAccepted,disableAmountsField:!0,campaignId:(r==null?void 0:r.campaignId)??"",offerId:e._id??"",campaignRepayment:h,"data-test":"TransactionModal"})]})}export{mt as default};
//# sourceMappingURL=CampaignOffer-f7f10607.js.map
