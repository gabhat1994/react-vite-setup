import{j as e,x as l,T as g,c,da as V,aQ as G,et as H,I as Z,ae as tt,a2 as et,f as at,F as O,eu as nt,aC as S,W as N,ev as J,ew as rt,ex as st,ey as it,V as R,ez as j,eA as ot,v as ut,eB as ct,eC as lt}from"./index-cd84bcc9.js";import{C as v,ay as dt,am as mt,bI as M,ap as gt,aq as ft,bE as ht,ar as X,l as St,r as W}from"./vendor-51460554.js";import{A as b}from"./payloadParser-f4cc4e4f.js";import{f as $}from"./getTimeStampForDisplaying-22d5ca9d.js";import{L as y,E as pt,D as yt,A as U,u as bt}from"./styles-548b0144.js";import{D as Dt,S as wt}from"./statementOfWork-e03c986f.js";import{S as T}from"./Section-2a57cf43.js";import{I as kt}from"./Infobox-cf6af02b.js";import{R as vt}from"./RouterLink-30e622d4.js";import"./styles-58edde60.js";import{C as Q}from"./contactDetails-4902172b.js";import{C as _}from"./contract-47e31a61.js";import{u as Y}from"./statementOfWorkPermissions-68d8aac2.js";import{u as Ct}from"./statementOfWork-f09edc55.js";import{a as Tt}from"./statementOfWorkPdf-95417ec8.js";function _t({children:t}){return e(l,{vertical:!0,gap:16,align:"stretch",fullWidth:!0,"data-test":"Stack",children:t})}const xt=v(g).attrs(()=>({font:"body-m",colorToken:"--text-card-neutral-highlighted"}))``,At=v(g).attrs(()=>({font:"footnote",colorToken:"--text-card-neutral-default"}))``,q={Title:xt,Description:At};function It({index:t,title:a,description:i,dueDate:n,amount:o}){return c(l,{gap:16,align:"center",fullWidth:!0,"data-test":"Stack",children:[e(V,{basis:"20px","data-test":"StackItem",children:c(g,{font:"body-m",colorToken:"--text-card-neutral-default","data-test":"TSpan",children:["#",t+1]})}),c(l,{vertical:!0,gap:4,align:"stretch",grow:!0,"data-test":"Stack",children:[e(q.Title,{children:a}),i?e(q.Description,{children:i}):null]}),n?c(l,{gap:8,"data-test":"Stack",children:[e(g,{font:"body-m-bold","data-test":"TSpan",children:"Due: "})," ",e(g,{font:"body-m","data-test":"TSpan",children:$(n)})]}):null,o?e(l,{gap:8,"data-test":"Stack",children:G(o,H.Usd,2)}):null]})}function Lt({label:t,value:a}){return c(l,{gap:8,justify:"end","data-test":"Stack",children:[e(g,{font:"body-l",colorToken:"--text-card-neutral-highlighted","data-test":"TSpan",children:t}),e(g,{font:"body-l-bold",colorToken:"--text-card-neutral-highlighted","data-test":"TSpan",children:a})]})}const D={List:_t,Item:It,Total:Lt};function K({title:t,iconName:a="file_xs"}){return c(l,{gap:8,align:"center","data-test":"Stack",children:[e(Z,{name:a,size:16,"data-test":"Icon"}),e(g,{font:"body-m","data-test":"TSpan",children:t})]})}const Pt=v(tt)`
  padding: 24px;
`,Ft=v(et)`
  width: 100%;
  margin: 0;
`,Et=v.div`
  width: 100%;
  height: 300px;
  background-color: var(--text-tab-basic-neutral-disabled);
  border-radius: 8px;
`,Nt=v.div`
  cursor: pointer;
`,w={Card:Pt,Separator:Ft,PDFPreview:Et,ContractButtonLink:Nt};function Vt({contract:t,openContractFromSow:a}){const{isOpsUser:i}=at();return t!=null&&t.title?c(l,{gap:8,align:"stretch",vertical:!0,fullWidth:!0,"data-test":"Stack",children:[i?e(w.ContractButtonLink,{role:"button",tabIndex:0,onKeyPress:()=>{},onClick:()=>{a==null||a({sowId:void 0,contractId:t._id})},children:e(K,{title:_.formatDocumentNameWithNumber(t),"data-test":"AttachedFile"})}):e(vt,{to:nt.viewContract({id:t._id}),passState:!0,"data-test":"RouterLink",children:e(K,{title:_.formatDocumentNameWithNumber(t),"data-test":"AttachedFile"})}),c(l,{gap:4,align:"stretch",vertical:!0,fullWidth:!0,"data-test":"Stack",children:[e(y,{size:"small",layout:"horizontal",label:"Buyer",value:t.buyer?Q.formatCompanyAndName(t.buyer):"--","data-test":"LabelValue"}),e(y,{size:"small",layout:"horizontal",label:"Provider",value:t.seller?Q.formatCompanyAndName(t.seller):"--","data-test":"LabelValue"}),e(y,{size:"small",layout:"horizontal",label:"Effective Date",value:t.effectiveDate?$(b.parseDateString(t.effectiveDate)):"--","data-test":"LabelValue"})]}),_.isDraft(t)&&e(kt,{type:"secondary",size:"small","data-test":"Infobox",children:e(dt,{i18nKey:"noumena.statement_of_work_preview.hint.draft_contract",components:{b:e("b",{"data-test":"b"})},"data-test":"Trans"})})]}):e(O,{children:"-"})}const Wt=mt({isAuthorized:M().oneOf([!0]),termsAndConditions:M().oneOf([!0]),eSign:M().oneOf([!0])});function zt({defaultValues:t}={}){return gt({defaultValues:t,resolver:ft(Wt),mode:"onChange"})}function Rt(){return ht()}function jt(t,a,i){switch(t){case N.Inadvance:{const n=a[0];return[{title:"In Advance",amount:n.amount??0,dueDate:b.parseDateString(n.dueDate)}]}case N.Installments:return a.map((n,o)=>({title:`Installment #${o+1}`,amount:n.amount??0,dueDate:b.parseDateString(n.dueDate)}));case N.Milestones:{const n=S(i);return a.map((o,d)=>({title:n[d].title??"",amount:o.amount??0,dueDate:b.parseDateString(o.dueDate)}))}case N.Lumpsum:{const n=a[0];return[{title:"Lump Sum",amount:n.amount??0,dueDate:b.parseDateString(n.dueDate)}]}default:return[]}}function Mt(t){return t.map(a=>({title:a.description??"",description:"Type: Expense Reimbursement",amount:a.amount??0}))}function Ut(t){return t.map(a=>({title:a.description??"",description:"Type: Bonus / Commission",amount:a.amount??0}))}function Bt(t){var p,u;const a=[],i=(p=t.fees)==null?void 0:p.type,n=S((u=t.fees)==null?void 0:u.feesData),o=S(t.expenseReimbursement),d=S(t.commission);return i&&n.length>0&&a.push(...jt(i,n,S(t.milestones))),o.length>0&&a.push(...Mt(o)),d.length>0&&a.push(...Ut(d)),a}function se({statementOfWork:t,openContractFromSow:a}){var I,L,P,F,E;const{t:i}=X(),{formState:{isValid:n,isSubmitted:o}}=Rt(),d=Y(),p=o&&!n,u=d.canSign(t),r=S(t.deliverables),m=S(t.milestones),x=S((I=t.fees)==null?void 0:I.feesData),C=S(t.expenseReimbursement),k=S(t.commission),z=r.length>0||m.length>0||x.length>0||C.length>0||k.length>0,A=Bt(t);return c(l,{gap:24,vertical:!0,align:"stretch","data-test":"Stack",children:[e(w.Card,{children:e(T,{title:c(O,{children:[e(g,{font:"heading-xs-bold","data-test":"TSpan",children:t.title}),e(Dt,{status:t.status,"data-test":"DocumentStatusTag"})]}),titleSideAddon:c(g,{font:"body-m",colorToken:"--text-card-neutral-disabled","data-test":"TSpan",children:["ID:"," ",wt.formatDocumentNumber(t.SOWNumber)]}),"data-test":"Section",children:c(l,{gap:16,vertical:!0,"data-test":"Stack",children:[e(y,{label:"Scope of Work - Description",value:e(g,{font:"input-m","data-test":"TSpan",children:t.scopeOfWork||"--"}),"data-test":"LabelValue"}),c(l,{gap:24,fullWidth:!0,justify:"stretch","data-test":"Stack",children:[e(V,{grow:1,"data-test":"StackItem",children:e(y,{label:"Effective Date",value:t.effectiveDate?$(b.parseDateString(t.effectiveDate)):"--","data-test":"LabelValue"})}),e(V,{grow:2,basis:"min-content","data-test":"StackItem",children:e(y,{label:"Contract Assignment",value:e(Vt,{contract:t.linkedContract,openContractFromSow:a,"data-test":"ContractAssignment"}),"data-test":"LabelValue"})}),e(V,{grow:3,"data-test":"StackItem",children:e(y,{label:"Noum",value:e(pt,{name:((L=t.linkedNoum)==null?void 0:L.name)??"",avatarUrl:((P=t.linkedNoum)==null?void 0:P.profileImageThumbnail)??void 0,"data-test":"EntityDisplay"}),"data-test":"LabelValue"})})]})]})})}),z&&e(w.Card,{children:e(T,{title:"Summary","data-test":"Section",children:c(l,{gap:16,vertical:!0,align:"stretch","data-test":"Stack",children:[r.length>0&&e(y,{gap:16,label:"Deliverables",value:e(D.List,{children:r.map((s,h)=>e(D.Item,{index:h,title:(s==null?void 0:s.title)??"",description:(s==null?void 0:s.description)??void 0,dueDate:s!=null&&s.dueDate?b.parseDateString(s==null?void 0:s.dueDate):void 0},h))}),"data-test":"LabelValue"}),m.length>0&&e(y,{gap:16,label:"Milestones",value:e(D.List,{children:m.map((s,h)=>e(D.Item,{index:h,title:(s==null?void 0:s.title)??"",description:(s==null?void 0:s.description)??void 0,dueDate:s!=null&&s.dueDate?b.parseDateString(s==null?void 0:s.dueDate):void 0},h))}),"data-test":"LabelValue"}),(x.length>0||C.length>0||k.length>0)&&c(O,{children:[e(w.Separator,{}),e(T,{variant:"sub-section",title:"Fees and other items","data-test":"Section",children:c(l,{gap:16,vertical:!0,fullWidth:!0,align:"stretch","data-test":"Stack",children:[" ",e(D.List,{children:A.map((s,h)=>e(D.Item,{...s,index:h},h))}),e(D.Total,{label:"Total:",value:G(St.sumBy(A,"amount"),H.Usd,2)})]})})]})]})})}),t.timeline&&e(w.Card,{children:e(T,{title:"Timeline","data-test":"Section",children:e(yt,{items:t.timeline,buyer:(F=t.linkedContract)==null?void 0:F.buyer,serviceProvider:(E=t.linkedContract)==null?void 0:E.seller,documentType:J.Sow,"data-test":"DocumentTimeline"})})}),e(w.Card,{hasError:p,id:"agreements",children:e(T,{title:"Agreements","data-test":"Section",children:c(l,{gap:16,vertical:!0,align:"stretch","data-test":"Stack",children:[e(w.Separator,{}),e(U,{name:"isAuthorized",label:i("noumena.statement_of_work_preview.agreements.is_authorized"),disabled:!u,"data-test":"AgreementCheckbox"}),e(U,{name:"termsAndConditions",label:i("noumena.statement_of_work_preview.agreements.terms_and_conditions"),disabled:!u,"data-test":"AgreementCheckbox"}),e(U,{name:"eSign",label:i("noumena.statement_of_work_preview.agreements.e_sign"),disabled:!u,"data-test":"AgreementCheckbox"}),p&&e(g,{font:"body-m",colorToken:"--bg-button-danger-primary-default","data-test":"TSpan",children:i("noumena.contracts_document_preview.agreements.required")})]})})})]})}function B(t,a,i){t.updateFragment({fragment:ot,fragmentName:"SOW",id:t.identify({__typename:"SOW",_id:a})},n=>n?{...n,status:i}:null)}function Ot({id:t}){const[a]=rt({update(u,r){var m;!((m=r.data)!=null&&m.sendDocumentForSigning)||!t||B(u,t,R.Issued)},refetchQueries:[j]}),[i]=st({update(u,r){var m;!((m=r.data)!=null&&m.signSow)||!t||B(u,t,R.Signed)},refetchQueries:[j]}),[n]=it({update(u,r){var m;!((m=r.data)!=null&&m.rejectSow)||!t||B(u,t,R.Draft)},refetchQueries:[j]}),o=W.useCallback(async()=>{var r;if(!t)return;if(!((r=(await a({variables:{id:t}})).data)!=null&&r.sendDocumentForSigning))throw new Error("Unable to send the document. Please try again later.")},[t,a]),d=W.useCallback(async()=>{var r;if(!t)return;if(!((r=(await i({variables:{id:t}})).data)!=null&&r.signSow))throw new Error("Unable to sign the document. Please try again later.")},[t,i]),p=W.useCallback(async()=>{var r;if(!t)return;if(!((r=(await n({variables:{id:t}})).data)!=null&&r.rejectSow))throw new Error("Unable to decline the document. Please try again later.")},[t,n]);return{sendForSigning:o,sign:d,reject:p}}function ie({id:t}){const[a,i]=W.useState("Summary"),{t:n}=X(),{addSuccessIconToast:o,addErrorToast:d,addPrimaryIconToast:p}=ut(),u=Y(),{statementOfWork:r,isLoading:m,deleteStatementOfWork:x}=Ct(t),C=Tt({id:t,statementOfWork:r}),k=Ot({id:t}),z=zt({defaultValues:{eSign:!1,isAuthorized:!1,termsAndConditions:!1}}),A=bt({defaultValues:{documentContentsChecked:!1,validSignature:!1}}),[I]=ct(),L=async()=>{if(_.isDraft(r==null?void 0:r.linkedContract)){d(n("noumena.statement_of_work_preview.toast.draft_contract",{documentName:_.formatDocumentNameWithNumber(r==null?void 0:r.linkedContract)}));return}i("ConfirmSignature")},P=async()=>{if(r)try{u.isOwner(r)?(await k.sendForSigning(),o(n("noumena.statement_of_work_preview.toast.sent_for_signing"))):(await k.sign(),o(n("noumena.statement_of_work_preview.toast.signed"))),i("Summary")}catch(f){f instanceof Error&&d(f.message)}},F=async()=>{try{await k.reject(),o(n("noumena.contract_preview.toast.declined")),i("Summary")}catch(f){f instanceof Error&&d(f.message)}},E=async()=>{try{await x(t),o(n("noumena.statement_of_work_preview.toast.draft_deleted"))}catch(f){f instanceof Error&&d(f.message)}},s=async()=>{p("QA Note: Duplicating is not implemented yet.")},h=async()=>{if(t)try{await I({variables:{documentId:t,type:J.Sow,sendTo:[lt.CounterParty]}}),o(n("noumena.statement_of_work_preview.toast.resent"))}catch(f){f instanceof Error&&d(f.message)}};return{summary:{isLoading:m,form:z,onSubmit:L},signature:{isLoading:C.loading,pdfWithSignature:C.pdfData??void 0,form:A,onSubmit:P},statementOfWork:r,previewStep:a,changeStep:i,deleteStatementOfWork:E,declineStatementOfWork:F,duplicateStatementOfWork:s,resendStatementOfWork:h}}export{se as S,ie as u};
//# sourceMappingURL=useStatementOfWorkPreviewScreen-5a4349a4.js.map
