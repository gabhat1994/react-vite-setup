import{v as de,qo as me,j as e,M as ue,t as le,c as p,F as h,h as ce,i as pe,T as z,k as Ce,B as $,w as B,bY as Q,u as ve,cx as we,cz as F,cm as he,I as N,qp as Pe,dQ as b,cB as j,qq as ge,cD as q,cC as Ee,g as J,R as ee,n as f,cv as H,x as P,a1 as te,s as be,m as fe,bP as S,a2 as W,cO as Se,aj as De,X as _e,cb as ye}from"./index-cd84bcc9.js";import{r as d,B as L,f as xe,ar as ae,a9 as U,b2 as re,C as D,a6 as Ne,ay as He,aa as ke}from"./vendor-51460554.js";import{c as ie,d as O,P as Te,C as Me,D as Be,E as X}from"./EditChamberHeader-95bc6aab.js";import{A as se}from"./index-4963229a.js";import{U as oe,C as k,V as K,W as Y,X as ne,Y as Ve}from"./index-401975c0.js";import{C as T,a as Z}from"./noumViewHelper-950fd893.js";import{C as Ie}from"./CustomPreviewBodyV2-ef59ffd0.js";import"./getTimeStampForDisplaying-22d5ca9d.js";import"./MemberStatusTag-69ed5aaa.js";import"./ChamberActionModal-ce3fca40.js";import"./styles-1a9b9e59.js";import"./LinkNoumOption-dc9c410c.js";import"./consts-be860660.js";import"./SelectField-54706174.js";import"./forms-18e3c53a.js";import"./memoize-one.esm-7e8505cb.js";import"./Element-9cea61d7.js";import"./SkeletonChamberBox-5e97f066.js";import"./Modal-5a254f40.js";import"./styles-0c3f5396.js";import"./ChamberCompleteness-c76bd15d.js";import"./capitalizeFirstLetter-92ef0abb.js";import"./RichTextEditorView-3d7dc014.js";import"./purify.es-89df9bf9.js";import"./url-8d85408e.js";import"./UploadMedia-5fe81e87.js";import"./styles-9b108e05.js";import"./index-e04cac67.js";import"./index-ea5d695b.js";import"./helper-53a5becb.js";import"./index-1f4ed9fc.js";import"./styles-46bbc451.js";import"./getColorByNoumType-1fec2f43.js";import"./TokenModal-504d4668.js";import"./main-wallet-6d7dbd11.js";import"./HandleUnlinkNoum-c385ad89.js";import"./index-022aaf3d.js";import"./styles-26e8a352.js";import"./Pagination-43542d57.js";import"./TickCheckbox-c4d9d4b6.js";import"./Accordion-ea03839b.js";import"./useResizeObserver-0deb9469.js";import"./MultiselectField-a1e665cb.js";import"./useElementDimensions-84b2a778.js";import"./utils-87d126b1.js";import"./styles-75177d6f.js";import"./Radiobox-c1e62033.js";import"./NoSearchResultsForNoums-50e9f00f.js";import"./styles-d2f9f396.js";import"./EllipsisMenu-8495dca0.js";import"./styles-58edde60.js";import"./trackingEvents-87d8ea4c.js";import"./useGenerateTokenForCQ-2d299743.js";import"./useScrollIntoElement-809d6327.js";import"./NewHomeConversationUserSelector-1a2609b0.js";import"./MessageInput-4cf1b973.js";import"./helper-75d0b640.js";import"./index-594821a1.js";import"./useInvoice-3a46c6ed.js";import"./types-3fb18ef5.js";import"./OtpInput-6d75f9c8.js";import"./done-439b31ee.js";import"./SetupPin-06f1ecff.js";import"./PostItem-d75f4356.js";import"./browser-f98ef106.js";import"./CreateSection-88a250eb.js";import"./styles-6b43a970.js";import"./lib-45016883.js";import"./utils-da9c4d96.js";import"./DocumentTypeTag-ae42a623.js";import"./contractPermissions-cf3fd14b.js";import"./contract-47e31a61.js";import"./statementOfWorkPermissions-68d8aac2.js";import"./statementOfWork-e03c986f.js";import"./navigation-419d637e.js";import"./contactDetails-4902172b.js";import"./countries-4aa86a38.js";import"./payloadParser-f4cc4e4f.js";import"./index-2d186805.js";import"./generateCategoricalChart-e9d4ef07.js";import"./CustomDateInputMaskField-46ce4df4.js";import"./styles-e426deab.js";import"./styles-b4894a1f.js";import"./HoverWrapper-680bb0f6.js";function Ae(){const{addToast:t}=de(),[a,{loading:r}]=me(),m=d.useCallback(async(o,C)=>{let i;try{await a({variables:{noumId:o,elements:C}}),i=!0,t("success","icon",L("noumena.noum_edit.custom_preview.toast.save_success"))}catch(n){let c="Unknown";n instanceof Error&&(c=n.message),t("error","none",c),xe(new Error(c),{tags:{section:"updateNoumCustomPreviewMutation"}}),i=!1}return i},[t,a]);return{loading:r,updateNoumCustomPreviewHelper:m}}const Re=d.memo(t=>{const{t:a}=ae(),r=async()=>{console.log(t.spaceId),t.handleClose(!0)};return e(ue,{testId:"testNoumCustomPreviewDiscardChange",open:t.isOpen,onClose:t.handleClose,size:le.S,disableBackdropClick:!0,"data-test":"NoumCustomPreviewDiscardChange-Modal",children:p(h,{children:[e(ce,{"data-testid":"titleNoumCustomPreviewDiscardChange","data-test":"NoumCustomPreviewDiscardChange-ModalHeader",children:a("noumena.container.chamber_discard_change.title")}),e(pe,{align:"center","data-test":"NoumCustomPreviewDiscardChange-ModalBody",children:e(z,{"data-testid":"bodyNoumCustomPreviewDiscardChange",font:"body-l",textAlign:"center",colorToken:"--text-modal-neutral-default","data-test":"NoumCustomPreviewDiscardChange-TSpan",children:a("noumena.noum_edit.custom_preview.exit_modal.description")})}),p(Ce,{flexDirection:"column",gap:16,"data-test":"NoumCustomPreviewDiscardChange-ModalFooter",children:[e($,{"data-testid":"confirmNoumCustomPreviewDiscardChange",primary:!0,intent:"negative",size:"full",onClick:r,"data-test":"NoumCustomPreviewDiscardChange-Button",children:a("noumena.noum_edit.custom_preview.exit_modal.confirm_button")}),e($,{"data-testid":"continueEditingNoumCustomPreviewDiscardChange",tertiary:!0,size:"full",onClick:()=>t.handleClose(),"data-test":"NoumCustomPreviewDiscardChange-Button",children:a("noumena.noum_edit.custom_preview.exit_modal.cancel_button")})]})]})})}),M=d.forwardRef(({lastCustomPreviewSavedTime:t="",selectedCustomPreviewTab:a,spaceId:r},m)=>{const{flags:{noumEditor2:o,noumCustomPreivewV2:C}}=B(),{hasUnsavedCustomPreview:i,updateCustomPreviewElements:n,customPreviewElements:c}=Q(),{t:u}=ae(),s=U(),[v,_]=d.useState(!1),y=d.useCallback(()=>{i?_(!0):s(-1)},[i,s]),{width:V}=ve(),I=V>768,A=d.useCallback(E=>{_(!1),E&&(n==null||n([]),s(-1))},[s,n]),{updateNoumCustomPreviewHelper:l,loading:w}=Ae(),g=d.useCallback(async()=>{await l(r,c)&&s(-1)},[c,s,r,l]),R=()=>e(j,{className:"xs-block","data-test":"CustomPreviewHeader-RenderMobileStatus-StatusWrapper",children:t&&p(ge,{"data-test":"CustomPreviewHeader-RenderMobileStatus-MobileStatusWrapper",children:[u("noumena.noum_edit.custom_preview.header.status.last_update"),":"," ",t,e(q,{colorToken:"--text-top-nav-neutral-default","data-test":"CustomPreviewHeader-RenderMobileStatus-EditChangeStatusText",children:a===b.Edit?u("noumena.noum_edit.custom_preview.header.status.preview_saved"):u("noumena.noum_edit.custom_preview.header.status.all_preview_saved")})]})}),x=({className:E="xs-hidden"})=>e(j,{className:`xs-${E}`,"data-test":"CustomPreviewHeader-RenderStatus-StatusWrapper",children:t&&p(Ee,{labelSize:"small","data-testid":`lastPublishedLabel_xs_${E}`,className:`xs-${E}`,"data-test":"CustomPreviewHeader-RenderStatus-StatusLabel",children:[u("noumena.noum_edit.custom_preview.header.status.last_update"),":"," ",t,e(q,{colorToken:"--text-top-nav-neutral-default","data-test":"CustomPreviewHeader-RenderStatus-EditChangeStatusText",children:a===b.Edit?u("noumena.noum_edit.custom_preview.header.status.preview_saved"):u("noumena.noum_edit.custom_preview.header.status.all_preview_saved")})]})});return p(we,{ref:m,"data-testid":"Edit-Header","data-test":"CustomPreviewHeader-EditHeaderWrapperNew",children:[o&&C?e(F,{size:"small",onClick:y,secondary:i,intent:"negative",tertiary:!i,"data-test":"CustomPreviewHeader-StyledButton",children:u(i?"noumena.cancel":"noumena._new_header.done_button.text")}):e(he,{"data-test":"CustomPreviewHeader-IconWrapper",children:e(N,{name:"arrow_left_m",size:24,onClick:y,color:"--icon-top-nav-global-element-neutral-highlighted","data-test":"CustomPreviewHeader-Icon"})}),e(x,{className:"hidden","data-test":"CustomPreviewHeader-RenderStatus"}),e(Pe,{"data-test":"CustomPreviewHeader-ButtonsWrapper",children:e(F,{"data-testid":"EditHeader-CustomPreview-Save",primary:!0,size:"small",onClick:g,loading:w,disabled:!i||w||c.length===0||!r,"data-test":"CustomPreviewHeader-StyledButton",children:a===b.Edit?u("noumena.noum_edit.custom_preview.header.button.save"):u("noumena.header.publish_button.text")})}),I?e(x,{className:"block","data-test":"CustomPreviewHeader-RenderStatus"}):e(R,{"data-test":"CustomPreviewHeader-RenderMobileStatus"}),e(Re,{isOpen:v,spaceId:r,handleClose:A,"data-test":"CustomPreviewHeader-NoumCustomPreviewDiscardChange"})]})}),We=({id:t})=>{const{isOpen:a,isOwner:r,isArchived:m,isOnLoad:o,lastCustomPreviewSavedTime:C}=ie(t),{space:i,loading:n}=J(t,!0),{flags:c}=B(),u=U(),[s,v]=d.useState(b.Edit);return d.useEffect(()=>{c.customNoums||u(re(ee.EDIT_NOUM,{id:t}))},[c.customNoums,t,u]),n||!i?e(f,{"data-test":"EditCustomPreview-Spinner"}):c.newAppNavigation?e(H,{space:i,loading:n,id:t,"data-test":"EditCustomPreview-EditChamberProvider",children:i&&r&&!m&&e(se.Layout,{topNavbar:e(oe,{"data-test":"EditCustomPreview-CustomPreviewTopNavbar",children:e(M,{spaceId:t,selectedCustomPreviewTab:s,lastCustomPreviewSavedTime:C,"data-test":"EditCustomPreview-CustomPreviewHeader"})}),children:e(T,{id:t,isCustomPreview:!0,"data-test":"EditCustomPreview-Chamber",children:e(k,{header:p(h,{children:[e(K,{"data-test":"EditCustomPreview-HeadDCPTab",children:e(Y,{selectedCustomPreviewTab:s,setSelectedCPreviewTab:v,"data-test":"EditCustomPreview-CustomPreviewRightPanel"})}),e(Z,{isCustomPreview:!0,"data-test":"EditCustomPreview-ChamberHeader"})]}),isCustomPreview:!0,hasSideBar:!1,selectedCustomPreviewTab:s,setSelectedCPreviewTab:v,"data-test":"EditCustomPreview-ChamberViewLayout",children:n||o?e(P,{"data-test":"EditCustomPreview-Stack",children:!a&&e(f,{"data-test":"EditCustomPreview-Spinner"})}):e(h,{children:e(O,{space:i,isCustomPreview:!0,selectedCustomPreviewTab:s,"data-test":"EditCustomPreview-EditChamberBody"})})})})})}):e(H,{space:i,loading:n,id:t,"data-test":"EditCustomPreview-EditChamberProvider",children:i&&r&&!m&&p(ne,{"data-testid":"EDIT-CHAMBER",className:"App","data-test":"EditCustomPreview-AppStyled",children:[e(te,{isBorderRadius:!1,"data-test":"EditCustomPreview-Header",children:e(M,{spaceId:t,selectedCustomPreviewTab:s,lastCustomPreviewSavedTime:C,"data-test":"EditCustomPreview-CustomPreviewHeader"})}),e(T,{id:t,isCustomPreview:!0,"data-test":"EditCustomPreview-Chamber",children:e(k,{header:p(h,{children:[e(K,{"data-test":"EditCustomPreview-HeadDCPTab",children:e(Y,{selectedCustomPreviewTab:s,setSelectedCPreviewTab:v,"data-test":"EditCustomPreview-CustomPreviewRightPanel"})}),e(Z,{isCustomPreview:!0,"data-test":"EditCustomPreview-ChamberHeader"})]}),isCustomPreview:!0,hasSideBar:!1,selectedCustomPreviewTab:s,setSelectedCPreviewTab:v,"data-test":"EditCustomPreview-ChamberViewLayout",children:n||o?e(P,{"data-test":"EditCustomPreview-Stack",children:!a&&e(f,{"data-test":"EditCustomPreview-Spinner"})}):e(h,{children:e(O,{space:i,isCustomPreview:!0,selectedCustomPreviewTab:s,"data-test":"EditCustomPreview-EditChamberBody"})})})})]})})},Le=D.div`
  padding: 16px;
`,Oe=D.div`
  padding-bottom: 8px;
  width: 100%;
  &:empty {
    padding-bottom: 0px;
  }
  @media (max-width: ${be.TABLET_L}) {
    width: 100%;
    margin: auto;
  }
`,ze=D.div`
  &:first-child {
    padding-top: 0px;
  }
`,Ue=Ne`
  @media (max-width: ${fe.MOBILE_L_MAX}) {
    display: none;
  }
`,G=D.div`
  cursor: pointer;
  opacity: ${t=>t.disabled?"0.2":"1"};
  &.xs-hidden {
    ${Ue}
  }
`,$e=D(z)`
  text-overflow: ellipsis;
  overflow: hidden;
`,Fe=d.memo(({element:t,isDragging:a,provided:r,handleCPVisibilityChange:m})=>{const o=S.isCustomPreviewVisible(t),C=()=>{t!=null&&t._id&&(m==null||m(t._id,!o))};return p(ze,{ref:r==null?void 0:r.innerRef,...r==null?void 0:r.draggableProps,isDragging:a,"data-testid":t._id,hidden:!S.isCPVisibilityChangeable(t),"data-test":"DragableElement-DNDContainer",children:[p(P,{fullWidth:!0,justify:"space-between",align:"center",padding:12,"data-test":"DragableElement-Stack",children:[p(P,{gap:8,maxWidth:194,overflow:"hidden",align:"center","data-test":"DragableElement-Stack",children:[e(G,{...r==null?void 0:r.dragHandleProps,"data-test":"DragableElement-WrapperIcons",children:e(N,{name:"order_m",size:24,color:"--icon-button-neutral-default","data-test":"DragableElement-Icon"})}),e(z,{"data-test":"DragableElement-TSpan",children:e(N,{name:S.getIconName(t),size:24,color:"--icon-button-neutral-default","data-test":"DragableElement-Icon"})}),e($e,{font:"footnote",colorToken:"--text-card-neutral-highlighted","data-test":"DragableElement-ToolNameSpan",children:t.elementType})]}),e(G,{"data-test":"DragableElement-WrapperIcons",children:e(N,{onClick:C,name:o?"eye_on_m":"eye_off_m",size:24,color:o?"--icon-button-brand-primary-hover":"--icon-card-neutral-default","data-test":"DragableElement-Icon"})})]}),e(W,{noMargin:!0,fullWidth:!0,"data-test":"DragableElement-Separator"})]})}),je=d.memo(t=>e(Te,{draggableId:`${t.element._id}`,index:t.index,disableInteractiveElementBlocking:!0,"data-test":"DragableArea-Draggable",children:(a,r)=>e(Fe,{...t,isDragging:r.isDragging,provided:a,"data-test":"DragableArea-DragableElement"})})),qe=t=>e(Me,{droppableId:"custom_preview_panel_list","data-test":"DroppableArea-Droppable",children:(a,r)=>p(Oe,{ref:a.innerRef,isDraggingOver:r.isDraggingOver,isDraggingFrom:!!r.draggingFromThisWith,...a.droppableProps,"data-testid":"custom-preview-panel-wrapper","data-test":"DroppableArea-DropZone",children:[t.elements.map((m,o)=>d.createElement(je,{...t,key:m._id,index:o,currentIndex:o,totalIndex:t.elements.length-1,element:m,"data-test":"DroppableArea-DragableArea"})),a.placeholder]})}),Xe=()=>{const{id:t,space:a,elements:r,sendRerenderEvent:m,updateCustomPreviewElements:o,customPreviewElements:C,hasUnsavedCustomPreview:i}=Q(),n=d.useRef(null),[c,u]=d.useState(!1),[s,v]=d.useState([]),_=l=>{n.current=l},y=d.useCallback(l=>{if(c)return null;const w=n.current;if(!w)return null;const g=w.tryGetLock(l,()=>{});return g?g.snapLift():null},[c]),V=d.useCallback(()=>{u(!0)},[]),I=d.useCallback(l=>{if(u(!1),!t||!l.destination||l.destination.index===l.source.index)return;const w=Se(s,l.source.index,l.destination.index);if(o){const g=w.map((R,x)=>({_id:R._id,customPosition:x+1}));o(g)}v(w),m()},[t,s,m,o]);d.useEffect(()=>{let l;if(i?l=S.unSavedfilterAndSortCPPublished(r,C,b.Edit):l=r,l){const w=S.filterMasterElement(l,(a==null?void 0:a.type)===De.Home);v(w)}},[C,i,r,a==null?void 0:a.type]);const A=d.useCallback((l,w)=>{o==null||o([{_id:l,isCustomPreviewVisible:w}])},[o]);return e(Be,{onDragStart:V,onDragEnd:I,sensors:[_],"data-test":"CustomPreviewPanelDnd-DragDropContext",children:e(qe,{spaceId:t,elements:s,lift:y,handleCPVisibilityChange:A,"data-test":"CustomPreviewPanelDnd-DroppableArea"})})},Ke=({open:t})=>{const{isDesktop:a}=_e();return e(ye,{className:"noums_container",placement:"right",nonBlockingModal:a,disableEscapeKeyDown:!0,isBackgroundOpacity:!a,height:"100%",padding:0,width:"250px",title:L("noumena.noum_edit.custom_preview"),titleFont:"body-m-bold",open:t,"data-test":"CustomPreviewPanel-SideModal",children:p(P,{vertical:!0,fullWidth:!0,align:"stretch","aria-label":"custom_preview_panel","data-test":"CustomPreviewPanel-Stack",children:[e(W,{noMargin:!0,fullWidth:!0,"data-test":"CustomPreviewPanel-Separator"}),e(Le,{"aria-label":"custom_preview_panel_description","data-test":"CustomPreviewPanel-DescriptionWrapper",children:e(He,{i18nKey:L("noumena.noum_edit.custom_previews.descriptiontop"),components:{span:e(Ve,{"data-test":"CustomPreviewPanel-StyledTSpan"})},"data-test":"CustomPreviewPanel-Trans"})}),e(W,{noMargin:!0,fullWidth:!0,"data-test":"CustomPreviewPanel-Separator"}),e(Xe,{"data-test":"CustomPreviewPanel-CustomPreviewPanelDnd"})]})})},Ye=({id:t})=>{const{isOpen:a,isOwner:r,isArchived:m,isOnLoad:o,lastCustomPreviewSavedTime:C}=ie(t),{space:i,loading:n}=J(t,!0),{flags:c}=B(),u=U(),[s,v]=d.useState(b.Edit);return d.useEffect(()=>{c.customNoums||u(re(ee.EDIT_NOUM,{id:t}))},[c.customNoums,t,u]),n||!i?e(f,{"data-test":"EditCustomPreviewV2-Spinner"}):c.newAppNavigation?e(H,{space:i,loading:n,id:t,"data-test":"EditCustomPreviewV2-EditChamberProvider",children:i&&r&&!m&&e(se.Layout,{topNavbar:e(oe,{"data-test":"EditCustomPreviewV2-CustomPreviewTopNavbar",children:e(M,{spaceId:t,selectedCustomPreviewTab:s,lastCustomPreviewSavedTime:C,"data-test":"EditCustomPreviewV2-CustomPreviewHeader"})}),children:e(T,{id:t,isCustomPreview:!0,"data-test":"EditCustomPreviewV2-Chamber",children:e(k,{header:e(X,{isCustomPreview:!0,"data-test":"EditCustomPreviewV2-EditChamberHeader"}),hasSideBar:!1,selectedCustomPreviewTab:s,setSelectedCPreviewTab:v,"data-test":"EditCustomPreviewV2-ChamberViewLayout",children:n||o?e(P,{"data-test":"EditCustomPreviewV2-Stack",children:!a&&e(f,{"data-test":"EditCustomPreviewV2-Spinner"})}):p(h,{children:[e(Ie,{"data-test":"EditCustomPreviewV2-CustomPreviewBodyV2"}),e(Ke,{open:!0,"data-test":"EditCustomPreviewV2-CustomPreviewPanel"})]})})})})}):e(H,{space:i,loading:n,id:t,"data-test":"EditCustomPreviewV2-EditChamberProvider",children:i&&r&&!m&&p(ne,{"data-testid":"EDIT-CHAMBER",className:"App","data-test":"EditCustomPreviewV2-AppStyled",children:[e(te,{isBorderRadius:!1,"data-test":"EditCustomPreviewV2-Header",children:e(M,{spaceId:t,selectedCustomPreviewTab:s,lastCustomPreviewSavedTime:C,"data-test":"EditCustomPreviewV2-CustomPreviewHeader"})}),e(T,{id:t,isCustomPreview:!0,"data-test":"EditCustomPreviewV2-Chamber",children:e(k,{header:e(X,{isCustomPreview:!0,"data-test":"EditCustomPreviewV2-EditChamberHeader"}),isCustomPreview:!0,hasSideBar:!1,selectedCustomPreviewTab:s,setSelectedCPreviewTab:v,"data-test":"EditCustomPreviewV2-ChamberViewLayout",children:n||o?e(P,{"data-test":"EditCustomPreviewV2-Stack",children:!a&&e(f,{"data-test":"EditCustomPreviewV2-Spinner"})}):e(h,{children:e(O,{space:i,isCustomPreview:!0,selectedCustomPreviewTab:s,"data-test":"EditCustomPreviewV2-EditChamberBody"})})})})]})})},Ze=()=>{const{id:t=""}=ke(),{flags:{noumCustomPreivewV2:a,noumEditor2:r}}=B();return a&&r?e(Ye,{id:t,"data-test":"Index-EditCustomPreviewV2"}):e(We,{id:t,"data-test":"Index-EditCustomPreview"})},xa=Ze;export{xa as default};
//# sourceMappingURL=CustomPreview-6247e4aa.js.map
