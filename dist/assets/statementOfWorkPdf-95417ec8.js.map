{"version":3,"file":"statementOfWorkPdf-95417ec8.js","sources":["../../src/features/contracts/hooks/statementOfWorkPdf.ts"],"sourcesContent":["import { NetworkStatus } from '@apollo/client';\nimport { useCallback } from 'react';\nimport {\n  useGetStatementOfWorkPdfLazyQuery,\n  useGetStatementOfWorkPdfQuery,\n  useGetStatementOfWorkPdfWithSignatureQuery,\n} from '@/apollo/graphql';\nimport { useToast } from '@/hooks';\nimport { base64ToDataString } from '@/utils/base64ToBlob';\nimport { downloadFileFromUrl } from '@/utils/file';\nimport { type StatementOfWork } from '../types';\nimport { useContractSigningParty } from './contractSigningParty';\n\ninterface UseStatementOfWorkPdfOptions {\n  id?: string;\n}\n\nexport function useStatementOfWorkPdf({ id }: UseStatementOfWorkPdfOptions) {\n  const { data, networkStatus, refetch } = useGetStatementOfWorkPdfQuery({\n    notifyOnNetworkStatusChange: true,\n    fetchPolicy: 'cache-and-network',\n    variables: {\n      id: id!,\n    },\n    skip: !id,\n  });\n\n  const base64 = data?.getSingleSOW?.sowPDF?.base64;\n  const pdfData = base64 ? base64ToDataString(base64, 'application/pdf') : null;\n\n  return {\n    pdfData,\n    loading: [NetworkStatus.loading, NetworkStatus.refetch].includes(\n      networkStatus,\n    ),\n    refetch,\n  };\n}\n\nexport function useDownloadStatementOfWorkPdfLazy() {\n  const { addPrimaryIconToast } = useToast();\n\n  const [getStatementOfWorkPdf] = useGetStatementOfWorkPdfLazyQuery({\n    fetchPolicy: 'network-only',\n  });\n\n  const downloadContractPdf = useCallback(\n    async (statementOfWorkId: string, fileName: string) => {\n      addPrimaryIconToast('PDF download will begin shortly.');\n\n      const { data } = await getStatementOfWorkPdf({\n        variables: { id: statementOfWorkId },\n      });\n      const base64 = data?.getSingleSOW?.sowPDF?.base64;\n\n      if (!base64) {\n        return;\n      }\n\n      await downloadFileFromUrl(\n        base64ToDataString(base64, 'application/pdf'),\n        'application/pdf',\n        fileName,\n      );\n    },\n    [addPrimaryIconToast, getStatementOfWorkPdf],\n  );\n\n  return downloadContractPdf;\n}\n\ninterface UseContractPdfWithSignatureOptions {\n  id?: string;\n  statementOfWork?: StatementOfWork | null;\n}\n\nexport function useStatementOfWorkPdfWithSignature({\n  id,\n  statementOfWork,\n}: UseContractPdfWithSignatureOptions) {\n  const { signee } = useContractSigningParty(\n    statementOfWork?.linkedContract ?? null,\n  );\n\n  const { data, networkStatus } = useGetStatementOfWorkPdfWithSignatureQuery({\n    fetchPolicy: 'cache-and-network',\n    variables: {\n      id: id!,\n      contactId: signee?._id ?? '',\n    },\n    skip: !id || !signee,\n  });\n\n  const base64 = data?.previewWithSign?.base64;\n  const pdfData = base64 ? base64ToDataString(base64, 'application/pdf') : null;\n\n  return {\n    pdfData,\n    loading: [NetworkStatus.loading, NetworkStatus.refetch].includes(\n      networkStatus,\n    ),\n  };\n}\n"],"names":["useStatementOfWorkPdf","id","data","networkStatus","refetch","useGetStatementOfWorkPdfQuery","notifyOnNetworkStatusChange","fetchPolicy","variables","skip","base64","getSingleSOW","sowPDF","pdfData","base64ToDataString","loading","NetworkStatus","includes","useDownloadStatementOfWorkPdfLazy","addPrimaryIconToast","useToast","getStatementOfWorkPdf","useGetStatementOfWorkPdfLazyQuery","downloadContractPdf","useCallback","statementOfWorkId","fileName","downloadFileFromUrl","useStatementOfWorkPdfWithSignature","statementOfWork","signee","useContractSigningParty","linkedContract","useGetStatementOfWorkPdfWithSignatureQuery","contactId","_id","previewWithSign"],"mappings":"0KAiBO,SAASA,EAAsB,CAAEC,GAAAA,CAAiC,EAAG,SACpE,KAAA,CAAEC,KAAAA,EAAMC,cAAAA,EAAeC,QAAAA,GAAYC,EAA8B,CACrEC,4BAA6B,GAC7BC,YAAa,oBACbC,UAAW,CACTP,GAAAA,CACF,EACAQ,KAAM,CAACR,CAAAA,CACR,EAEKS,GAASR,GAAAA,EAAAA,GAAAA,YAAAA,EAAMS,eAANT,YAAAA,EAAoBU,SAApBV,YAAAA,EAA4BQ,OAGpC,MAAA,CACLG,QAHcH,EAASI,EAAmBJ,EAAQ,iBAAiB,EAAI,KAIvEK,QAAS,CAACC,EAAcD,QAASC,EAAcZ,OAAO,EAAEa,SACtDd,CAAa,EAEfC,QAAAA,CAAAA,CAEJ,CAEO,SAASc,GAAoC,CAC5C,KAAA,CAAEC,oBAAAA,GAAwBC,EAAU,EAEpC,CAACC,CAAqB,EAAIC,EAAkC,CAChEf,YAAa,cAAA,CACd,EAwBMgB,OAtBqBC,EAAAA,YAC1B,MAAOC,EAA2BC,IAAqB,SACrDP,EAAoB,kCAAkC,EAEhD,KAAA,CAAEjB,KAAAA,CAAK,EAAI,MAAMmB,EAAsB,CAC3Cb,UAAW,CAAEP,GAAIwB,CAAkB,CAAA,CACpC,EACKf,GAASR,GAAAA,EAAAA,GAAAA,YAAAA,EAAMS,eAANT,YAAAA,EAAoBU,SAApBV,YAAAA,EAA4BQ,OAEtCA,GAIL,MAAMiB,EACJb,EAAmBJ,EAAQ,iBAAiB,EAC5C,kBACAgB,CAAQ,CAAA,EAGZ,CAACP,EAAqBE,CAAqB,CAAC,CAIhD,CAOO,SAASO,EAAmC,CACjD3B,GAAAA,EACA4B,gBAAAA,CACkC,EAAG,OAC/B,KAAA,CAAEC,OAAAA,CAAWC,EAAAA,GACjBF,GAAAA,YAAAA,EAAiBG,iBAAkB,IAAI,EAGnC,CAAE9B,KAAAA,EAAMC,cAAAA,GAAkB8B,EAA2C,CACzE1B,YAAa,oBACbC,UAAW,CACTP,GAAAA,EACAiC,WAAWJ,GAAAA,YAAAA,EAAQK,MAAO,EAC5B,EACA1B,KAAM,CAACR,GAAM,CAAC6B,CAAAA,CACf,EAEKpB,GAASR,EAAAA,GAAAA,YAAAA,EAAMkC,kBAANlC,YAAAA,EAAuBQ,OAG/B,MAAA,CACLG,QAHcH,EAASI,EAAmBJ,EAAQ,iBAAiB,EAAI,KAIvEK,QAAS,CAACC,EAAcD,QAASC,EAAcZ,OAAO,EAAEa,SACtDd,CAAa,CAAA,CAGnB"}