{"version":3,"file":"useInvoicePdfDownload-84ddf906.js","sources":["../../src/features/invoices/utils/statuses.ts","../../src/features/invoices/hooks/useInvoicePermissions.ts","../../src/features/invoices/components/InvoiceStatusBadge/InvoiceStatusBadge.tsx","../../src/features/invoices/hooks/useInvoicePdfDownload.ts"],"sourcesContent":["import {\n  AllCurrencyEnum,\n  InvoiceStatusEnum,\n  InvoiceStatusEnumInput,\n} from '@/apollo/generated/types';\nimport { type InvoiceOutputFragment } from '@/apollo/graphql';\n\nfunction canEdit(invoice: InvoiceOutputFragment) {\n  return invoice.status && invoiceStatusesPermissions[invoice.status].canEdit;\n}\nfunction canDelete(invoice: InvoiceOutputFragment) {\n  return invoice.status && invoiceStatusesPermissions[invoice.status].canDelete;\n}\nfunction canSend(invoice: InvoiceOutputFragment) {\n  return invoice.status && invoiceStatusesPermissions[invoice.status].canSend;\n}\nfunction canDownload(invoice: InvoiceOutputFragment) {\n  return (\n    invoice.status && invoiceStatusesPermissions[invoice.status].canDownload\n  );\n}\nfunction canPay(invoice: InvoiceOutputFragment) {\n  return (\n    invoice.status &&\n    invoiceStatusesPermissions[invoice.status].canPay &&\n    invoice.currency === AllCurrencyEnum.Usd &&\n    invoice.type === 'Received'\n  );\n}\nfunction canChangeTo(status?: InvoiceStatusEnum, to?: InvoiceStatusEnumInput) {\n  return (\n    to && status && invoiceStatusesPermissions[status].canChangeTo.includes(to)\n  );\n}\nfunction canChangeStatus(invoice: InvoiceOutputFragment) {\n  return (\n    invoice.status &&\n    invoiceStatusesPermissions[invoice.status].canChangeTo.length > 0\n  );\n}\n\nfunction canSendReminder(invoice: InvoiceOutputFragment) {\n  return (\n    invoice.status && invoiceStatusesPermissions[invoice.status].canSendReminder\n  );\n}\n\nfunction canDuplicate(invoice: InvoiceOutputFragment) {\n  return (\n    invoice.status && invoiceStatusesPermissions[invoice.status].canDuplicate\n  );\n}\n\ntype StatusPermissionsMap = {\n  [key in InvoiceStatusEnum]: {\n    canEdit: boolean;\n    canDelete: boolean;\n    canSend: boolean;\n    canDownload: boolean;\n    canChangeTo: InvoiceStatusEnumInput[];\n    canPay?: boolean;\n    canSendReminder?: boolean;\n    canDuplicate?: boolean;\n  };\n};\n\nconst invoiceStatusesPermissions: StatusPermissionsMap = {\n  [InvoiceStatusEnum.Draft]: {\n    canEdit: true,\n    canDelete: true,\n    canSend: true,\n    canDownload: false,\n    canChangeTo: [InvoiceStatusEnumInput.Cancelled],\n    canSendReminder: false,\n    canDuplicate: true,\n  },\n  [InvoiceStatusEnum.Cancelled]: {\n    canEdit: false,\n    canDelete: false,\n    canSend: false,\n    canDownload: false,\n    canChangeTo: [],\n    canSendReminder: false,\n  },\n  [InvoiceStatusEnum.Issued]: {\n    canEdit: true,\n    canDelete: false,\n    canSend: false,\n    canDownload: true,\n    canPay: true,\n    canSendReminder: false,\n    canDuplicate: true,\n    canChangeTo: [\n      InvoiceStatusEnumInput.Overdue,\n      InvoiceStatusEnumInput.Paid,\n      InvoiceStatusEnumInput.PartiallyPaid,\n      InvoiceStatusEnumInput.Cancelled,\n    ],\n  },\n  [InvoiceStatusEnum.Overdue]: {\n    canEdit: false,\n    canDelete: false,\n    canSend: false,\n    canDownload: true,\n    canPay: true,\n    canSendReminder: true,\n    canDuplicate: true,\n    canChangeTo: [\n      InvoiceStatusEnumInput.Paid,\n      InvoiceStatusEnumInput.PartiallyPaid,\n    ],\n  },\n  [InvoiceStatusEnum.Paid]: {\n    canEdit: false,\n    canDelete: false,\n    canSend: false,\n    canDownload: true,\n    canDuplicate: true,\n    canSendReminder: false,\n    canChangeTo: [InvoiceStatusEnumInput.Overdue],\n  },\n  [InvoiceStatusEnum.PartiallyPaid]: {\n    canEdit: false,\n    canDelete: false,\n    canSend: false,\n    canDownload: true,\n    canPay: true,\n    canDuplicate: true,\n    canSendReminder: true,\n    canChangeTo: [\n      InvoiceStatusEnumInput.Overdue,\n      InvoiceStatusEnumInput.Paid,\n      InvoiceStatusEnumInput.PartiallyPaid,\n    ],\n  },\n  [InvoiceStatusEnum.WriteOff]: {\n    canEdit: false,\n    canDelete: false,\n    canSend: false,\n    canDownload: true,\n    canChangeTo: [],\n    canSendReminder: false,\n  },\n};\n\nconst StatusesMap = {\n  [InvoiceStatusEnumInput.Cancelled]: {\n    title: 'Cancelled',\n    description:\n      'This invoice was accidentally finalized or contains a mistake.',\n  },\n  [InvoiceStatusEnumInput.Overdue]: {\n    title: 'Overdue',\n    description: 'This invoice is not paid and is past due',\n  },\n  [InvoiceStatusEnumInput.Paid]: {\n    title: 'Paid',\n    description: 'Payment was collected in full outside of Noumena.',\n  },\n  [InvoiceStatusEnumInput.PartiallyPaid]: {\n    title: 'Partially Paid',\n    description: 'Part of payment was collected outside of Noumena.',\n  },\n  [InvoiceStatusEnumInput.WriteOff]: {\n    title: 'Open',\n    description: 'The invoice is ready for the customer',\n  },\n};\n\nconst getStatusTitle = (status: InvoiceStatusEnumInput) =>\n  StatusesMap[status].title;\n\nconst getStatusDescription = (status: InvoiceStatusEnumInput) =>\n  StatusesMap[status].description;\n\nconst allStatuses = Object.values(InvoiceStatusEnumInput);\n\nconst mapStatusToStatusInput = (status: InvoiceStatusEnum) =>\n  InvoiceStatusUtils.invoiceStatusToInvoiceStatusInputMap[status];\n\nconst invoiceStatusToInvoiceStatusInputMap = {\n  [InvoiceStatusEnum.Cancelled]: InvoiceStatusEnumInput.Cancelled,\n  [InvoiceStatusEnum.Overdue]: InvoiceStatusEnumInput.Overdue,\n  [InvoiceStatusEnum.Paid]: InvoiceStatusEnumInput.Paid,\n  [InvoiceStatusEnum.PartiallyPaid]: InvoiceStatusEnumInput.PartiallyPaid,\n  [InvoiceStatusEnum.WriteOff]: InvoiceStatusEnumInput.WriteOff,\n  [InvoiceStatusEnum.Draft]: undefined,\n  [InvoiceStatusEnum.Issued]: undefined,\n};\n\nexport const InvoiceStatusUtils = {\n  canEdit,\n  canDelete,\n  canSend,\n  canChangeTo,\n  canChangeStatus,\n  invoiceStatusesPermissions,\n  allStatuses,\n  getStatusDescription,\n  getStatusTitle,\n  invoiceStatusToInvoiceStatusInputMap,\n  mapStatusToStatusInput,\n  canDownload,\n  canPay,\n  canSendReminder,\n  canDuplicate,\n};\n","import { type InvoiceOutputFragment } from '@/apollo/graphql';\nimport { useAuth } from '@/features/auth/contexts';\nimport { InvoiceStatusUtils } from '../utils/statuses';\n\nfunction useInvoicePermissions() {\n  const { user } = useAuth();\n\n  function isNoumOwner(invoice: InvoiceOutputFragment) {\n    return invoice.createdBy?._id === user?._id;\n  }\n\n  const canEdit = (invoice: InvoiceOutputFragment) =>\n    InvoiceStatusUtils.canEdit(invoice) && isNoumOwner(invoice);\n\n  const canDelete = (invoice: InvoiceOutputFragment) =>\n    InvoiceStatusUtils.canDelete(invoice) && isNoumOwner(invoice);\n\n  const canSend = (invoice: InvoiceOutputFragment) =>\n    InvoiceStatusUtils.canSend(invoice) && isNoumOwner(invoice);\n\n  const canPay = (invoice: InvoiceOutputFragment) =>\n    InvoiceStatusUtils.canPay(invoice) && !isNoumOwner(invoice);\n\n  const canChangeStatus = (invoice: InvoiceOutputFragment) =>\n    InvoiceStatusUtils.canChangeStatus(invoice) && isNoumOwner(invoice);\n\n  const canSendReminder = (invoice: InvoiceOutputFragment) =>\n    InvoiceStatusUtils.canSendReminder(invoice) && isNoumOwner(invoice);\n\n  const canDuplicate = (invoice?: InvoiceOutputFragment | null) =>\n    invoice && InvoiceStatusUtils.canDuplicate(invoice) && isNoumOwner(invoice);\n\n  return {\n    ...InvoiceStatusUtils,\n    canEdit,\n    canDelete,\n    canSend,\n    canPay,\n    canChangeStatus,\n    canSendReminder,\n    canDuplicate,\n    isNoumOwner,\n  };\n}\n\nexport default useInvoicePermissions;\n","import React, { useMemo } from 'react';\nimport { InvoiceStatusEnum } from '@/apollo/generated/types';\nimport { Tag } from '@/components/Tag';\n\ntype InvoiceStatusBadgeProps = {\n  status?: InvoiceStatusEnum | null;\n};\n\nconst InvoiceStatusBadge: React.FC<InvoiceStatusBadgeProps> = ({ status }) => {\n  const tagProps = useMemo(() => {\n    switch (status) {\n      case InvoiceStatusEnum.Draft:\n        return {\n          label: 'Draft',\n          tertiary: true,\n        };\n      case InvoiceStatusEnum.Cancelled:\n        return {\n          label: 'Cancelled',\n          tertiary: true,\n        };\n      case InvoiceStatusEnum.Issued:\n        return {\n          label: 'Open',\n          secondary: true,\n        };\n      case InvoiceStatusEnum.Paid:\n        return {\n          label: 'Paid',\n          success: true,\n        };\n      case InvoiceStatusEnum.Overdue:\n        return {\n          label: 'Overdue',\n          danger: true,\n        };\n      case InvoiceStatusEnum.PartiallyPaid:\n        return {\n          label: 'Partially Paid',\n          warning: true,\n        };\n      case InvoiceStatusEnum.WriteOff:\n        return {\n          label: 'Write Off',\n          tertiary: true,\n        };\n      default:\n        return {};\n    }\n  }, [status]);\n\n  const { label, ...rest } = tagProps;\n\n  return label ? <Tag {...rest}>{label}</Tag> : null;\n};\n\nexport default InvoiceStatusBadge;\n","import { useCallback } from 'react';\nimport { useInvoicePdfPreviewByIdLazyQuery } from '@/apollo/graphql';\nimport { downloadFileFromUrl } from '@/utils/file';\nimport { base64ToDataString } from '@/utils/base64ToBlob';\nimport { InvoiceUtils } from '../utils/invoice';\n\nexport default function useInvoicePdfDownload() {\n  const [getInvoiceDownloadUrlQuery, { loading }] =\n    useInvoicePdfPreviewByIdLazyQuery();\n\n  const download = useCallback(\n    async (id: string, invoiceNumber: string) => {\n      const response = await getInvoiceDownloadUrlQuery({\n        variables: {\n          id,\n        },\n        fetchPolicy: 'network-only',\n      });\n      const base64 = response.data?.invoicePDFPreviewByID.base64;\n      const pdfData = base64\n        ? base64ToDataString(base64, 'application/pdf')\n        : null;\n\n      if (pdfData) {\n        downloadFileFromUrl(\n          pdfData,\n          'application/pdf',\n          InvoiceUtils.getInvoiceFileName(invoiceNumber),\n        );\n      }\n    },\n    [getInvoiceDownloadUrlQuery],\n  );\n\n  return {\n    loading,\n    download,\n  };\n}\n"],"names":["canEdit","invoice","status","invoiceStatusesPermissions","canDelete","canSend","canDownload","canPay","currency","AllCurrencyEnum","Usd","type","canChangeTo","to","includes","canChangeStatus","length","canSendReminder","canDuplicate","InvoiceStatusEnum","Draft","InvoiceStatusEnumInput","Cancelled","Issued","Overdue","Paid","PartiallyPaid","WriteOff","StatusesMap","title","description","getStatusTitle","getStatusDescription","allStatuses","Object","values","mapStatusToStatusInput","InvoiceStatusUtils","invoiceStatusToInvoiceStatusInputMap","undefined","useInvoicePermissions","user","useAuth","isNoumOwner","createdBy","_id","InvoiceStatusBadge","tagProps","useMemo","label","tertiary","secondary","success","danger","warning","rest","Tag","useInvoicePdfDownload","getInvoiceDownloadUrlQuery","loading","useInvoicePdfPreviewByIdLazyQuery","download","useCallback","id","invoiceNumber","base64","response","variables","fetchPolicy","data","invoicePDFPreviewByID","pdfData","base64ToDataString","downloadFileFromUrl","InvoiceUtils","getInvoiceFileName"],"mappings":"yLAOA,SAASA,EAAQC,EAAgC,CAC/C,OAAOA,EAAQC,QAAUC,EAA2BF,EAAQC,MAAM,EAAEF,OACtE,CACA,SAASI,EAAUH,EAAgC,CACjD,OAAOA,EAAQC,QAAUC,EAA2BF,EAAQC,MAAM,EAAEE,SACtE,CACA,SAASC,EAAQJ,EAAgC,CAC/C,OAAOA,EAAQC,QAAUC,EAA2BF,EAAQC,MAAM,EAAEG,OACtE,CACA,SAASC,EAAYL,EAAgC,CACnD,OACEA,EAAQC,QAAUC,EAA2BF,EAAQC,MAAM,EAAEI,WAEjE,CACA,SAASC,EAAON,EAAgC,CAC9C,OACEA,EAAQC,QACRC,EAA2BF,EAAQC,MAAM,EAAEK,QAC3CN,EAAQO,WAAaC,EAAgBC,KACrCT,EAAQU,OAAS,UAErB,CACA,SAASC,EAAYV,EAA4BW,EAA6B,CAC5E,OACEA,GAAMX,GAAUC,EAA2BD,CAAM,EAAEU,YAAYE,SAASD,CAAE,CAE9E,CACA,SAASE,EAAgBd,EAAgC,CACvD,OACEA,EAAQC,QACRC,EAA2BF,EAAQC,MAAM,EAAEU,YAAYI,OAAS,CAEpE,CAEA,SAASC,EAAgBhB,EAAgC,CACvD,OACEA,EAAQC,QAAUC,EAA2BF,EAAQC,MAAM,EAAEe,eAEjE,CAEA,SAASC,EAAajB,EAAgC,CACpD,OACEA,EAAQC,QAAUC,EAA2BF,EAAQC,MAAM,EAAEgB,YAEjE,CAeA,MAAMf,EAAmD,CACvD,CAACgB,EAAkBC,KAAK,EAAG,CACzBpB,QAAS,GACTI,UAAW,GACXC,QAAS,GACTC,YAAa,GACbM,YAAa,CAACS,EAAuBC,SAAS,EAC9CL,gBAAiB,GACjBC,aAAc,EAChB,EACA,CAACC,EAAkBG,SAAS,EAAG,CAC7BtB,QAAS,GACTI,UAAW,GACXC,QAAS,GACTC,YAAa,GACbM,YAAa,CAAE,EACfK,gBAAiB,EACnB,EACA,CAACE,EAAkBI,MAAM,EAAG,CAC1BvB,QAAS,GACTI,UAAW,GACXC,QAAS,GACTC,YAAa,GACbC,OAAQ,GACRU,gBAAiB,GACjBC,aAAc,GACdN,YAAa,CACXS,EAAuBG,QACvBH,EAAuBI,KACvBJ,EAAuBK,cACvBL,EAAuBC,SAAS,CAEpC,EACA,CAACH,EAAkBK,OAAO,EAAG,CAC3BxB,QAAS,GACTI,UAAW,GACXC,QAAS,GACTC,YAAa,GACbC,OAAQ,GACRU,gBAAiB,GACjBC,aAAc,GACdN,YAAa,CACXS,EAAuBI,KACvBJ,EAAuBK,aAAa,CAExC,EACA,CAACP,EAAkBM,IAAI,EAAG,CACxBzB,QAAS,GACTI,UAAW,GACXC,QAAS,GACTC,YAAa,GACbY,aAAc,GACdD,gBAAiB,GACjBL,YAAa,CAACS,EAAuBG,OAAO,CAC9C,EACA,CAACL,EAAkBO,aAAa,EAAG,CACjC1B,QAAS,GACTI,UAAW,GACXC,QAAS,GACTC,YAAa,GACbC,OAAQ,GACRW,aAAc,GACdD,gBAAiB,GACjBL,YAAa,CACXS,EAAuBG,QACvBH,EAAuBI,KACvBJ,EAAuBK,aAAa,CAExC,EACA,CAACP,EAAkBQ,QAAQ,EAAG,CAC5B3B,QAAS,GACTI,UAAW,GACXC,QAAS,GACTC,YAAa,GACbM,YAAa,CAAE,EACfK,gBAAiB,EACnB,CACF,EAEMW,EAAc,CAClB,CAACP,EAAuBC,SAAS,EAAG,CAClCO,MAAO,YACPC,YACE,gEACJ,EACA,CAACT,EAAuBG,OAAO,EAAG,CAChCK,MAAO,UACPC,YAAa,0CACf,EACA,CAACT,EAAuBI,IAAI,EAAG,CAC7BI,MAAO,OACPC,YAAa,mDACf,EACA,CAACT,EAAuBK,aAAa,EAAG,CACtCG,MAAO,iBACPC,YAAa,mDACf,EACA,CAACT,EAAuBM,QAAQ,EAAG,CACjCE,MAAO,OACPC,YAAa,uCACf,CACF,EAEMC,EAAkB7B,GACtB0B,EAAY1B,CAAM,EAAE2B,MAEhBG,EAAwB9B,GAC5B0B,EAAY1B,CAAM,EAAE4B,YAEhBG,EAAcC,OAAOC,OAAOd,CAAsB,EAElDe,EAA0BlC,GAC9BmC,EAAmBC,qCAAqCpC,CAAM,EAE1DoC,EAAuC,CAC3C,CAACnB,EAAkBG,SAAS,EAAGD,EAAuBC,UACtD,CAACH,EAAkBK,OAAO,EAAGH,EAAuBG,QACpD,CAACL,EAAkBM,IAAI,EAAGJ,EAAuBI,KACjD,CAACN,EAAkBO,aAAa,EAAGL,EAAuBK,cAC1D,CAACP,EAAkBQ,QAAQ,EAAGN,EAAuBM,SACrD,CAACR,EAAkBC,KAAK,EAAGmB,OAC3B,CAACpB,EAAkBI,MAAM,EAAGgB,MAC9B,EAEaF,EAAqB,CAChCrC,QAAAA,EACAI,UAAAA,EACAC,QAAAA,EACAO,YAAAA,EACAG,gBAAAA,EACAZ,2BAAAA,EACA8B,YAAAA,EACAD,qBAAAA,EACAD,eAAAA,EACAO,qCAAAA,EACAF,uBAAAA,EACA9B,YAAAA,EACAC,OAAAA,EACAU,gBAAAA,EACAC,aAAAA,CACF,EC1MA,SAASsB,GAAwB,CACzB,KAAA,CAAEC,KAAAA,GAASC,EAAS,EAE1B,SAASC,EAAY1C,EAAgC,OAC5CA,QAAAA,EAAAA,EAAQ2C,YAAR3C,YAAAA,EAAmB4C,QAAQJ,GAAAA,YAAAA,EAAMI,IAC1C,CAuBO,MAAA,CACL,GAAGR,EACHrC,QAvBeC,GACfoC,EAAmBrC,QAAQC,CAAO,GAAK0C,EAAY1C,CAAO,EAuB1DG,UArBiBH,GACjBoC,EAAmBjC,UAAUH,CAAO,GAAK0C,EAAY1C,CAAO,EAqB5DI,QAnBeJ,GACfoC,EAAmBhC,QAAQJ,CAAO,GAAK0C,EAAY1C,CAAO,EAmB1DM,OAjBcN,GACdoC,EAAmB9B,OAAON,CAAO,GAAK,CAAC0C,EAAY1C,CAAO,EAiB1Dc,gBAfuBd,GACvBoC,EAAmBtB,gBAAgBd,CAAO,GAAK0C,EAAY1C,CAAO,EAelEgB,gBAbuBhB,GACvBoC,EAAmBpB,gBAAgBhB,CAAO,GAAK0C,EAAY1C,CAAO,EAalEiB,aAXoBjB,GACpBA,GAAWoC,EAAmBnB,aAAajB,CAAO,GAAK0C,EAAY1C,CAAO,EAW1E0C,YAAAA,CAAAA,CAEJ,CCnCA,MAAMG,EAAwDA,CAAC,CAAE5C,OAAAA,CAAO,IAAM,CACtE6C,MAAAA,EAAWC,EAAAA,QAAQ,IAAM,CAC7B,OAAQ9C,EAAM,CACZ,KAAKiB,EAAkBC,MACd,MAAA,CACL6B,MAAO,QACPC,SAAU,EAAA,EAEd,KAAK/B,EAAkBG,UACd,MAAA,CACL2B,MAAO,YACPC,SAAU,EAAA,EAEd,KAAK/B,EAAkBI,OACd,MAAA,CACL0B,MAAO,OACPE,UAAW,EAAA,EAEf,KAAKhC,EAAkBM,KACd,MAAA,CACLwB,MAAO,OACPG,QAAS,EAAA,EAEb,KAAKjC,EAAkBK,QACd,MAAA,CACLyB,MAAO,UACPI,OAAQ,EAAA,EAEZ,KAAKlC,EAAkBO,cACd,MAAA,CACLuB,MAAO,iBACPK,QAAS,EAAA,EAEb,KAAKnC,EAAkBQ,SACd,MAAA,CACLsB,MAAO,YACPC,SAAU,EAAA,EAEd,QACE,MAAO,EAAG,CAAA,EAEb,CAAChD,CAAM,CAAC,EAEL,CAAE+C,MAAAA,EAAO,GAAGM,CAASR,EAAAA,EAEpBE,OAAAA,IAASO,MAAQD,EAAM,YAAA,yBAACN,UAAM,CAAA,EAAS,IAChD,EChDA,SAAwBQ,GAAwB,CAC9C,KAAM,CAACC,EAA4B,CAAEC,QAAAA,CAAAA,CAAS,EAC5CC,EAAmC,EAE/BC,EAAWC,EAAAA,YACf,MAAOC,EAAYC,IAA0B,OAOrCC,MAAAA,GAASC,GANE,MAAMR,EAA2B,CAChDS,UAAW,CACTJ,GAAAA,CACF,EACAK,YAAa,cAAA,CACd,GACuBC,OAATH,YAAAA,EAAeI,sBAAsBL,OAC9CM,EAAUN,EACZO,EAAmBP,EAAQ,iBAAiB,EAC5C,KAEAM,GACFE,EACEF,EACA,kBACAG,EAAaC,mBAAmBX,CAAa,CAAC,CAElD,EAEF,CAACN,CAA0B,CAAC,EAGvB,MAAA,CACLC,QAAAA,EACAE,SAAAA,CAAAA,CAEJ"}