import{kr as H,ks as Q,Y as R,eo as C,x as u,T as P,b8 as _,X as E,c,M as B,t as F,j as t,h as j,i as D,I as N,aQ as $,y as G,a2 as V,k as U,B as w,n as Y,kt as X,jn as J,aC as K,ba as Z}from"./index-cd84bcc9.js";import{r as q,C as h,am as tt,bF as at,ao as et,ap as ot,aq as nt,bb as L,be as rt}from"./vendor-51460554.js";import{R as lt}from"./Radiobox-c1e62033.js";import{g as dt}from"./DeleteDraftModal-e41d0b22.js";import{n as it,g as st}from"./forms-18e3c53a.js";import{I as ct}from"./Infobox-cf6af02b.js";import{b as f}from"./useInvoicePdfDownload-84ddf906.js";import{a as ut,T as mt}from"./index-594821a1.js";function Bt(){const[n]=H(),[a]=Q(),{logError:r}=R();return{changeStatus:q.useCallback(async({invoice:m,status:p,amount:d})=>{var g;if(p===C.PartiallyPaid&&d&&d>0)try{await a({variables:{input:{amount:d,invoiceId:m.id,paidBy:((g=m.invoiceTo)==null?void 0:g.displayName)??"",paymentDate:new Date().toISOString()}}})}catch(i){r(i,"createInvoicePaymentMutation")}else try{await n({variables:{id:m.id,status:p}})}catch(i){r(i,"updateStatusMutation")}},[a,r,n])}}const ht=h(u).attrs({justify:"space-between",align:"center",fullWidth:!0,padding:"20px"})``,pt=h(P).attrs({colorToken:"--text-tablecell-header-neutral-highlighted",font:"body-l-bold"})``,gt=h(P).attrs({colorToken:"--text-tablecell-body-neutral-default",font:"body-m"})``,yt=h(u)`
  width: 100%;
`,St=h(u).attrs({fullWidth:!0,vertical:!0})`
  width: 100%;
  padding: 0px 16px 16px 16px;
`,Mt=h(P).attrs({colorToken:"--text-modal-neutral-highlighted",font:"body-m"})`
  padding: 0px 0 16px;
`,It=h(P).attrs({colorToken:"--text-modal-neutral-highlighted",font:"body-m-bold"})``,bt=h(u)`
  padding-top: 16px;
`,s={StatusItem:ht,StatusTitle:pt,StatusDescription:gt,TextInputWrapper:yt,PartialAmountWrapper:St,OutstandingAmount:Mt,OutstandingAmountBolded:It,InfoboxWrapper:bt};function ft(n){return tt({selectedStatus:at().oneOf(Object.values(C)).required(),partialAmount:et().label("Partial amount").when("selectedStatus",{is:C.PartiallyPaid,then:a=>a.min(1).max(n).required(),otherwise:a=>a.min(0).notRequired()})})}const Ft=({isOpenModal:n,onConfirm:a,onCancel:r,currentStatus:l,currency:m,invoiceId:p})=>{var I;const{data:d,refetch:g}=_({variables:{invoiceId:p},fetchPolicy:"cache-and-network"}),i=((I=d==null?void 0:d.getInvoiceAmount)==null?void 0:I.remainingAmount)??0,{control:v,handleSubmit:W,formState:e,watch:A}=ot({mode:"onChange",defaultValues:{partialAmount:0,selectedStatus:l?f.mapStatusToStatusInput(l):void 0},resolver:nt(ft(i))}),[M,x]=A(["selectedStatus","partialAmount"]),{isMobile:k}=E(),T=()=>{W(o=>{g(),a(o.selectedStatus,o.partialAmount)})()};return c(B,{isFullScreen:k,open:n,testId:"add_new_customer_modal",size:F.L,"data-test":"ChangeInvoiceStatusModal-Modal",children:[t(j,{"data-test":"ChangeInvoiceStatusModal-ModalHeader",children:"Change Invoice Status"}),t(D,{gap:16,maxHeight:600,"data-test":"ChangeInvoiceStatusModal-ModalBody",children:t(u,{vertical:!0,fullWidth:!0,"data-test":"ChangeInvoiceStatusModal-Stack",children:f.allStatuses.map(o=>f.canChangeTo(l,o)?c(q.Fragment,{children:[c(s.StatusItem,{fullWidth:!0,justify:"space-between",children:[c(u,{vertical:!0,"data-test":"ChangeInvoiceStatusModal-Stack",children:[t(s.StatusTitle,{children:f.getStatusTitle(o)}),t(s.StatusDescription,{children:f.getStatusDescription(o)})]}),t(L,{control:v,name:"selectedStatus",render:({field:{onChange:y,value:S}})=>t(lt,{isChecked:S===o,icon:t(N,{name:"radio_btn_m",size:12,color:M===o?"--icon-radiobutton-brand-primary-default":"--icon-radiobutton-inactive-default","data-test":"ChangeInvoiceStatusModal-Icon"}),onChange:()=>{y(o)},"data-test":"ChangeInvoiceStatusModal-Radiobox"}),"data-test":"ChangeInvoiceStatusModal-Controller"})]}),M===C.PartiallyPaid&&o===C.PartiallyPaid&&c(s.PartialAmountWrapper,{children:[c(s.OutstandingAmount,{children:["Outstanding Amount:"," ",t(s.OutstandingAmountBolded,{children:$(i)})]}),t(s.TextInputWrapper,{children:t(L,{control:v,name:"partialAmount",render:({field:y,fieldState:S})=>t(G,{label:"Partial Amount",contentEditable:!1,isCurrency:!0,numberOnly:!0,prefix:dt(m),...it.fieldProps(y),...st(S),"data-test":"ChangeInvoiceStatusModal-TextField"}),"data-test":"ChangeInvoiceStatusModal-Controller"})}),(x??0)>=i&&t(s.InfoboxWrapper,{children:c(ct,{type:"secondary","data-test":"ChangeInvoiceStatusModal-Infobox",children:["Paid Amount is equal to Outstanding Amount, so the Invoice Status will be automatically changed to"," ",t(s.OutstandingAmountBolded,{children:"Paid"})]})})]}),t(V,{fullWidth:!0,noMargin:!0,"data-test":"ChangeInvoiceStatusModal-Separator"})]},o):null)})}),t(U,{"data-test":"ChangeInvoiceStatusModal-ModalFooter",children:c(u,{gap:16,fullWidth:!0,"data-test":"ChangeInvoiceStatusModal-Stack",children:[t(w,{size:"full",tertiary:!0,onClick:r,"data-test":"ChangeInvoiceStatusModal-Button",children:"Cancel"}),t(w,{size:"full",primary:!0,disabled:!e.isValid,onClick:T,"data-test":"ChangeInvoiceStatusModal-Button",children:"Update Status"})]})})]})},Ct=({isOpenModal:n})=>{const{isMobile:a}=E();return t(B,{isFullScreen:a,open:n,size:F.S,isScrollableContent:!0,disableBackdropClick:!0,"data-test":"PaymentLoadingModal-Modal",children:t(D,{"data-test":"PaymentLoadingModal-ModalBody",children:t(u,{fixedHeight:150,"data-test":"PaymentLoadingModal-Stack",children:t(Y,{"data-test":"PaymentLoadingModal-Spinner"})})})})},Pt=({isOpenModal:n,onClose:a,serviceProviderName:r})=>{const{isMobile:l}=E();return c(B,{isFullScreen:l,open:n,size:F.S,onClose:a,disableBackdropClick:!0,"data-test":"PaymentErrorModal-Modal",children:[t(j,{justifyContent:"center",maxTitleWidth:250,isFullScreen:l,"data-test":"PaymentErrorModal-ModalHeader",children:"Payment to wallet unavailable"}),t(D,{isFullScreen:l,"data-test":"PaymentErrorModal-ModalBody",children:t(P,{textAlign:"center",font:"body-l",colorToken:"--text-modal-neutral-default","data-test":"PaymentErrorModal-TSpan",children:`We are unable to process your payment to ${r} because
          they do not have a wallet set up. We've let them know you had this
          issue and we recommend you get in touch with them too.`})}),t(U,{isFullScreen:l,"data-test":"PaymentErrorModal-ModalFooter",children:t(u,{fullWidth:!0,"data-test":"PaymentErrorModal-Stack",children:t(w,{grow:!0,onClick:a,tertiary:!0,"data-test":"PaymentErrorModal-Button",children:"Cancel"})})})]})},Dt=({onClose:n,invoice:a,onPaymentSuccess:r})=>{var M,x,k,T,I,o,y,S,O,z;const l=rt(),m=(x=(M=a==null?void 0:a.invoiceTo)==null?void 0:M.userId)==null?void 0:x._id,p=(T=(k=a==null?void 0:a.invoiceFrom)==null?void 0:k.userId)==null?void 0:T._id,{data:d,loading:g}=X({variables:{sourceUserId:m,targetUserId:p,noumId:(I=a.noumId)==null?void 0:I._id,invoiceId:a.id},skip:!m||!p||!((o=a.noumId)!=null&&o._id)}),{data:i,loading:v}=_({variables:{invoiceId:a.id},fetchPolicy:"cache-and-network"}),W=()=>{setTimeout(()=>{l.refetchQueries({include:[Z],onQueryUpdated:b=>{b.refetch({id:a.id})}})},1500),r==null||r()},e=d==null?void 0:d.checkWalletExistDetail,A=(y=e==null?void 0:e.targetWalletDetail)==null?void 0:y.find(b=>(b==null?void 0:b.accountType)===J.SubWallet);return g||v?t(Ct,{isOpenModal:!0,"data-test":"MakeInvoicePaymentWizard-PaymentLoadingModal"}):e!=null&&e.targetWallet?t(ut,{open:!0,type:mt.PAY,handleClose:n,invoiceId:a.id,defaultWalletPayee:A??((S=e==null?void 0:e.targetWalletDetail)==null?void 0:S[0])??void 0,predefinedPayeeList:K(e.targetWalletDetail),isSourceWalletExists:e.sourceWallet,isDestinationDropdownDisabled:(e.targetWalletDetail??[]).length<=1,maxTransactionAmount:((O=i==null?void 0:i.getInvoiceAmount)==null?void 0:O.remainingAmount)??void 0,onSuccessfulTransaction:W,"data-test":"MakeInvoicePaymentWizard-TransactionModal"}):t(Pt,{serviceProviderName:((z=a==null?void 0:a.invoiceFrom)==null?void 0:z.displayName)??"",isOpenModal:!0,onClose:n,"data-test":"MakeInvoicePaymentWizard-PaymentErrorModal"})};export{Ft as C,Dt as M,Bt as u};
//# sourceMappingURL=MakeInvoicePaymentWizard-83291728.js.map
