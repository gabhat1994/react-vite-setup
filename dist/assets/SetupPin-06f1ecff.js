import{I as k,j as e,T as q,c as A,am as Q,y as g,S as v,x as z,aa as M,B as O,ab as N,v as F,k4 as R,jK as V,n as j,jI as $}from"./index-cd84bcc9.js";import{r as a,C as G,B as d,bE as W,ad as L,ap as U,bz as K,f as X}from"./vendor-51460554.js";import{O as Y}from"./OtpInput-6d75f9c8.js";const E=a.createContext({securityQuestions:{questionOne:{id:"",question:""},questionSecond:{id:"",question:""},questionThird:{id:"",question:""}},questionsArray:void 0,setSecurityQuestions:void 0,handlePreviousStep:()=>null,handleSubmit:()=>null}),H=G(k)`
  transition: transform 0.3s;
  ${({isOpen:n})=>n&&"transform: rotate(180deg)"}
`,J=G.div`
  height: 600px;
`,Z=n=>e(q,{...n,"data-test":"Header-TSpan",children:d("noumena.money.setupWallet.security_question.text")}),ee=()=>e(q,{textAlign:"center",font:"body-l",colorToken:"--text-body-neutral-default","data-test":"HelperText-TSpan",children:d("noumena.money.setupWallet.security_question.sub_text")}),te=()=>{var S,w,b;const[n,i]=a.useState(!1),{securityQuestions:o,questionsArray:l,setSecurityQuestions:c}=a.useContext(E),{register:m,getValues:s,formState:{errors:p}}=W(),u=t=>(t==null?void 0:t.map(r=>({key:L(),label:e(z,{"data-test":"Questions-generateDropDownItems-Stack",children:e(q,{font:"input-s",colorToken:"--text-tablecell-header-neutral-highlighted","data-testid":"country-options","data-test":"Questions-generateDropDownItems-TSpan",children:e("div",{style:{padding:"0 4px"},children:r.question})})}),type:"value",value:r})))||[],T=a.useMemo(()=>u(l),[l]),h=a.useCallback((t,r)=>{if(!t.id&&!r.id)return T;const y=l==null?void 0:l.filter(I=>I.id!==t.id&&I.id!==r.id);return u(y)},[l,T]);return A("form",{style:{width:"100%"},"data-test":"Questions",children:[e(Q,{hideIcons:!0,usePortal:!1,usePopStyle:!0,isAnimation:!1,containerWidth:"443px",options:h(o.questionSecond,o.questionThird),placement:"bottom-start",onSelectOption:t=>{c&&c(r=>({...r,questionOne:t.value}))},onClose:()=>i(!1),onOpen:()=>i(!0),"data-test":"Questions-Dropdown",children:({inputProps:t,inputRef:r,toggle:y})=>e(g,{readOnly:!0,style:{cursor:"pointer"},"data-testid":"step-five-security-question-input-one-read-only",label:d("noumena.money.setupWallet.security_question.text_field.label"),...t,ref:r,value:o.questionOne.question,rightIcon:e(H,{name:"chevron_down_m",isOpen:n,size:16,onClick:y,color:"--icon-input-neutral-default","data-testid":"styledAddressDownArrow-one","data-test":"Questions-AddressRightIcon"}),"data-test":"Questions-TextField"})}),e(v,{height:8,"data-test":"Questions-Spacer"}),e(g,{disabled:!o.questionOne.id,...m("answerOne",{required:{value:!0,message:d("noumena.input.not_empty")}}),style:{cursor:"pointer"},"data-testid":"step-five-answer-question-one",label:d("noumena.money.setupWallet.security_question.answer_text_field.label"),value:s("answerOne"),error:!!p.answerOne,helperText:(S=p==null?void 0:p.answerOne)==null?void 0:S.message,"data-test":"Questions-TextField"}),e(v,{height:16,"data-test":"Questions-Spacer"}),e(Q,{hideIcons:!0,containerWidth:"443px",usePortal:!1,usePopStyle:!0,isAnimation:!1,options:h(o.questionOne,o.questionThird),placement:"bottom-start",onSelectOption:t=>{c&&c(r=>({...r,questionSecond:t.value}))},onClose:()=>i(!1),onOpen:()=>i(!0),"data-test":"Questions-Dropdown",children:({inputProps:t,inputRef:r,toggle:y})=>e(g,{readOnly:!0,style:{cursor:"pointer"},"data-testid":"step-five-security-question-input-two-read-only",label:d("noumena.money.setupWallet.security_question.text_field.label1"),...t,ref:r,value:o.questionSecond.question,rightIcon:e(H,{name:"chevron_down_m",isOpen:n,size:16,onClick:y,color:"--icon-input-neutral-default","data-testid":"styledAddressDownArrow-two","data-test":"Questions-AddressRightIcon"}),"data-test":"Questions-TextField"})}),e(v,{height:8,"data-test":"Questions-Spacer"}),e(g,{disabled:!o.questionSecond.id,...m("answerSecond",{required:{value:!0,message:d("noumena.input.not_empty")}}),style:{cursor:"pointer"},"data-testid":"step-five-answer-question-two",label:d("noumena.money.setupWallet.security_question.answer_text_field.label"),value:s("answerSecond"),error:!!p.answerSecond,helperText:(w=p.answerSecond)==null?void 0:w.message,"data-test":"Questions-TextField"}),e(v,{height:16,"data-test":"Questions-Spacer"}),e(Q,{hideIcons:!0,usePortal:!1,usePopStyle:!0,isAnimation:!1,containerWidth:"443px",options:h(o.questionOne,o.questionSecond),placement:"bottom-start",dropdownItemStyle:{fontWeight:"400",fontSize:"14px",color:"black"},onSelectOption:t=>{c&&c(r=>({...r,questionThird:t.value}))},onClose:()=>i(!1),onOpen:()=>i(!0),"data-test":"Questions-Dropdown",children:({inputProps:t,inputRef:r,toggle:y})=>e(g,{readOnly:!0,style:{cursor:"pointer"},"data-testid":"step-five-security-question-input-three-read-only",label:d("noumena.money.setupWallet.security_question.text_field.label2"),...t,ref:r,value:o.questionThird.question,rightIcon:e(H,{name:"chevron_down_m",isOpen:n,size:16,onClick:y,color:"--icon-input-neutral-default","data-testid":"styledAddressDownArrow-three","data-test":"Questions-AddressRightIcon"}),"data-test":"Questions-TextField"})}),e(v,{height:8,"data-test":"Questions-Spacer"}),e(g,{disabled:!o.questionThird.id,...m("answerThree",{required:{value:!0,message:d("noumena.input.not_empty")}}),style:{cursor:"pointer"},"data-testid":"step-five-answer-question-three",label:d("noumena.money.setupWallet.security_question.answer_text_field.label"),value:s("answerThree"),error:!!p.answerThree,helperText:(b=p.answerThree)==null?void 0:b.message,"data-test":"Questions-TextField"})]})},ne=()=>{const n=M(),{handlePreviousStep:i}=a.useContext(E);return e(O,{"data-testid":"step-five-back-button",type:"button",style:n===N.MOBILE?{width:"100%"}:void 0,size:n!==N.MOBILE?"large":void 0,onClick:i,leftIcon:e(k,{name:"arrow_left_m",size:24,color:"--icon-button-neutral-default","data-test":"BackButton-Icon"}),"data-test":"BackButton-Button",children:d("noumena.back.text")})},se=()=>{const n=M(),{handleSubmit:i}=a.useContext(E),{formState:{isDirty:o,isValid:l}}=W();return e(O,{"data-testid":"step-five-submit-button",type:"submit",primary:!0,size:n!==N.MOBILE?"full":void 0,style:n===N.MOBILE?{width:"100%"}:void 0,disabled:!o||!l,onClick:i,"data-test":"ContinueButton-Button",children:d("noumena.continue")})},B=({children:n,handlePreviousStep:i,passCode:o,handleNextStep:l,loading:c=!1})=>{const{addToast:m}=F(),[s,p]=a.useState(),[u,T]=a.useState({questionOne:{id:"",question:""},questionSecond:{id:"",question:""},questionThird:{id:"",question:""}}),h=U({mode:"onChange",defaultValues:{answerOne:"",answerSecond:"",answerThree:""}});R({onCompleted:({getQuestionnaire:t})=>{p(t)},onError:t=>{m("error","none",t.message),X(t,{tags:{section:"getSecurity-questions"}})}});const[S]=V({onCompleted:()=>l(),onError:t=>{t.message==="PassCode already generated"?(m("error","none"," Pin Code already generated"),l()):m("error","none",` ${t==null?void 0:t.message}`)}}),w=a.useCallback(()=>{const{formState:{errors:t}}=h;if(Object.keys(t).length===0&&t.constructor===Object){const{answerOne:r,answerSecond:y,answerThree:I}=h.getValues(),_=[{id:u.questionOne.id,answer:r},{id:u.questionSecond.id,answer:y},{id:u.questionThird.id,answer:I}];o&&S({variables:{input:{passCode:o,securityQuestions:_}}})}},[h,u.questionOne.id,u.questionSecond.id,u.questionThird.id,o,S]),b=a.useMemo(()=>({securityQuestions:u,questionsArray:s,setSecurityQuestions:T,handlePreviousStep:i,handleSubmit:w}),[u,s,T,w,i]);return e(E.Provider,{value:b,children:c?e(J,{"data-test":"SecurityQuestions-FallbackModal",children:e(j,{"data-test":"SecurityQuestions-Spinner"})}):e(K,{...h,"data-test":"SecurityQuestions-FormProvider",children:n})})};B.Header=Z;B.HelperText=ee;B.Questions=te;B.BackButton=ne;B.ContinueButton=se;var f=(n=>(n.SETTING_THE_PIN="SETTING_THE_PIN",n.CONFIRMING_THE_PIN="CONFIRMING_THE_PIN",n))(f||{});const C=a.createContext({pinState:{entered:"",confirmed:""},componentState:"SETTING_THE_PIN",shouldDisable:!0,showPassword:!1,setShowPassword:null,handlePinChange:()=>null,handleBack:()=>null,handleNext:()=>null}),oe=()=>{const{componentState:n,handlePinChange:i,pinState:o,showPassword:l}=a.useContext(C),c=m=>{i(m)};return e(Y,{width:"44px",value:n===f.SETTING_THE_PIN?o==null?void 0:o.entered:o==null?void 0:o.confirmed,onChange:c,numInputs:6,isInputPassword:!l,dataTestId:"pin-code",color:"var(--text-input-brand-primary-default)","data-test":"Otp-OtpInput"})},ae=n=>{const{componentState:i}=a.useContext(C);return e(q,{...n,"data-test":"Header-TSpan",children:i===f.SETTING_THE_PIN?"Set Up a PIN Code":"Confirm Your PIN Code"})},ie=()=>{const{handleBack:n}=a.useContext(C);return e(O,{"data-testid":"step-four-back-button",type:"button",size:"full",onClick:n,leftIcon:e(k,{name:"arrow_left_m",size:24,color:"--icon-button-neutral-default","data-test":"BackButton-Icon"}),"data-test":"BackButton-Button",children:d("noumena.back.text")})},re=()=>{const{handleNext:n,shouldDisable:i}=a.useContext(C);return e(O,{"data-testid":"step-four-submit-button",type:"submit",primary:!0,size:"full",disabled:i,onClick:n,"data-test":"ContinueButton-Button",children:d("noumena.continue")})},ue=()=>{const{showPassword:n,setShowPassword:i}=a.useContext(C);return e(O,{textOnly:!0,onClick:()=>{i&&i(!n)},leftIcon:e(k,{name:n?"money_eye_off":"money_eye_up",size:24,color:"--icon-button-brand-primary-default","data-test":"ShowPasswordButton-Icon"}),"data-test":"ShowPasswordButton-Button",children:A(q,{font:"button-m",colorToken:"--text-button-brand-primary-default","data-test":"ShowPasswordButton-TSpan",children:[n?"Hide":"Show"," PIN Code"]})})},de=()=>e(q,{textAlign:"center",font:"body-l",colorToken:"--text-body-neutral-default","data-test":"HelperText-TSpan",children:d("noumena.money.setupWallet.pinCode.sub_text")}),D=6,P=({children:n,onPassCodeConfirm:i,onContinueButtonClick:o,handleBack:l})=>{var I;const{addToast:c}=F(),m=a.useMemo(()=>$,[]),[s,p]=a.useState({entered:"",confirmed:""}),[u,T]=a.useState(f.SETTING_THE_PIN),[h,S]=a.useState(!1);a.useEffect(()=>{var _,x;((_=s==null?void 0:s.entered)==null?void 0:_.length)===D&&((x=s==null?void 0:s.confirmed)==null?void 0:x.length)===D&&(s.entered===s.confirmed?i(s.confirmed):c("error","none","PIN codes don’t match. Please try again."))},[s,c,i]);const w=a.useCallback(()=>{u===f.CONFIRMING_THE_PIN?(p({entered:"",confirmed:""}),T(f.SETTING_THE_PIN)):l()},[u,l]),b=a.useCallback(()=>{u===f.SETTING_THE_PIN?s!=null&&s.entered&&m.test(s.entered)?T(f.CONFIRMING_THE_PIN):c("error","none",`${d("Invalid pincode, only numbers are allowed")}`):o()},[T,u,c,m,o,s==null?void 0:s.entered]),t=a.useCallback(_=>{u===f.SETTING_THE_PIN?p(x=>({...x,entered:_})):p(x=>({...x,confirmed:_}))},[p,u]),r=u===f.SETTING_THE_PIN?((I=s==null?void 0:s.entered)==null?void 0:I.length)!==D:s.entered!==s.confirmed,y=a.useMemo(()=>({pinState:s,componentState:u,handleBack:w,handleNext:b,shouldDisable:r,handlePinChange:t,showPassword:h,setShowPassword:S}),[s,u,w,b,r,t,h,S]);return e("div",{style:{width:"100%"},"data-test":"SetupPin",children:e(C.Provider,{value:y,children:n})})};P.Otp=oe;P.ShowPasswordButton=ue;P.Header=ae;P.HelperText=de;P.BackButton=ie;P.ContinueButton=re;export{P as S,B as a};
//# sourceMappingURL=SetupPin-06f1ecff.js.map
