import{c as g,j as n,F as M,au as D,Y as $,v as q,kp as Q,U as Y,kq as G,f as J,aC as E,I as z,aR as K,B as X}from"./index-cd84bcc9.js";import{ar as W,r as T,l as R}from"./vendor-51460554.js";import"./ApiEntityPickerField-cfd6d0d6.js";import{A as U,b as tt}from"./PdfPreviewThumbnail-3547d9fe.js";import{C as et,g as nt}from"./contactDetails-4902172b.js";import{S as a,u as it,a as ot,C as B}from"./useUpdateNoumContact-9e0e7edc.js";function L({title:t,children:e,hasErrors:i}){return g(a.Section,{children:[g(a.Header,{children:[i&&n(a.ErrorIcon,{}),n(a.Title,{children:t})]}),n(a.Content,{children:e})]})}function st({contact:t,errors:e}){var l;const{t:i}=W(),y=et.formatCompanyAndTitle(t);return n(a.Container,{children:g(a.SectionsContainer,{children:[g(L,{title:i("noumena.noum_contacts.contact_details.account_information.title"),hasErrors:!!e.accountInformation,"data-test":"Section",children:[t.displayName?n(a.TextHighlighted,{children:`${i("noumena.noum_contacts.contact_form.fields.contact_name")}: ${t.displayName}`}):null,e.title?n(a.MissingInfo,{children:e.title}):y?n(a.TextHighlighted,{children:y}):n(a.MissingInfo,{children:i("noumena.noum_contacts.contact_form.missing_title")})]}),n(L,{title:i("noumena.noum_contacts.contact_details.billing_details.title"),hasErrors:!!e.billingDetails,"data-test":"Section",children:e.billingDetails?n(a.MissingInfo,{children:e.billingDetails}):g(M,{children:[n(a.Text,{children:e.streetApartment?n(a.MissingInfo,{children:e.streetApartment}):g(M,{children:[t.apartmentNo," ",t.street]})}),n(a.Text,{children:e.city?n(a.MissingInfo,{children:e.city}):t.city}),n(a.Text,{children:e.stateZipCode?n(a.MissingInfo,{children:e.stateZipCode}):g(M,{children:[t.state,", ",t.zipCode]})}),n(a.Text,{children:e.country?n(a.MissingInfo,{children:e.country}):((l=nt(t.country))==null?void 0:l.name)??"--"})]})})]})})}const P="CONTACT_SELECTOR_ADD";function I(t){var e;return{key:t._id,type:"value",value:t,label:t.isCurrentUser?`${t.displayName} (You)`:t.displayName,description:t.user.email??void 0,icon:n(D,{url:(e=t.user.profile)==null?void 0:e.profilePictureThumbnail,size:"M","data-test":"Avatar"})}}function at(t){return t.__typename==="NoumContactOutput"}function x(t){return at(t)?{name:t.displayName??"",email:t.userId.email??void 0,country:t.country??void 0,city:t.city??void 0,state:t.state??void 0,street:t.street??void 0,apartmentNo:t.apartmentNo??void 0,zipCode:t.zipCode??void 0,title:t.title??void 0,isConnectedWithNoum:t.isConnectedWithNoum??!1,userStatus:t.userId.userStatus??void 0}:{name:t.displayName??"",email:t.user.email??void 0,country:t.country??void 0,city:t.city??void 0,state:t.state??void 0,street:t.street??void 0,apartmentNo:t.apartmentNo??void 0,zipCode:t.zipCode??void 0,title:t.title??void 0,isConnectedWithNoum:t.isConnectedWithNoum??!1,userStatus:t.user.userStatus??void 0}}function rt({noumId:t,onChange:e,onCreateNew:i,onAddSuccess:y,onEditSuccess:l}){const{logError:d}=$(),[_]=it(),[v]=ot();return{handleChange:o=>{if(!o){e("",null);return}if(o.key===P){i();return}typeof o.value!="string"&&e(o.key,x(o.value))},handleAddFormSubmit:async o=>{var C;if(t)try{const s=(C=(await _(o)).data)==null?void 0:C.addNewNoumContact;if(!s)return;const r=x(s);e(s._id,r),y(r)}catch(u){d(u,"add_new_contact",!0)}},handleEditFormSubmit:async(o,C)=>{var u;if(o)try{const r=(u=(await v(o,C)).data)==null?void 0:u.updateNoumContact;if(!r)return;const m=x(r);e(r._id,m),l(m)}catch(s){throw d(s,"edit_contact",!0),s}}}}function ct({noumId:t,onChange:e,onCreateNew:i,onAddSuccess:y,onEditSuccess:l}){const{t:d}=W(),{addSuccessIconToast:_}=q(),[v,p]=T.useState(""),{data:c,loading:f,refetch:o,fetchMore:C,variables:u}=Q({variables:{offset:0,limit:20,status:Y.Active,query:v||null},skip:!t,fetchPolicy:"cache-and-network"}),s=(c==null?void 0:c.allNoumsContacts.data.length)??0,r=(c==null?void 0:c.allNoumsContacts.count)??0,m=T.useMemo(()=>R.debounce(h=>{p(h)},500),[]),F=()=>{s>=r||C({variables:{...u,offset:s},updateQuery(h,{fetchMoreResult:b}){return{...h,allNoumsContacts:{...h.allNoumsContacts,count:b.allNoumsContacts.count,data:G(h.allNoumsContacts.data,b.allNoumsContacts.data,s)}}}})},A=()=>{setTimeout(()=>o(),5e3)},{handleChange:k,handleAddFormSubmit:O,handleEditFormSubmit:w}=rt({noumId:t,onChange:(h,b)=>{e(h,b)},onCreateNew:i,onAddSuccess:h=>{A(),_(d("noumena.noum_contacts.contact_selector.toast.contact_added")),y(h)},onEditSuccess:h=>{A(),_(d("noumena.noum_contacts.contact_selector.toast.contact_updated")),l(h)}});return{data:c==null?void 0:c.allNoumsContacts.data,loading:f,searchTerm:v,debouncedSearch:m,handleFetchMore:F,handleChange:k,handleAddFormSubmit:O,handleEditFormSubmit:w,setSearchTerm:p}}function dt({data:t,excludedIds:e,excludeCurrentUser:i,addContactDisabled:y}){const{t:l}=W(),{user:d}=J(),_=T.useMemo(()=>{const c=E(t).map(o=>({...o,isRecent:!1})),f=E(e);return c.filter(o=>!f.includes(o._id))},[t,e]),v=T.useMemo(()=>E([y?void 0:{type:"value",value:P,key:P,label:l("noumena.noum_contacts.contact_selector.add_new"),icon:n(z,{name:"add_m",size:24,"data-test":"headerOptions-Icon"})}]),[y,l]),p=T.useMemo(()=>{if(_.length===0)return[];const c=_.map(m=>({...m,isCurrentUser:m.user._id===(d==null?void 0:d._id)})).filter(m=>!i||!m.isCurrentUser),f=c.find(m=>m.isCurrentUser),o=c.filter(m=>m._id!==(f==null?void 0:f._id)),C=R.groupBy(o,"isRecent"),u=C.true,s=C.false,r=[];return f&&(r.push({key:"noum_owner",type:"header",label:l("noumena.noum_contacts.contact_selector.noum_owner")}),r.push(I(f))),u&&u.length>0&&(r.push({key:"recent",type:"header",label:l("noumena.noum_contacts.contact_selector.recent_contacts")}),r.push(...u.map(I))),s&&s.length>0&&(r.push({key:"saved",type:"header",label:l("noumena.noum_contacts.contact_selector.saved_contacts")}),r.push(...s.map(I))),r},[_,d==null?void 0:d._id,i,l]);return{contacts:_,options:p,headerOptions:v}}function lt({contact:t}){if(!t)return{isValid:!0,errors:{}};const e={};return t.title||(e.title="Title not provided"),t.street||(e.streetApartment="Street not provided"),t.city||(e.city="City not provided"),(!t.state||!t.zipCode)&&(e.stateZipCode="State or Zip Code not provided"),t.country||(e.country="Country not provided"),e.city&&e.streetApartment&&e.stateZipCode&&e.country&&(e.billingDetails="Not provided"),e.title&&(e.accountInformation="Incomplete"),{isValid:Object.keys(e).length===0,errors:e}}function ut({selectedContact:t,onContactInfoValidation:e}){const i=lt({contact:t});return T.useEffect(()=>{e==null||e(i.isValid)},[i.isValid]),i}function _t({noumId:t,disabled:e,value:i,excludedIds:y,excludeCurrentUser:l,preselectedContact:d,onChange:_,onContactInfoValidation:v,onContactDetailsUpdate:p,clearButtonDisabled:c,addContactDisabled:f,...o}){const{modalType:C,openModal:u,closeModal:s}=K(),{data:r,loading:m,searchTerm:F,debouncedSearch:A,handleChange:k,handleAddFormSubmit:O,handleEditFormSubmit:w,handleFetchMore:h,setSearchTerm:b}=ct({noumId:t,onChange:_,onCreateNew:()=>u("create"),onAddSuccess:N=>{p==null||p(N),s()},onEditSuccess:N=>{p==null||p(N),s()}}),{contacts:Z,options:j,headerOptions:V}=dt({data:r,excludedIds:y,excludeCurrentUser:l,addContactDisabled:f}),S=E([...Z,d]).find(N=>N._id===i),H=ut({selectedContact:S,onContactInfoValidation:v});return g(M,{children:[n(U,{...o,options:j,maxContainerHeight:"350px",stickyHeaderOptions:V,renderStickyHeader:()=>{},hideIcons:!1,isLoading:m,disabled:e||!t,calRefTop:!1,inputValue:F,onInputChange:A,onFetchMore:h,renderSelectionPreviewComponent:N=>n(tt,{...N,inputSize:"normal",clearButtonDisabled:c,onClear:()=>b(""),selectedRightSideOption:e?null:H.isValid?n(z,{name:"edit_m",size:24,onClick:()=>u("edit"),color:"--icon-input-neutral-default","data-test":"Icon"}):n(X,{primary:!0,size:"small",onClick:()=>u("edit"),"data-test":"Button",children:"Add Missing Details"}),"data-test":"ApiEntitySelectionPreviewComponent"}),preselectedOption:i&&d?I(d):void 0,value:(S==null?void 0:S._id)??"",leftIcon:n(z,{name:"search_m",color:"--icon-input-neutral-default",size:20,"data-test":"Icon"}),onChange:k,"data-test":"ApiEntityPickerFieldWithRemoteSearch"}),S&&n(st,{contact:S,errors:H.errors,"data-test":"ContactDetails"}),C==="create"&&n(B,{isOpenModal:!0,onClose:s,onConfirm:O,"data-test":"ContactFormModal"}),C==="edit"&&n(B,{isOpenModal:!0,contact:S,onClose:s,onConfirm:N=>w(S==null?void 0:S._id,N),"data-test":"ContactFormModal"})]})}function St(t){if(t)return{...t,__typename:"SearchableNoumContact",user:t.userId,fullName:t.displayName,email:t.userId.email}}export{_t as C,x as a,St as m};
//# sourceMappingURL=contactMapper-463fcf05.js.map
