import{kn as Q,qD as X,qE as Y,v as J,Y as Z,U as b,j as t,aC as D,ae as $,T as S,x as p,F as _,c as m,au as F,X as R,y as tt,I as E,B as et,d as at,aR as nt,kp as ot}from"./index-cd84bcc9.js";import{ar as L,r as f,C as x,l as rt}from"./vendor-51460554.js";import{D as A}from"./index-022aaf3d.js";import{L as ct}from"./index-c8a663c0.js";import{u as it,a as st,C as M}from"./useUpdateNoumContact-9e0e7edc.js";import"./ApiEntityPickerField-cfd6d0d6.js";import"./styles-46bbc451.js";import"./SelectField-54706174.js";import{C as P}from"./contactDetails-4902172b.js";import{A as U}from"./payloadParser-f4cc4e4f.js";import{f as H}from"./getTimeStampForDisplaying-22d5ca9d.js";import"./styles-26e8a352.js";import"./Pagination-43542d57.js";import"./TickCheckbox-c4d9d4b6.js";import"./Accordion-ea03839b.js";import"./useResizeObserver-0deb9469.js";import"./sideNavItems-22800105.js";import"./index-2d186805.js";import"./storyblok-c16fb040.js";import"./index-4963229a.js";import"./Modal-5a254f40.js";import"./styles-3ceda759.js";import"./forms-18e3c53a.js";import"./Flag-d41fef47.js";import"./countries-4aa86a38.js";import"./utils-87d126b1.js";var T=(n=>(n.ACTIVE="ACTIVE",n.ACHIVED="ACHIVED",n))(T||{});const lt=()=>({search:"",limit:10,perspective:T.ACTIVE}),dt=({status:n,id:s,cache:i})=>{i.updateFragment({fragment:Q,id:i.identify({__typename:"SearchableNoumContact",_id:s}),fragmentName:"SearchableNoumContact"},a=>({...a,__typename:"SearchableNoumContact",_id:a==null?void 0:a._id,displayName:a==null?void 0:a.displayName,createdAt:a==null?void 0:a.createdAt,isConnectedWithNoum:(a==null?void 0:a.isConnectedWithNoum)??!1,user:a==null?void 0:a.user,status:n}))},V={getDefaultFilterValues:lt,updateSearchableNoumContactCacheFragment:dt};function ut({contact:n,onSuccess:s}){const{t:i}=L(),[a]=X(),[h]=Y(),[o]=it(),[g]=st(),{addSuccessIconToast:l}=J(),{logError:r}=Z(),v=f.useCallback(async e=>{var c;if(n)try{if(!((c=(await g(n._id,e)).data)==null?void 0:c.updateNoumContact))return;l(i("noumena.noum_contacts.contact_selector.toast.contact_updated")),s()}catch(C){r(C,"edit_contact",!0)}},[l,n,r,s,i,g]),I=f.useCallback(async e=>{var c;try{if(!((c=(await o(e)).data)==null?void 0:c.addNewNoumContact))return;l(i("noumena.noum_contacts.contact_selector.toast.contact_added")),s()}catch(C){r(C,"add_new_contact",!0)}},[o,l,r,s,i]),N=f.useCallback(async e=>{try{await a({variables:{contactIDs:e},update:(c,C)=>{e.forEach(y=>{var k;V.updateSearchableNoumContactCacheFragment({cache:c,id:y,status:(k=C.data)!=null&&k.archiveNoumContacts?b.Archived:b.Active})})}}),l("Contact archived successfully")}catch(c){r(c,"handleArchiveContact")}},[l,a,r]),w=f.useCallback(async e=>{try{await h({variables:{contactIDs:e},update:(c,C)=>{e.forEach(y=>{var k;V.updateSearchableNoumContactCacheFragment({cache:c,id:y,status:(k=C.data)!=null&&k.unarchiveNoumContacts?b.Active:b.Archived})})}}),l("Contact unarchived successfully")}catch(c){r(c,"handleArchiveContact")}},[l,r,h]);return{handleEditContact:v,handleAddContact:I,handleArchiveContacts:N,handleUnarchiveContacts:w}}function z({contact:n,onEdit:s,onArchive:i,onUnarchive:a}){const h=f.useCallback(o=>{switch(o){case"EDIT":{s(n);break}case"ARCHIVE":{i(n._id);break}case"UNARCHIVE":{a(n._id);break}default:console.log("Unsupported action",o,"no contact",n)}},[n,i,s,a]);return t(A.ActionsMenu,{onClick:o=>h(o),menuOptions:D([{label:"Edit",key:"EDIT",value:"EDIT",iconName:"edit_m"},n.status===b.Active?{label:"Archive",key:"ARCHIVE",value:"ARCHIVE",iconName:"delete_m",intent:"danger"}:{label:"Unarchive",key:"UNARCHIVE",value:"UNARCHIVE",iconName:"revert_m"}])})}const mt=x($)`
  width: 100%;
  padding: 24px;
  overflow: visible;
`,ht=x(S).attrs({colorToken:"--text-card-neutral-default",font:"footnote"})``,pt=x(S).attrs({colorToken:"--text-card-neutral-highlighted",font:"footnote"})``,Ct=x(p).attrs({justify:"space-between",fullWidth:!0})``,d={PageCard:mt,KeyText:ht,ValueText:pt,ItemRow:Ct};function ft({contacts:n,loading:s,onEdit:i,onArchive:a,onUnarchive:h}){return t(_,{children:t(A.CollapsibleList,{data:n,loading:s,renderLeft:o=>{var g;return m(p,{align:"center",gap:8,"data-test":"Stack",children:[t(F,{size:"M",url:(g=o.user.profile)==null?void 0:g.profilePictureThumbnail,"data-test":"Avatar"}),t(S,{font:"body-m-bold",colorToken:"--text-card-neutral-highlighted","data-test":"TSpan",children:o.displayName})]})},renderRight:o=>t(z,{contact:o,onEdit:i,onArchive:a,onUnarchive:h,"data-test":"ActionMenu"}),keyExtractor:o=>o._id??"",enableRowSelection:!0,renderContent:o=>m(p,{gap:8,vertical:!0,fullWidth:!0,padding:"0 0 8px 0","data-test":"Stack",children:[m(d.ItemRow,{children:[t(d.KeyText,{children:"Email Address"}),t(d.ValueText,{children:o.email})]}),m(d.ItemRow,{children:[t(d.KeyText,{children:"Title"}),t(d.ValueText,{children:o.title})]}),m(d.ItemRow,{children:[t(d.KeyText,{children:"Company"}),t(d.ValueText,{children:o.companyName})]}),m(d.ItemRow,{children:[t(d.KeyText,{children:"Contact / Billing Details"}),t(d.ValueText,{children:P.formatAddress(o)})]}),m(d.ItemRow,{children:[t(d.KeyText,{children:"Added"}),t(d.ValueText,{children:o.createdAt?H(U.parseDateString(o.createdAt)):"--"})]})]})})})}function gt({contacts:n,totalCount:s,offset:i,filters:a,listPerspective:h,loading:o,onPaginationChange:g,onEdit:l,onArchive:r,onUnarchive:v}){const{t:I}=L(),{isMobile:N}=R(),w=f.useMemo(()=>[{id:"name",title:"Name",width:"25%",renderValue:e=>{var c;return m(p,{align:"center",gap:8,"data-test":"columns-Stack",children:[t(F,{size:"M",url:(c=e.user.profile)==null?void 0:c.profilePictureThumbnail,"data-test":"columns-Avatar"}),m(p,{vertical:!0,"data-test":"columns-Stack",children:[t(S,{font:"body-m-bold",color:"--text-tablecell-header-neutral-highlighted","data-test":"columns-TSpan",children:e.displayName}),t(S,{font:"body-m",colorToken:"--text-tablecell-header-neutral-default","data-test":"columns-TSpan",children:e.user.email})]})]})}},{id:"title",title:"Title",renderValue:e=>e.title??"-",width:"15%"},{id:"company",title:"Company",renderValue:e=>e.companyName??"-",width:"15%"},{id:"billingDetails",title:"Contact / Billing Details",renderValue:e=>P.formatAddress(e),width:"25%"},{id:"added",title:"Added",renderValue:e=>H(U.parseDateString(e.createdAt)),width:"15%",wordWrap:!1},{id:"actions",title:"",renderValue:e=>t(p,{justify:"end","data-test":"columns-Stack",children:t(z,{contact:e,onEdit:l,onArchive:c=>r([c]),onUnarchive:c=>v([c]),"data-test":"columns-ActionMenu"})}),width:"5%"}],[l,r,v]);return t(_,{children:m(p,{gap:24,vertical:!0,fullWidth:!0,align:"stretch",padding:"0 0 64px 0","data-test":"Stack",children:[N?t(ft,{onArchive:e=>r([e]),onUnarchive:e=>v([e]),onEdit:l,contacts:n,loading:o,"data-test":"ContactsCollapsibleList"}):t(A.Table,{keyExtractor:e=>e._id??"",data:n,columns:w,rowsPerPage:5,loading:o,enableRowSelection:!0,wordWrap:!0}),t(A.Footer,{leftElement:t(A.Pagination,{totalCount:s,itemsPerPage:a.limit,currentOffset:i,onChange:g}),rightElement:t(A.BulkAction,{intent:"negative",label:h===T.ACHIVED?"Unarchive":"Archive",onClick:e=>h===T.ACHIVED?v(e):r(e),renderCounterLabel:e=>I("noumena.contact_manager.rows_selected",{count:e,postProcess:"interval"})})})]})})}function At({handelCreateNew:n}){const{isMobile:s}=R();return m(p,{gap:24,vertical:!0,align:"stretch","data-test":"Stack",children:[m(p,{gap:24,justify:"space-between",align:"center","data-test":"Stack",children:[t(p,{fullWidth:!0,"data-test":"Stack",children:t(S,{font:"heading-xs-bold","data-test":"TSpan",children:"Contacts"})}),m(p,{gap:8,justify:"flex-end",align:"center",fullWidth:!0,"data-test":"Stack",children:[t(p,{fullWidth:s,"data-test":"Stack",children:t(A.FilterInput,{name:"search",render:({field:{value:i,onChange:a}})=>t(tt,{inputSize:"small",value:i,onChange:a,placeholder:"Search...",leftIcon:t(E,{name:"search_m",size:24,color:"--icon-input-neutral-default","data-test":"Icon"}),rightIcon:!!i&&t(E,{name:"clear_m",size:24,color:"--icon-input-brand-primary-default",onClick:()=>a(""),"data-test":"Icon"}),"data-test":"TextField"})})}),!s&&t(et,{primary:!0,size:"small",leftIcon:t(E,{name:"add_m",size:24,"data-test":"Icon"}),onClick:n,"data-test":"Button",children:"Add a Contact"})]})]}),t(A.FilterInput,{name:"perspective",render:({field:{value:i,onChange:a}})=>t(at,{selectedId:i,mode:"isUnderline",isWithoutImage:!0,fontSize:"--font-body-medium-bold-size",onChange:h=>a(h),inputList:[{id:T.ACTIVE,name:"active",text:"Active",labelSize:"small"},{id:T.ACHIVED,name:"archived",text:"Archived",labelSize:"small"}],"data-test":"TabsForm"})})]})}function Ot(){const[n,s]=f.useState(V.getDefaultFilterValues()),[i,a]=f.useState(0),{modalType:h,openModal:o,closeModal:g,contextData:l}=nt(),{data:r,loading:v,fetchMore:I,refetch:N}=ot({notifyOnNetworkStatusChange:!0,fetchPolicy:"cache-and-network",variables:{limit:n.limit,offset:i,query:n.search,status:n.perspective===T.ACTIVE?b.Active:b.Archived}}),{handleAddContact:w,handleEditContact:e,handleArchiveContacts:c,handleUnarchiveContacts:C}=ut({contact:l,onSuccess:()=>{g(),setTimeout(N,3e3)}}),y=f.useMemo(()=>D(r==null?void 0:r.allNoumsContacts.data).filter(u=>n.perspective===T.ACTIVE?u.status===b.Active:u.status===b.Archived),[r==null?void 0:r.allNoumsContacts.data,n.perspective]),k=(r==null?void 0:r.allNoumsContacts.count)??0,W=f.useMemo(()=>rt.debounce(u=>{a(0),s(u)},1e3),[]),B=()=>{o("create")},j=u=>{o("edit",u)},K=async u=>{await w(u),setTimeout(()=>N(),2e3)},O=u=>{I({variables:{offset:u.offset}}),a(u.offset)},q=f.useCallback(u=>{c(u)},[c]),G=f.useCallback(u=>{C(u)},[C]);return m(_,{children:[t(ct,{type:"Contacts","data-test":"ListLayout",children:t(p,{gap:24,"data-test":"Stack",children:t(d.PageCard,{children:t(A.Provider,{data:y,children:m(p,{vertical:!0,align:"stretch","data-test":"Stack",children:[t(A.Filters,{defaultValues:n,onSubmit:W,clearRowSelectionOnSubmit:!0,children:t(At,{handelCreateNew:B,"data-test":"ListHeader"})}),t(gt,{offset:i,filters:n,listPerspective:n.perspective,loading:v,contacts:y,totalCount:k,onPaginationChange:O,onEdit:j,onArchive:q,onUnarchive:G,"data-test":"ContactsList"})]})})})})}),h==="create"&&t(M,{isOpenModal:!0,onClose:g,onConfirm:K,"data-test":"ContactFormModal"}),h==="edit"&&l&&t(M,{isOpenModal:!0,contact:l,onClose:g,onConfirm:e,"data-test":"ContactFormModal"})]})}export{Ot as default};
//# sourceMappingURL=ContactsManager-b2463b9e.js.map
